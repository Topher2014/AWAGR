{
  "title": "ダウングレード",
  "url": "https://wiki.archlinux.org/title/%E3%83%80%E3%82%A6%E3%83%B3%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- Arch Build System\n- makepkg\n- pacman\n- Arch Linux Archive\n\nパッケージをダウングレードする前に、なぜそうするのか考えて下さい。バグが理由ならば、バグトラッカーで既存のタスクを探してください。そこに無いのであれば、新しいタスクを追加してください。バグを修正するか、少なくとも、起こりうる問題を他のユーザに警告すると良いでしょう。\n\n- 場合によっては、一つのパッケージをダウングレードするために、依存パッケージも一緒にダウングレードする必要があります。ダウングレードするべきパッケージの数が多い場合、スナップショットを使うことを検討してください。Arch Linux Archive#特定の日時まで全てのパッケージをリストアする方法 を参照してください。\n- 設定ファイルやスクリプトの変更には注意を払ってください。今の所、pacman は、セーフガードをバイパスしない限り、これらの変更を処理してくれます。\n- ダウングレードが soname の変更を伴う場合、場合によっては、すべての依存パッケージもダウングレード、または再ビルドする必要があります。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 パッケージを以前のバージョンに戻す 1.1 pacman のキャッシュを使う 1.2 カーネルのダウングレード 1.3 Arch Linux Archive 1.4 パッケージの再ビルド 1.5 自動化する\n- 2 [testing] から戻る\n\n- 1.1 pacman のキャッシュを使う\n- 1.2 カーネルのダウングレード\n- 1.3 Arch Linux Archive\n- 1.4 パッケージの再ビルド\n- 1.5 自動化する\n\n"
    },
    {
      "title": "pacman のキャッシュを使う",
      "level": 3,
      "content": "以前にパッケージをインストールしていて、該当する pacman のキャッシュを削除していない場合、/var/cache/pacman/pkg/ から以前のバージョンをインストールしてください。\n\nこの方法では、現在のパッケージを削除して古いバージョンをインストールします。依存関係の変更は処理されますが、pacman はバージョンの衝突を処理しません。ダウングレードしたいパッケージと一緒にライブラリや他のパッケージもダウングレードする必要がある場合、そのパッケージも手動でダウングレードしなければならないことに気をつけてください。\n\n```\n# pacman -U file:///var/cache/pacman/pkg/package-old_version.pkg.tar.type\n```\n\ntype の部分は、古いパッケージビルドに対しては xz、2020 に行われた変更に従っているパッケージに対しては zst となることに注意してください。\n\n一度パッケージを古いバージョンに戻したら、アップデートされたパッケージの問題が解決されるまで、そのパッケージを pacman.conf の IgnorePkg セクションに一時的に追加してください。\n\n"
    },
    {
      "title": "カーネルのダウングレード",
      "level": 3,
      "content": "新しいカーネルで問題が発生した場合、pacman のキャッシュを使って Linux のパッケージを最後に動作したバージョンにダウングレードできます。/var/cache/pacman/pkg まで移動して、パッケージをダウングレードします。少なくとも linux と linux-headers とカーネルモジュールをダウングレードしてください。例:\n\n```\n# pacman -U file://linux-4.15.8-1-x86_64.pkg.tar.xz file://linux-headers-4.15.8-1-x86_64.pkg.tar.xz file://virtualbox-host-modules-arch-5.2.8-4-x86_64.pkg.tar.xz\n```\n\n```\n# arch-chroot /mnt\n```\n\n"
    },
    {
      "title": "Arch Linux Archive",
      "level": 3,
      "content": "Arch Linux Archive は公式リポジトリの毎日のスナップショットです。以前のバージョンのパッケージをインストールしたり、特定の日時までシステムを復元したりするのに使用できます。\n\n"
    },
    {
      "title": "パッケージの再ビルド",
      "level": 3,
      "content": "ダウングレードしたいパッケージが利用できない場合、正しい PKGBUILD を見つけて makepkg を使って再ビルドしてください。\n\n公式リポジトリにあるパッケージは、ABS を使って PKGBUILD を取得し、ソフトウェアのバージョンを編集してください。もしくは Packages のウェブサイトにアクセスしてダウングレードしたいパッケージをさがしてください。見つけたら、「変更履歴」をクリックして、必要なバージョンの場所をつきとめて、ディレクトリにあるファイルをダウンロードして makepkg でビルドしてください。\n\nArch Build System#旧リビジョンのパッケージをチェックアウトも参照。\n\n古い AUR パッケージは、AUR パッケージの Git リポジトリにある古いコミットをチェックアウトすることでビルドできます。2015 年以前の AUR3 PKGBUILD に関しては Arch User Repository#AUR3 パッケージの Git リポジトリを見てください。\n\n"
    },
    {
      "title": "自動化する",
      "level": 3,
      "content": "- downgrade — 一つ(あるいは複数)のパッケージをダウングレードする Bash スクリプトです。pacman のキャッシュや Arch Rollback Machine を使用します。詳細は downgrade(8) を見てください。\n\n"
    },
    {
      "title": "[testing] から戻る",
      "level": 2,
      "content": "公式リポジトリ#testing リポジトリの無効化 を見てください。\n\n"
    }
  ]
}