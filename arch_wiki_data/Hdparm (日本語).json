{
  "title": "Hdparm (日本語)",
  "url": "https://wiki.archlinux.org/title/Hdparm_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- ディスクの完全消去#hdparm\n\nhdparm はハードディスクドライブのハードウェアパラメータを設定・表示することができるコマンドラインユーティリティです。シンプルなベンチマークツールとして使うこともできます。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール\n- 2 使用方法 2.1 ディスク情報 2.2 ベンチマーク 2.3 電源管理の設定 2.4 ライトキャッシュ\n- 3 ヒントとテクニック 3.1 ハードドライブを起動させずに状態を確認する 3.2 サポートされていないハードウェアを使用する 3.3 udev ルールによる永続的な設定 3.4 起動後にドライブをスリープ状態にさせる 3.5 WD Green HDD の電源管理\n- 4 トラブルシューティング 4.1 サスペンド後に APM のレベルがリセットされる\n- 5 参照\n\n- 2.1 ディスク情報\n- 2.2 ベンチマーク\n- 2.3 電源管理の設定\n- 2.4 ライトキャッシュ\n\n- 3.1 ハードドライブを起動させずに状態を確認する\n- 3.2 サポートされていないハードウェアを使用する\n- 3.3 udev ルールによる永続的な設定\n- 3.4 起動後にドライブをスリープ状態にさせる\n- 3.5 WD Green HDD の電源管理\n\n- 4.1 サスペンド後に APM のレベルがリセットされる\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "公式リポジトリから hdparm をインストールします｡SCSI デバイスを使っている場合は sdparm をインストールしてください｡\n\n"
    },
    {
      "title": "ディスク情報",
      "level": 3,
      "content": "HDD の情報を得るには、以下のコマンドを実行します:\n\n```\n# hdparm -I /dev/sda\n```\n\n"
    },
    {
      "title": "ベンチマーク",
      "level": 3,
      "content": "ベンチマーク/データストレージデバイスを見てください。\n\n"
    },
    {
      "title": "電源管理の設定",
      "level": 3,
      "content": "近代的なハードドライブは様々な電源管理機能をサポートしています。以下の表には最もよく使われている機能を載せています。完全なリストは hdparm(8) を見てください。\n\nTable content:\nパラメータ | 説明\n-B | Advanced Power Management 機能を設定します。利用可能な値は1から255です。値を低くすると積極的に消費電力を下げて、値を高くすると性能が上昇します。1から127までの値ではスピンダウンを行いますが、128から254までの値ではスピンダウンを行いません。255にすると APM 機能が完全に無効化されます。\n-S | ドライブのスタンバイ (スピンダウン) タイムアウトを設定します。電力を抑えるためにモーターを切るまでのタイムアウト (ディスクが使われないアイドル時間) を指定します。0にするとスピンダウンが無効化され、1から240までは5秒間隔で、241から251までは30分間隔で指定します。\n-M | Automatic Acoustic Management 機能を設定します。最新のハードディスクドライブに搭載されている機能でヘッドの動きを遅くして騒音を減らします。設定できる値はディスクによって異なり、一部のディスクでは機能が使えません。\n\n現在の値を確認するには、何も値を設定せずにパラメータを指定してください。例:\n\n```\n# hdparm -B /dev/sda\n```\n\n値を適用したい場合、例えば APM を 127 に設定するには:\n\n```\n# hdparm -B 127 /dev/sda\n```\n\n"
    },
    {
      "title": "ライトキャッシュ",
      "level": 3,
      "content": "ライトキャッシングとは、ファイルをディスクに書き込む前に、ドライブの組み込みメモリに一時的にキャッシュする処理のことです。基本的にパフォーマンスが向上します。ライトキャッシュは、ほとんどのハードドライブで提供されている機能で、ほとんどの場合、デフォルトで有効化されています。確認するには以下を実行してください:\n\n```\n$ hdparm -W /dev/sdX\n```\n\n無効化されている場合、以下で有効化できます:\n\n```\n$ hdparm -W 1 /dev/sdX\n```\n\n逆に無効化するには以下を使用します:\n\n```\n$ hdparm -W 0 /dev/sdX\n```\n\n"
    },
    {
      "title": "ハードドライブを起動させずに状態を確認する",
      "level": 3,
      "content": "hdparm で問い合わせオプションを使うとドライブが立ち上がってしまうことがあります。smartmontools の smartctl を使うことで休眠状態のディスクを起こさずに状態を確認できます。\n\n例:\n\n```\n# smartctl -i -n standby /dev/sda\nsmartctl 6.5 2016-05-07 r4318 [x86_64-linux-4.10.13-1-ARCH] (local build)\nCopyright (C) 2002-16, Bruce Allen, Christian Franke, www.smartmontools.org\n\nDevice is in STANDBY mode, exit(2)\n```\n\n"
    },
    {
      "title": "サポートされていないハードウェアを使用する",
      "level": 3,
      "content": "一部のドライブ (特に外付けのドライブ) は hdparm によるスピンダウンに対応していません。その場合、以下のようなエラーメッセージが表示されます:\n\n```\n# hdparm -S 240 /dev/sda\n/dev/sda:\nsetting standby to 240 (20 minutes)\nHDIO_DRIVE_CMD(setidle) failed: Invalid argument\n```\n\n未対応のドライブは hd-idle を使ってスピンダウンできる場合があります。/etc/conf.d/hd-idle を開いて \"HD_IDLE_OPTS\" 行を編集してから hd-idle.service を起動・有効化してください。\n\n例えば sda ドライブのスピンダウンタイムを30分間にするには:\n\n```\nHD_IDLE_OPTS=\"-i 0 -a sda -i 1800\"\n```\n\n"
    },
    {
      "title": "udev ルールによる永続的な設定",
      "level": 3,
      "content": "設定を永続化させるには、以下の udev ルールを作成してください (値は適当に変えてください):\n\n```\n/etc/udev/rules.d/50-hdparm.rules\n```\n\n```\nACTION==\"add\", SUBSYSTEM==\"block\", KERNEL==\"sda\", RUN+=\"/usr/bin/hdparm -B 254 -S 0 /dev/sda\"\n```\n\nハードドライブが複数ある場合はもっと柔軟にルールを設定できます。例えば、全ての外付けドライブに省電力設定を適用するには (内蔵ドライブが /dev/sda だけの場合):\n\n```\n/etc/udev/rules.d/50-hdparm.rules\n```\n\n```\nACTION==\"add|change\", KERNEL==\"sd[b-z]\", ATTR{queue/rotational}==\"1\", RUN+=\"/usr/bin/hdparm -B 127 -S 12 /dev/%k\"\n```\n\n"
    },
    {
      "title": "起動後にドライブをスリープ状態にさせる",
      "level": 3,
      "content": "滅多に使用しないデバイスであれば起動時に直接スリープ状態にすると良いでしょう。上記の udev ルールでは設定できません。起動が完了したときにコマンドを実行するには、systemd サービスを作成します:\n\n```\n/etc/systemd/system/hdparm.service\n```\n\n```\n[Unit]\nDescription=hdparm sleep\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/hdparm -q -S 120 -y /dev/sdb\n\n[Install]\nWantedBy=multi-user.target\n```\n\nサービスを作成したら有効化してください。\n\n"
    },
    {
      "title": "WD Green HDD の電源管理",
      "level": 3,
      "content": "Advanced Format#WD Green HDD に関する特記事項を見てください。\n\n"
    },
    {
      "title": "サスペンド後に APM のレベルがリセットされる",
      "level": 3,
      "content": "サスペンドで APM のレベルがリセットされる場合、復帰後にコマンドを再実行する必要があります。以下の systemd ユニットを使うことで自動的に実行させることができます ([1] を参照):\n\n```\n/etc/systemd/system/apm.service\n```\n\n```\n[Unit]\nDescription=Local system resume actions\nAfter=suspend.target hybrid-sleep.target hibernate.target\n\n[Service]\nType=simple\nExecStart=/usr/bin/hdparm -B 254 /dev/sda\n\n[Install]\nWantedBy=sleep.target\n```\n\nもしくは/usr/lib/systemd/system-sleep にフックを作成する方法もあります。\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- https://sourceforge.net/projects/hdparm/ - hdparm on SourceForge\n\n"
    }
  ]
}