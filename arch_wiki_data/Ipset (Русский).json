{
  "title": "Ipset (Русский)",
  "url": "https://wiki.archlinux.org/title/Ipset_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Ссылки по теме\n\n- Межсетевой экран\n- iptables (Русский)\n\nipset — это сопутствующее приложение для межсетевого экрана Linux iptables. Он позволяет, помимо прочего, задавать правила для быстрой и простой блокировки набора IP-адресов.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "Установите пакет ipset.\n\n"
    },
    {
      "title": "Блокировка списка сетей",
      "level": 3,
      "content": "Для начала создайте новый «набор» сетевых адресов. Эта команда создаст новый «хэш» набор сетевых адресов с названием «myset».\n\n```\n# ipset create myset hash:net\n```\n\nили\n\n```\n# ipset -N myset nethash\n```\n\nДобавьте в набор любые IP-адреса, которые вы хотите заблокировать.\n\n```\n# ipset add myset 14.144.0.0/12\n# ipset add myset 27.8.0.0/13\n# ipset add myset 58.16.0.0/15\n# ipset add myset 1.1.1.0/24\n```\n\nЗатем настройте iptables для блокировки любого адреса из этого набора. Данная команда добавляет правило в цепочку INPUT, которое отбрасывает любые входящие пакеты с источником из множества IP-адресов, определенного как «myset».\n\n```\n# iptables -I INPUT -m set --match-set myset src -j DROP\n```\n\n"
    },
    {
      "title": "Блокировка списка IP-адресов",
      "level": 3,
      "content": "Начните с создания нового «набора» IP-адресов. Эта команда создаст новый «хеш» набор IP-адресов с именем «myset-ip».\n\n```\n# ipset create myset-ip hash:ip\n```\n\nили\n\n```\n# ipset -N myset-ip iphash\n```\n\nДобавьте в набор любые IP-адреса, которые вы хотите заблокировать.\n\n```\n# ipset add myset-ip 1.1.1.1\n# ipset add myset-ip 2.2.2.2\n```\n\nНаконец, настройте iptables для блокировки любого адреса из этого набора.\n\n```\n# iptables -I INPUT -m set --match-set myset-ip src -j DROP\n```\n\n"
    },
    {
      "title": "Делаем ipset постоянным",
      "level": 3,
      "content": "Созданный вами ipset хранится в памяти и исчезнет после перезагрузки. Чтобы сделать ipset постоянным, вам необходимо сделать следующее:\n\nВо-первых, сохраните ipset в /etc/ipset.conf:\n\n```\n# ipset save > /etc/ipset.conf\n```\n\nЗатем включите ipset.service, который работает аналогично iptables.service для восстановления правил iptables.\n\n"
    },
    {
      "title": "Блокировка с помощью PeerGuardian и других черных списков",
      "level": 3,
      "content": "Инструмент pg2ipset-gitAUR от автора Maeyanie.com в сочетании со скриптом ipset-update.sh может использоваться с cron для автоматического обновления различных чёрных списков. На данный момент по умолчанию реализована блокировка: страны, узла выхода Tor и списка Bluetack pg2.\n\n"
    },
    {
      "title": "Другие команды",
      "level": 2,
      "content": "Для просмотра наборов:\n\n```\n# ipset list\n```\n\nили\n\n```\n# ipset -L\n```\n\nДля удаления набора:\n\n```\n# ipset destroy myset\n```\n\nили\n\n```\n# ipset -X myset\n```\n\nДля удаления всех наборов:\n\n```\n# ipset destroy\n```\n\nДополнительную информацию см. в ipset(8).\n\n"
    },
    {
      "title": "Оптимизация",
      "level": 2,
      "content": "Инструмент iprangeAUR может помочь уменьшить количество записей в ipset.conf путём объединения соседних диапазонов или удаления пересекающихся диапазонов. Это может повысить производительность маршрутизатора/брандмауэра, если размер таблицы огромен. Этот инструмент также может преобразовать список имён хостов в IP-адреса.\n\nХоть ipset и спроектирован так, чтобы его можно было хорошо масштабировать, это не означает, что можно делать до бесконечности. В частности, в некоторых странах очень большое пространство IP-адресов, что делает геоблокировку неэффективной.\n\n"
    }
  ]
}