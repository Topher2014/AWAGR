{
  "title": "Mozc (日本語)",
  "url": "https://wiki.archlinux.org/title/Mozc_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "プロジェクトのホームページより:\n\nMozc と Google 日本語入力との差異はプロジェクトの About Branding ページで詳しく説明されていますが、簡単に言うと、Mozc のオープンソースのコードには Google の豊富な単語変換テーブル (いわゆる「辞書」) が含まれておらず、そのため Mozc の変換品質は Google 日本語入力のものほどではありません。ただし、この欠点はカスタム辞書によりほとんど軽減することができます (以下を参照)。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール 1.1 分割パッケージと統合パッケージの違い 1.2 UT 辞書 1.3 要約\n- 2 設定 2.1 IBus 2.2 Fcitx5 2.3 Emacs 2.3.1 XIM を無効化する\n- 3 ヒントとテクニック 3.1 現在使用している Mozc のバージョンを表示する 3.2 コマンドラインから Mozc ツールを起動 3.3 ASCII キーボードで CapsLock キーを英数キーとして使用する 3.4 非英語/非日本語のシステムで日本語キーマップを使用する\n- 4 トラブルシューティング 4.1 Mozc のビルドに失敗する (プロセスが強制終了される) 4.2 Mozc をアップグレードし、X または IBus を再起動しても (リブートはしていない) 古い Mozc が動いている 4.3 mozc_server が defunct になる 4.4 mozc_emacs_helper not found in emacs 4.5 mozc ツールが起動しない 4.6 ダークモードで候補ウィンドウが真っ白になる 4.7 変換精度が使用当初より下がった\n\n- 1.1 分割パッケージと統合パッケージの違い\n- 1.2 UT 辞書\n- 1.3 要約\n\n- 2.1 IBus\n- 2.2 Fcitx5\n- 2.3 Emacs 2.3.1 XIM を無効化する\n\n- 2.3.1 XIM を無効化する\n\n- 3.1 現在使用している Mozc のバージョンを表示する\n- 3.2 コマンドラインから Mozc ツールを起動\n- 3.3 ASCII キーボードで CapsLock キーを英数キーとして使用する\n- 3.4 非英語/非日本語のシステムで日本語キーマップを使用する\n\n- 4.1 Mozc のビルドに失敗する (プロセスが強制終了される)\n- 4.2 Mozc をアップグレードし、X または IBus を再起動しても (リブートはしていない) 古い Mozc が動いている\n- 4.3 mozc_server が defunct になる\n- 4.4 mozc_emacs_helper not found in emacs\n- 4.5 mozc ツールが起動しない\n- 4.6 ダークモードで候補ウィンドウが真っ白になる\n- 4.7 変換精度が使用当初より下がった\n\n"
    },
    {
      "title": "分割パッケージと統合パッケージの違い",
      "level": 3,
      "content": "1つの IME として、Mozc は2つの部分に分けられます: すべての変換処理を行うサーバと、サーバがシステムのインプットメソッドフレームワークと通信できるようにし、結果を画面に出力する一連のモジュールです。IBus、Fcitx5、Fcitx、そして Emacs のそれぞれに対して個別のモジュールが必要です。\n\n一部の Mozc パッケージには IMF 固有のモジュールしか含まれておらず、サーバが mozcAUR パッケージに分割されています。これにより、サーバ自体とは独立に異なるモジュールを同時にインストールすることができます (これは、異なるユーザが異なる IMF を使用するような複数ユーザのセットアップや、Emacs を使用する場合において便利です)。\n\n他の Mozc パッケージはこのような分割を行わず、サーバとモジュールを統合しています。この方法にはメリットがありますが、(複数のパッケージがサーバのファイルを提供しようと競合してしまうため) ファイルの衝突のせいで追加のモジュールがインストールできなくなってしまうという非常に顕著な欠点もあります。\n\n何らかの理由で複数の IMF モジュールを同時にインストールする必要がある場合の解決策は、非分割パッケージを自分でビルドしてファイルの衝突を手動で解決するか、モジュールからサーバを分割しているパッケージから選ぶかです。\n\n"
    },
    {
      "title": "UT 辞書",
      "level": 3,
      "content": "すでに述べたように、Mozc には Google の豊富な単語変換テーブル (いわゆる「辞書」) が含まれていないため、Mozc の変換品質は Google 日本語入力のものほど良くありません。それに対する解決策が UT 辞書という形で存在します。UT 辞書はサードパーティの辞書で、Mozc の変換品質を強化し、Google 日本語入力に近づけます。これは、いくつかの人気なオンラインのソース (Google、Yahoo、そして Wikipedia のページランクをベースとする) から集められた数千もの追加の単語を含め、さらに NEologd 辞書 (作者の言葉を借りるならば、「ウェブ上の多くの言語リソースから抽出された neologisms (新語)」が含まれています) などの他の特化したソースを統合することにより達成されます。\n\n"
    },
    {
      "title": "要約",
      "level": 3,
      "content": "fcitx5-mozc-utAUR、fcitx-mozc-utAUR、ibus-mozcAUR、そして emacs-mozcAUR から1つ或いは複数をインストールしてください。\n\nMozc のどのフレーバを使用するか尋ねられたら、バニラな Mozc の mozcAUR か UT で強化された Mozc の mozc-utAUR のどちらかを選択してください。\n\n"
    },
    {
      "title": "IBus",
      "level": 3,
      "content": "詳細は IBus を参照してください。\n\n```\n~/.config/mozc/ibus_config.textproto\n```\n\n```\n...\n}\nactive_on_launch: True\n```\n\nこれがうまく行かない場合:\n\n- ~/.mozc/ibus_config.textproto が存在しないことを確認してください。このファイルが存在する場合 (例えば、古い環境から Mozc をアップグレードした場合など)、~/.config/mozc/ibus_config.textproto よりも優先されてしまいます。\n- コマンド ibus write-cache; ibus restart を実行して、IBus を再起動してください。\n\n詳細は Mozc のドキュメント で見られます。\n\n以下を実行して IBus 設定ツールを開いてください:\n\n```\n$ ibus-setup\n```\n\nインプットメソッド タブで 追加 をクリックし、Mozc レイアウトを検索して追加してください。\n\nAlt+Shift_L (IBus のデフォルト) を押すことにより新しい Mozc へ切り替えることができます。\n\n"
    },
    {
      "title": "Fcitx5",
      "level": 3,
      "content": "詳細は Fcitx5 を参照してください。\n\n以下を実行して Fcitx5 設定ツールを開いてください:\n\n```\n$ fcitx5-configtool\n```\n\n入力メソッド タブを開き、右側の利用可能なレイアウトのリストから Mozc を探し、左矢印をクリックしてアクティブなレイアウトのリストに追加してください。これで、標準的なキーボードショートカットで Mozc レイアウトへ切り替えることができます。\n\n"
    },
    {
      "title": "Emacs",
      "level": 3,
      "content": "mozc.el (mozc-mode) を使用して LEIM (Library of Emacs Input Method) 経由で日本語を入力することができます。mozc-mode を使用するには、以下を .emacs.d/init.el あるいはその他の Emacs カスタム設定用ファイルに追加します:\n\n```\n(require 'mozc)  ; or (load-file \"/path/to/mozc.el\")\n(setq default-input-method \"japanese-mozc\")\n```\n\nmozc.el は変換候補の表示スタイルに、候補のリストを入力中文字列のそばに表示する \"overlay\" モードを提供しています (Mozc r77以降)。このモードをデフォルトで利用する場合は、以下の設定を追加します:\n\n```\n(setq mozc-candidate-style 'overlay)\n```\n\nC-\\ (toggle-input-method) で mozc-mode のオン/オフを切り替えます。\n\n"
    },
    {
      "title": "XIM を無効化する",
      "level": 4,
      "content": "デスクトップ環境上で IM のオン・オフのキー割り当てに C-SPC を設定しており、Emacs 上でもそちらが優先されて C-SPC/C-@ で set-mark-command が使えなくて困る、という場合は、~/.Xresources か ~/.Xdefaults に以下を追加します。\n\n```\nEmacs*UseXIM: false\n```\n\n"
    },
    {
      "title": "現在使用している Mozc のバージョンを表示する",
      "level": 3,
      "content": "Mozc 起動中に \"ばーじょん\" と入力し変換すると、変換候補の中に現在の Mozc のバージョン番号が表示されます:\n\n```\nばーじょん\n```\n\n```\nバージョン\nヴァージョン\nばーじょん\nMozc-1.6.1187.102 ⇐ 現在の Mozc バージョン\n...\n```\n\n"
    },
    {
      "title": "コマンドラインから Mozc ツールを起動",
      "level": 3,
      "content": "以下のコマンドで Mozc のツールを起動できます:\n\n- Mozc 設定: /usr/lib/mozc/mozc_tool --mode=config_dialog\n- Mozc 辞書ツール: /usr/lib/mozc/mozc_tool --mode=dictionary_tool\n- Mozc 単語登録: /usr/lib/mozc/mozc_tool --mode=word_register_dialog\n\n"
    },
    {
      "title": "ASCII キーボードで CapsLock キーを英数キーとして使用する",
      "level": 3,
      "content": "Mozc のプリセットのキーバインドや多くの日本語入力メソッドでは、変換前入力中の英数入力切り替えは、英数キー、ひらがな/カタカナキー、あるいは無変換キーなどに割り当てられていますが、ASCII キーボードにそれらはありません。\n\nCapsLock キーに英数キー (Eisu_toggle) を割り当てることで日本語キーボードと同じように使用できます (Mozc は CapsLock キーを r124 として認識しないようです)。以下の設定では、OADG キーボードと等価な、Eisu_toggle を (修飾キーなしの) Caps Lock キーに、Caps_Lock を Shift+CapsLock キーに割り当てます。\n\n~/.Xmodmap を以下のように編集します:\n\n```\nkeycode 66 = Eisu_toggle Caps_Lock\nclear Lock\n```\n\nX 再起動するか、xmodmap コマンドを実行することで、変更を即座に適用できます:\n\n```\n$ xmodmap ~/.Xmodmap\n```\n\n"
    },
    {
      "title": "非英語/非日本語のシステムで日本語キーマップを使用する",
      "level": 3,
      "content": "QWERTY でないキーボードレイアウト (例 ドイツ語) で非英語/非日本語のシステムを主に使用していて、日本語を単にサブの入力言語として使用したい場合、キーマップはこのメインのキーボード言語がベースになっているかもしれません。これは、特に Windows や MacOS、或いは日本語コンピュータから移行した場合に、奇妙に感じれれるかもしれません。\n\nIBus で基底のキーボードレイアウトを変更するには、~/.config/mozc/ibus_config.textproto 内で layout キーを日本語 (或いは、他の QWERTY キーボード) に設定してデフォルトのキーマップを変更してください:\n\n```\n~/.config/mozc/ibus_config.textproto\n```\n\n```\nengines {\n...\n  layout : \"jp\"\n...\n}\n```\n\n"
    },
    {
      "title": "Mozc のビルドに失敗する (プロセスが強制終了される)",
      "level": 3,
      "content": "ビルドが以下のようなメッセージで異常終了した場合:\n\n```\n...\n/bin/sh: 1 行:  xxxx 強制終了\n...\nmake: *** [xxx/xxx ...] エラー 137\n...\n```\n\nメモリ不足になっていないか確認してください。\n\n"
    },
    {
      "title": "Mozc をアップグレードし、X または IBus を再起動しても (リブートはしていない) 古い Mozc が動いている",
      "level": 3,
      "content": "古いバージョンの Mozc が終了されずにずっとメモリ上で動作しているのかもしれません。既存の mozc_server プロセスを一度 kill してみてください:\n\n```\n$ killall mozc_server\n```\n\n"
    },
    {
      "title": "mozc_server が defunct になる",
      "level": 3,
      "content": "root で Mozc を起動することはできません。一般ユーザーで X を起動してください。\n\n"
    },
    {
      "title": "mozc_emacs_helper not found in emacs",
      "level": 3,
      "content": "mozc.el をインストールするときは、mozc_emacs_helper というヘルパープログラムをインストールする必要があります。\n\nこのヘルパープログラムには emacs-mozcAUR をインストールする必要があります。\n\n"
    },
    {
      "title": "mozc ツールが起動しない",
      "level": 3,
      "content": "ログをコンソールに直接送信して Mozc ツールを起動することもできます。これはデバッグに役立ちます。これを有効にするには、たとえば次のように --logtostderr を追加するだけです:\n\n```\n$ /usr/lib/mozc/mozc_tool --mode=config_dialog --logtostderr\n```\n\nこちらも参照\n\n"
    },
    {
      "title": "ダークモードで候補ウィンドウが真っ白になる",
      "level": 3,
      "content": "以下の環境変数を使用してください:\n\n```\nMOZC_IBUS_CANDIDATE_WINDOW=ibus\n```\n\n"
    },
    {
      "title": "変換精度が使用当初より下がった",
      "level": 3,
      "content": "Mozc は、変換候補の中からユーザーが確定したものを学習していきます。しかし、間違って変換したものも学習していき、誤変換を繰り返すようになることがあります。そのような場合、学習履歴をクリアすると良いかもしれません。\n\nMozc の設定ツールを起動:\n\n```\n$ /usr/lib/mozc/mozc_tool --mode=config_dialog\n```\n\n辞書 タブを開き、学習履歴のクリア をクリックしてください。\n\n"
    }
  ]
}