{
  "title": "ミラー",
  "url": "https://wiki.archlinux.org/title/%E3%83%9F%E3%83%A9%E3%83%BC",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- 非公式ミラー\n- pacman\n- DeveloperWiki:新しいミラー\n\nこのページにはミラーの選択と設定のガイドと現在利用できるミラーのリストがあります。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 公式ミラー 1.1 IPv6 対応ミラー\n- 2 特定のミラーを有効にする 2.1 pacman にパッケージリストを更新させる\n- 3 ミラーをソートする 3.1 速度別一覧 3.1.1 速度で並び替える 3.1.2 ライブミラーリストの取得と順位付け 3.2 サーバーサイドのランク付け\n- 4 トラブルシューティング 4.1 mirrorlist が存在しない場合 4.2 ミラーの動作不良\n- 5 参照\n\n- 1.1 IPv6 対応ミラー\n\n- 2.1 pacman にパッケージリストを更新させる\n\n- 3.1 速度別一覧 3.1.1 速度で並び替える 3.1.2 ライブミラーリストの取得と順位付け\n- 3.2 サーバーサイドのランク付け\n\n- 3.1.1 速度で並び替える\n- 3.1.2 ライブミラーリストの取得と順位付け\n\n- 4.1 mirrorlist が存在しない場合\n- 4.2 ミラーの動作不良\n\n"
    },
    {
      "title": "公式ミラー",
      "level": 2,
      "content": "公式の Arch Linux ミラーリストは pacman-mirrorlist パッケージから取得されます。最新のミラーリストを取得したい場合、メインサイトの Pacman Mirrorlist Generator ページを使ってください。\n\nArch ミラーの状態は Mirror Status のページで確認できます。できるかぎり最新となっているミラーを使用することを推奨します。\n\n公式のミラーリストにミラーを追加して欲しい場合は、DeveloperWiki:新しいミラー を見てください。それまでは、このページの下部にある#非公式ミラーリストに追加してください。\n\n"
    },
    {
      "title": "IPv6 対応ミラー",
      "level": 3,
      "content": "Pacman Mirrorlist Generator を使って最新の IPv6 ミラーのリストを確認することができます。\n\n"
    },
    {
      "title": "特定のミラーを有効にする",
      "level": 2,
      "content": "ミラーを有効にするには、/etc/pacman.d/mirrorlist を開いてあなたの国の部分を見て下さい。あなたが使いたいミラーをアンコメントします。\n\n例:\n\n```\n# Japan\n# Server = ftp://ftp.jaist.ac.jp/pub/Linux/ArchLinux/$repo/os/$arch\nServer = http://ftp.jaist.ac.jp/pub/Linux/ArchLinux/$repo/os/$arch\n```\n\nミラーの選択を助けるツールについては #ミラーをソートする を見て下さい。\n\n- 好みの5つのミラーをアンコメントしてミラーリストファイルの一番上に置いて下さい。最初のミラーに問題が起こったとしても他のミラーに移ることができるようになります。ミラーリストのアップデートをマージするのが簡単になるメリットもあります。\n- HTTP の持続的接続があるため、HTTP のミラーの方が FTP よりも高速です。FTP では、パッケージのダウンロードをリクエストするたびに新しい接続を確立する必要があるため、pacman はそのたびに停止してしまいます。\n\n/etc/pacman.conf でミラーを指定することも可能です。[core] リポジトリのデフォルトの設定は以下の通りです:\n\n```\n[core]\nInclude = /etc/pacman.d/mirrorlist\n```\n\nJAIST のミラーをデフォルトのミラーとして使いたい場合、Include 行の前に次を追加してください:\n\n```\n[core]\nServer = ftp://ftp.jaist.ac.jp/pub/Linux/ArchLinux/core/os/$arch\nInclude = /etc/pacman.d/mirrorlist\n```\n\npacman は最初にこのミラーに接続を試行するようになります。同じように [testing], [extra], [community] でミラーを設定することができます。\n\n"
    },
    {
      "title": "pacman にパッケージリストを更新させる",
      "level": 3,
      "content": "/etc/pacman.d/mirrorlist を作成・編集した後は次のコマンドを実行してください:\n\n```\n# pacman -Syyu\n```\n\n2つの --refresh や -y フラグを渡すと (リストが最新でも) 強制的に pacman の全てのパッケージリストを更新させます。新しいミラーに変更した時はいつでも pacman -Syy をするようにして下さい。無用な問題を避けることができます。Is -Syy safe? も参照。\n\n"
    },
    {
      "title": "ミラーをソートする",
      "level": 2,
      "content": "パッケージをダウンロードする際、pacman は /etc/pacman.d/mirrorlist に書かれた順番でミラーを使用します。更新頻度と速度でミラーをソートする Reflector を使わない場合、以下の方法で手動でミラーをソートしてください。\n\n最速のミラーだけを使うのはいいアイデアとは言えません。最速のミラーの更新が遅れることがありえるからです。速度で並び替えてからミラーの状態 を見て同期が遅れているミラーを排除するほうが良いでしょう。\n\n"
    },
    {
      "title": "速度で並び替える",
      "level": 4,
      "content": "pacman-contrib パッケージに含まれている Bash スクリプト /usr/bin/rankmirrors で最速のローカルミラーを決定することができます。\n\n既存の /etc/pacman.d/mirrorlist をバックアップしてください:\n\n```\n# cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.backup\n```\n\n/etc/pacman.d/mirrorlist.backup を編集して rankmirrors でテストするミラーをアンコメントしてください。\n\n全てのミラーをアンコメントしたいなら以下の sed を実行:\n\n```\n# sed -i 's/^#Server/Server/' /etc/pacman.d/mirrorlist.backup\n```\n\n最後に、ミラーにランク付けをします。-n 6 は最速の6つのミラーを出力することを意味しています:\n\n```\n# rankmirrors -n 6 /etc/pacman.d/mirrorlist.backup > /etc/pacman.d/mirrorlist\n```\n\nrankmirrors -h でオプションを全て一覧できます。\n\n"
    },
    {
      "title": "ライブミラーリストの取得と順位付け",
      "level": 4,
      "content": "ある国にある最新のミラーのショートリストを作って rankmirrors に送るには、Pacman Mirrorlist Generator からリストを取得することができます。 以下のコマンドは https プロトコルをサポートする 日本 と オーストラリア の最新ミラーを取得し、リスト内のサーバーのコメントを解除し、ランク付けして最も速い5つを出力します。\n\n```\n$ curl -s \"https://archlinux.org/mirrorlist/?country=JP&country=AU&protocol=https&use_mirror_status=on\" | sed -e 's/^#Server/Server/' -e '/^#/d' | rankmirrors -n 5 -\n```\n\nRate Mirrors — これはミラーを取得し、古いミラーや同期していないミラーをスキップし、海底ケーブルやインターネット交換に関する情報を使って国間を移動し、高速なミラーを見つけます。そして、各アップデートの前に実行するのに十分な速さです。stdin を通して送られるカスタムミラーリストもサポートします。\n\n"
    },
    {
      "title": "サーバーサイドのランク付け",
      "level": 3,
      "content": "公式の Pacman Mirrorlist Generator を使うことで簡単にランク付けされたミラーのリストを取得できます。ランク付けには複数の要因が絡んでいるので、ミラーやクライアントの負担によって数値は変わる可能性があります。\n\nもう 1 つの一般的な代替手段は、次のツールです。\n\nReflector — MirrorStatus ページから最新のミラーリストを取得し、速度順にフィルターして並べ替えて、/etc/pacman.d/mirrorlist ファイルを上書きします。systemd サービスとタイマーによる自動化も提供します。\n\n"
    },
    {
      "title": "mirrorlist が存在しない場合",
      "level": 3,
      "content": "```\nerror: config file /etc/pacman.d/mirrorlist could not be read: No such file or directory\n```\n\nというエラーに遭遇した場合は、公式サイトから直接ミラーの一覧を取得してください:\n\n```\n# curl -o /etc/pacman.d/mirrorlist https://www.archlinux.org/mirrorlist/all/\n```\n\n上述のとおり好ましいミラーをアンコメントして、次を実行:\n\n```\n# pacman -Syu pacman-mirrorlist\n```\n\n"
    },
    {
      "title": "ミラーの動作不良",
      "level": 3,
      "content": "ミラーが適切に動作しておらず、それが ミラーのステータス ページ に反映されていないことが確実な場合は、ミラーを変更して バグレポートを開いてください。 ミラーの場合、課題は Arch Linux プロジェクト (ログイン ボックスのすぐ下のリストを参照するか、ページで スイッチ を検索してください) タスク タイプ バグレポート、カテゴリ ミラー で開く必要があります。\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- GitHub archweb mirrorlist.py - archweb ミラーリストジェネレータのソースコード\n\n"
    }
  ]
}