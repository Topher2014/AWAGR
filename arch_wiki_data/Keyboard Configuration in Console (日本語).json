{
  "title": "Keyboard Configuration in Console (日本語)",
  "url": "https://wiki.archlinux.org/title/Keyboard_Configuration_in_Console_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- Linux コンソール\n- Xorg/キーボード設定\n- キーボード入力\n- Linux コンソール#フォント\n\nLinux コンソールにおけるキーボードマッピング (keymaps)、コンソールフォント、コンソールマップは、kbd パッケージ (systemd の依存パッケージ) によって提供されています。このパッケージは、テキストコンソールを管理するための低レベルなツールも多く提供しています。加えて、systemd は localectl ツールも提供しています。このツールは、システムのロケールとキーボードレイアウトの両方の設定をコンソールと Xorg の両方で制御できます。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 キーボード設定の表示\n- 2 キーマップ 2.1 キーマップの一覧表示 2.2 Loadkeys 2.3 永続的な設定 2.4 カスタムキーマップの作成 2.4.1 命令を追加する 2.4.2 その他の例 2.4.3 変更を保存する\n- 3 オートリピートの遅延と速度の調整 3.1 Systemd サービス\n\n- 2.1 キーマップの一覧表示\n- 2.2 Loadkeys\n- 2.3 永続的な設定\n- 2.4 カスタムキーマップの作成 2.4.1 命令を追加する 2.4.2 その他の例 2.4.3 変更を保存する\n\n- 2.4.1 命令を追加する\n- 2.4.2 その他の例\n- 2.4.3 変更を保存する\n\n- 3.1 Systemd サービス\n\n"
    },
    {
      "title": "キーボード設定の表示",
      "level": 2,
      "content": "localectl status を使って、キーボード設定を表示することができます。\n\n"
    },
    {
      "title": "キーマップ",
      "level": 2,
      "content": "キーマップファイルは、/usr/share/kbd/keymaps/ ディレクトリツリーに格納されています。通常、一つのキーマップファイルは、一つのキーボードレイアウトに対応しています。(include 文を使用して共通部分を共有したり、キーマップファイルに複数のレイアウトと切り替え用のキーの組み合せを含めることができます)。詳細は、keymaps(5) を参照してください。\n\n"
    },
    {
      "title": "キーマップの一覧表示",
      "level": 3,
      "content": "コンソールキーマップの命名規則は多少恣意的ですが、通常以下がベースとなっています:\n\n- 言語コード: 言語コードが国名コードと同じ場合 (例: ドイツ語は de 、フランス語は fr)。\n- 国名コード: 同じ言語のバリエーションが異なる国々で使用されている場合 (例: 英国では uk、米国では us)。国名コードのリストは wikipedia:ISO 3166-1#Officially assigned code elements でも見られます。\n- キーボードレイアウト: レイアウトが、特定の国や言語に関連していない場合 (例: Dvorak 配列 は dvorak)。\n\n利用可能なすべてのキーマップを一覧表示するには、以下のコマンドを使用してください:\n\n```\n$ localectl list-keymaps\n```\n\nキーマップを検索するには、以下のコマンドを使用してください。search_term はあなたの言語、国、レイアウトのどれかのコードに置き換えてください:\n\n```\n$ localectl list-keymaps | grep -i search_term\n```\n\nあるいは、find を使ってください:\n\n```\n$ find /usr/share/kbd/keymaps/ -type f -name \"*search_term*\"\n```\n\n"
    },
    {
      "title": "Loadkeys",
      "level": 3,
      "content": "現在のセッションでのみ有効なキーマップを設定することもできます。異なるキーマップを試したり、問題を解決したりするときに有用です。\n\n一時的な設定を行うには loadkeys ツールを使います。このツールは、/etc/vconsole.conf に設定されたキーマップをロードするために systemd によって内部的に使用されています。とても簡単に使えます:\n\n```\n# loadkeys keymap\n```\n\n詳しくは loadkeys(1) を参照してください。\n\n"
    },
    {
      "title": "永続的な設定",
      "level": 3,
      "content": "永続的なキーマップは /etc/vconsole.conf で設定することができ、起動時に systemd によって読み込まれます。KEYMAP 変数がキーマップの指定に使用されます。この変数が空だったり設定されていない場合、デフォルトの値として us キーマップが使われます。全てのオプションは vconsole.conf(5) を見て下さい。例:\n\n```\n/etc/vconsole.conf\n```\n\n```\nKEYMAP=uk\n```\n\nlocalectl を使ってコンソールのキーマップを設定することも可能です。コマンドを実行することで /etc/vconsole.conf 内の KEYMAP 変数が変更され現在のセッションのキーマップが設定されます:\n\n```\n# localectl set-keymap --no-convert keymap\n```\n\n--no-convert オプションを使用することで、localectl が自動的に Xorg のキーマップを最も近いものに変更してしまうのを防ぐことができます。詳細は localectl(1) を見てください。\n\n必要であれば、keymap mkinitcpio フック を使って /etc/vconsole.conf のキーマップを初期ユーザ空間で読み込むことができます。\n\n- カスタムのキーマップを /usr/share/kbd/keymaps/ 以外の場所に保存した場合、そのファイルを絶対パスで vconsole.conf で指定するか、上記の localectl コマンドを使用する際に指定する必要があります。\n- /etc/vconsole.conf 内の XKB* 変数は Xorg/キーボード設定 のためのものです。loadkeys はまだ、これらの変数の使用をサポートしていません; kbd issue 72 を参照してください。そして、Xorg もこれらをサポートしていません。\n\n"
    },
    {
      "title": "カスタムキーマップの作成",
      "level": 3,
      "content": "コンソールを使用する場合、ホットキーを使用して特定の文字を表示できます。 さらに、文字のシーケンスといくつかのエスケープシーケンスを表示することもできます。 したがって、コマンドを構成する文字のシーケンスを出力し、その後に改行のエスケープ文字を出力すると、そのコマンドが実行されます。\n\nこれを行う1つの方法は、キーマップファイルを編集することです。 ただし、それが属するパッケージが更新されるたびに書き換えられるため、このファイルを編集することはお勧めしません。 既存のキーマップを個人のキーマップと統合することをお勧めします。 loadkeys ユーティリティはこれを行うことができます。\n\nまず、キーマップファイルを作成します。 このキーマップファイルはどこにあってもかまいませんが、1つの方法は、/usr/local のディレクトリ階層を模倣することです。/usr/local/share/kbd/keymaps ディレクトリを作成し、/usr/local/share/kbd/keymaps/personal.map を編集してください。\n\nちなみに、このような個人用キーマップは、デフォルトのキーマップですでに扱われているキーの動作を再定義する場合にも役立ちます。loadkeys をロードすると、それらが新しい命令と競合する場合はデフォルトキーマップの命令が置き換えられ 、それ以外の場合はそのまま保持されます。 このように、そのキーマップへの変更のみをパーソナルキーマップで指定する必要があります。\n\n- /usr/share/kbd/keymaps/ ディレクトリツリーにある既存のキーマップを編集することもできます。 キーマップには .map.gz 拡張子が付いています。たとえば、us.map.gz は米国のキーマップです。キーマップを /usr/local/share/kbd/keymaps/personal.map.gz にコピーし、それを gunzip してください。\n- カスタムのキーマップは、/etc/vconsole.conf で設定することにより永続化させることができます。このため、keymap ではなく sd-vconsole mkinitcpio フックを使う場合、カスタムのキーマップファイルを /usr/share/kbd/keymaps/ に置くとよいでしょう。この方法では、/usr/share/kbd/keymaps の依存関係がフックによって初期 RAM ディスクイメージに自動的に追加されます。一方、カスタムのキーマップファイルを /usr/local/ に置いた場合、依存関係は mkinitcpio.conf の FILES 配列で手動で指定する必要があります。\n\n"
    },
    {
      "title": "命令を追加する",
      "level": 4,
      "content": "このパーソナルキーマップには、2種類の命令が必要です。 まず、keycode 命令、これは、デフォルトのキーマップに表示される形式と一致します。 これらの命令は、キーコードを keysym に関連付けます。 Keysym はキーボードアクションを表します。 使用可能なアクションには、文字コードまたは文字シーケンスの出力、コンソールまたはキーマップの切り替え、マシンの起動、およびその他の多くのアクションが含まれます。 現在アクティブな完全なキーマップは、次のコマンドで取得できます:\n\n```\n# dumpkeys -l\n```\n\nほとんどの keysym は直感的です。 たとえば、キー112でもって 'e' を出力するように設定するには、命令は次のようになります:\n\n```\nkeycode 112  = e\n```\n\nキー112でもってユーロ記号を出力するように設定するには、ディレクティブは次のようになります:\n\n```\nkeycode 112 = euro\n```\n\n一部の keysym は、キーボードアクションにすぐには接続されません。 特に、大文字のFと30より大きい数からなる1〜3桁の数字(F1〜F246)が前に付いたキー記号は、常にフリーです。 これは、一連の文字やその他のアクションを出力するようにホットキーに指示するのに便利です:\n\n```\nkeycode 112 = F70\n```\n\n次に、F70をバインドして特定の文字列を出力できます:\n\n```\nstring F70 = \"Hello\"\n```\n\nキー112を押すと、F70の内容が出力されます。 ターミナルに表示されたコマンドを実行するには、コマンド文字列の最後に改行エスケープ文字を追加する必要があります。 たとえば、システムを休止状態にするためには、次のキーマップを追加します:\n\n```\nstring F70 = \"sudo systemctl hibernate\\n\"\n```\n\n"
    },
    {
      "title": "その他の例",
      "level": 4,
      "content": "- (Emacs用に)右Altキーを左Altキーと同じにするには、キーマップで次の行を使用します。 これはファイル/usr/share/kbd/keymaps/i386/include/linux-with-two-alt-keys.incをインクルードします。詳細については、チェックしてください。\n\n```\ninclude \"linux-with-two-alt-keys\"\n```\n\n- (Vim用に)CapsLockをEscapeと交換するには、それぞれのキーコードを再マップします。\n\n```\nkeycode 1 = Caps_Lock\nkeycode 58 = Escape\n```\n\n- CapsLockをもうひとつののコントロールキーにするには、それぞれのキーコードを再マップします。\n\n```\nkeycode 58 = Control\n```\n\n- CapsLock と左コントロールを交換するには、それぞれのキーコードをリマップします。\n\n```\nkeycode 29 = Caps_Lock\nkeycode 58 = Control\n```\n\n"
    },
    {
      "title": "変更を保存する",
      "level": 4,
      "content": "これらのパーソナルキーマップを使用するには、loadkeys によってロードする必要があります。\n\n```\n# loadkeys /usr/local/share/kbd/keymaps/personal.map\n```\n\nただし、このキーマップは現在のセッションでのみアクティブになります。起動時にキーマップをロードするには、/etc/vconsole.confの KEYMAP 変数でファイルへのフルパスを指定します。 kbd が提供する公式キーマップにようにファイルを gzip で圧縮する必要はありません。\n\n"
    },
    {
      "title": "オートリピートの遅延と速度の調整",
      "level": 2,
      "content": "オートリピート遅延 (タイプマチック遅延とも) はキーリピートを始めるのにキーを押し続ける必要がある時間 (典型的にはミリ秒) を表します。キーリピートが開始されると、オートリピート速度 (タイプマチック速度とも) によって指定された頻度 (通常 Hz) で文字が繰り返されます。これらの値は kbdrate コマンドを使うことで変更できます。これらの設定はコンソールと Xorg で別々に設定されることに注意してください。\n\n```\n# kbdrate [-d delay] [-r rate]\n```\n\n例えばオートリピート遅延を 200ms にオートリピート速度を 30Hz に設定するには、次のコマンドを実行します:\n\n```\n# kbdrate -d 200 -r 30\n```\n\n遅延や速度の値を指定しないでコマンドを実行することでこれらの値をデフォルト (遅延は 250ms で速度は 11Hz) に戻すことができます:\n\n```\n# kbdrate\n```\n\n"
    },
    {
      "title": "Systemd サービス",
      "level": 3,
      "content": "systemd サービスを使ってオートリピート速度を設定することもできます。例:\n\n```\n/etc/systemd/system/kbdrate.service\n```\n\n```\n[Unit]\nDescription=Keyboard repeat rate in tty.\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nStandardInput=tty\nStandardOutput=tty\nExecStart=/usr/bin/kbdrate --silent --delay 250 --rate 30\n \n[Install]\nWantedBy=multi-user.target\n```\n\nそして、kbdrate.service systemd サービスを起動/有効化してください。\n\n"
    }
  ]
}