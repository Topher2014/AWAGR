{
  "title": "GPT fdisk (Русский)",
  "url": "https://wiki.archlinux.org/title/GPT_fdisk_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Ссылки по теме\n\n- Разметка дисков\n- fdisk (Русский)\n- Parted (Русский)\n- dd (Русский)\n\nGPT fdisk состоит из программ gdisk, cgdisk, sgdisk и fixparts. Они представляет собой набор инструментов для разметки диска, созданный Родом Смитом. Они работают с таблицами разделов GUID (GUID Partition Table, GPT), а не со старыми (но всё ещё распространёнными) таблицами разделов главной загрузочной записи (Master Boot Record, MBR).\n\ngdisk, cgdisk и sgdisk имеют одинаковую функциональность, но предоставляют разные пользовательские интерфейсы. gdisk — текстовый и интерактивный режим, sgdisk — режим командной строки, и cgdisk — интерфейс на основе curses. Эта статья охватывает утилиты gdisk(8) и sgdisk(8).\n\n- Для базовых функций разметки можно использовать cgdisk(8) с текстовым пользовательским интерфейсом.\n- На сайте GPT fdisk есть подробные пошаговые инструкции для gdisk, cgdisk, sgdisk и FixParts.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "Установите пакет gptfdisk.\n\n"
    },
    {
      "title": "Список разделов",
      "level": 2,
      "content": "Чтобы просмотреть таблицы разделов и разделы на блочном устройстве, вы можете запустить gdisk, указав устройство (например: /dev/sda, /dev/nvme0n1, /dev/mmcblk0 и т. д.):\n\n```\n# gdisk -l /dev/sda\n```\n\nили с помощью sgdisk:\n\n```\n# sgdisk -p /dev/sda\n```\n\n"
    },
    {
      "title": "Резервное копирование и восстановление таблицы разделов",
      "level": 2,
      "content": "Перед внесением изменений в диск вы можете сделать резервную копию таблицы разделов и схемы разделов диска. Вы также можете использовать резервную копию, чтобы скопировать одну и ту же структуру разделов на несколько дисков.\n\nИспользуя sgdisk, вы можете создать двоичную резервную копию, состоящую из защитной MBR, основного заголовка GPT, резервного заголовка GPT и одной копии таблицы разделов. В приведённом ниже примере таблица разделов /dev/sda сохраняется в файл sgdisk-sda.bin:\n\n```\n# sgdisk -b=sgdisk-sda.bin /dev/sda\n```\n\nПозже вы можете восстановить резервную копию, запустив:\n\n```\n# sgdisk -l=sgdisk-sda.bin /dev/sda\n```\n\nЕсли вы хотите клонировать структуру разделов вашего текущего устройства (/dev/sda в данном случае) на другой диск (/dev/sdc), выполните:\n\n```\n# sgdisk -R=/dev/sdc /dev/sda\n```\n\nЕсли оба диска будут на одном компьютере, вам необходимо рандомизировать GUID диска и разделов:\n\n```\n# sgdisk -G /dev/sdc\n```\n\n"
    },
    {
      "title": "Создание таблицы разделов и самих разделов",
      "level": 2,
      "content": "Первый шаг в разметке диска — создание таблицы разделов. После этого создаются собственно разделы в соответствии с желаемой схемой разметки.\n\nПеред началом вы можете сделать резервную копию вашей текущей таблицы разделов и схемы.\n\nНиже показано, как использовать gdisk для выполнения как создания таблицы разделов, так и создания фактических разделов. Также вы можете использовать основанную на curses версию cgdisk, однако следующие инструкции к ней неприменимы. Смотрите cgdisk(8) для её использования.\n\ngdisk автоматически выполняет выравнивание по 2048 512-байтовым секторам (1 МиБ) что должно быть совместимо со всеми расширенными форматами HDD и подавляющим большинством SSD.\n\nЧтобы использовать gdisk, запустите программу с именем блочного устройства, которое вы хотите изменить. В этом примере используется /dev/sda:\n\n```\n# gdisk /dev/sda\n```\n\n"
    },
    {
      "title": "Создание новой таблицы",
      "level": 3,
      "content": "- Перед разметкой NVMe-накопителей и жёстких дисков с расширенным форматом (Advanced Format) проверьте, что они используют оптимальный логический размер сектора.\n- Перед разметкой SSD рекомендуется выполнить сброс ячеек памяти.\n\nЧтобы создать новую таблицу разделов GUID и стереть все текущие разделы, напишите o в строке. Пропустите этот шаг, если нужная вам таблица уже создана.\n\n"
    },
    {
      "title": "Создание разделов",
      "level": 3,
      "content": "Создайте новый раздел с помощью команды n. Введите номер раздела, первый сектор, последний сектор и тип раздела.\n\n"
    },
    {
      "title": "Номер раздела",
      "level": 4,
      "content": "Номер раздела — это номер, присвоенный разделу, например, раздел с номером 1 будет иметь путь /dev/sda1 на накопителе /dev/sda, /dev/nvme0n1p1 на /dev/nvme0n1 и /dev/mmcblk0p1 на /dev/mmcblk0. Номера разделов могут не совпадать с реальным порядком разделов на диске, в этом случае их можно отсортировать.\n\nРекомендуется использовать номер по умолчанию, который предложит gdisk.\n\n"
    },
    {
      "title": "Первый и последний сектор",
      "level": 4,
      "content": "Первый и последний сектор раздела могут быть указаны в виде номеров секторов или в виде позиций, измеряемых в кибибайтах (K), мебибайтах (M), гибибайтах (G), тебибайтах (T) или пебибайтах (P).\n\nПозиция может быть задана:\n\n- в абсолютном выражении от начала диска. Например, 40M в качестве первого сектора указывает позицию 40 МиБ от начала диска.\n- в относительном выражении, предваряя размер символами +размер или -размер. Например, +2G указывает на позицию через 2 ГиБ после сектора, предложенного по умолчанию, а -200M указывает на позицию 200 МиБ перед последним доступным сектором.\n\nНажатие Enter без ввода значения использует значение по умолчанию, которое является началом самого большого доступного блока для первого сектора и концом того же блока для последнего сектора.\n\n"
    },
    {
      "title": "Тип раздела",
      "level": 4,
      "content": "Выберите тип раздела, введя внутренний код gdisk или указав GUID типа раздела вручную. Значение по умолчанию Linux filesystem (GUID 0FC63DAF-8483-4772-8E79-3D69D8477DE4, внутренний код gdisk 8300) должно быть подходящим для большинства случаев.\n\n- Введите L для просмотра списка внутренних кодов gdisk.\n- Рекомендуется следовать Discoverable Partitions Specification, поскольку systemd-gpt-auto-generator(8) будет монтировать их автоматически. Смотрите #Отключение автоматического монтирования раздела GPT, если вы хотите отключить автоматическое монтирование для раздела.\n\nTable content:\nТип раздела | Точка монтирования | код gdisk | GUID типа раздела\nФайловая система Linux | Любая | 8300 | 0FC63DAF-8483-4772-8E79-3D69D8477DE4\nСистемный раздел EFI | Любая1 | ef00 | C12A7328-F81F-11D2-BA4B-00A0C93EC93B\nЗагрузочный раздел BIOS | Нет | ef02 | 21686148-6449-6E6F-744E-656564454649\nLinux x86-64 корень (/) | / | 8304 | 4F68BCE3-E8CD-4DB1-96E7-FBCAF984B709\nLinux подкачка | [SWAP] | 8200 | 0657FD6D-A4AB-43C4-84E5-0933C84B4F4F\nLinux /home | /home | 8302 | 933AC7E1-2EB4-4F13-B844-0E14E2AEF915\nLinux /srv | /srv | 8306 | 3B8F8425-20E0-4F3B-907F-1A25A76F98E8\nLinux /var | /var1 | 8310 | 4D21B016-B534-45C2-A9FB-5C16E091FD2D\nLinux /var/tmp | /var/tmp1 | 8311 | 7EC6F557-3BC5-4ACA-B293-16EF5DF639D1\nLinux LVM | Любая | 8e00 | E6D6D379-F507-44C2-A23C-238F2A3DF928\nLinux RAID | Любая | fd00 | A19D880F-05FC-4D3B-A006-743F0F84911E\nLinux LUKS | Любая | 8309 | CA7D7CCB-63ED-4C53-861C-1742536059CC\nLinux dm-crypt | Любая | 8308 | 7FFEC5C9-2D00-49B7-8941-3EA10A5586B7\n\n1. systemd-gpt-auto-generator(8) будет автоматически монтировать раздел только при выполнении определённых условий. Подробнее смотрите systemd (Русский)#Автомонтирование GPT-раздела.\n\nПовторяйте эту процедуру, пока не получите желаемые разделы.\n\n"
    },
    {
      "title": "Запись изменений на диск",
      "level": 3,
      "content": "Для записи новой таблицы на диск и выхода используйте команду w.\n\n"
    },
    {
      "title": "Преобразование между MBR и GPT",
      "level": 3,
      "content": "gdisk, sgdisk и cgdisk способны преобразовывать диски MBR и BSD disklabels в GPT без потери данных. После преобразования все первичные и логические разделы MBR становятся разделами GPT с правильными GUID типов разделов и уникальными GUID разделов.\n\nПосле преобразования потребуется переустановить загрузчик, чтобы настроить его на загрузку с GPT.\n\n- GPT хранит вторичную таблицу в конце диска. По умолчанию эта структура данных занимает 33 сектора по 512 байт (16,5 КиБ). MBR не имеет подобной структуры данных в конце диска, поэтому последний раздел на диске MBR иногда простирается до самого конца диска и не позволяет выполнить полное преобразование. Если это произошло, необходимо отказаться от преобразования и изменить размер последнего раздела.\n- Известны проблемы с повреждением резервной копии GPT на ноутбуках с чипсетом Intel, работающих в режиме RAID. Решением является использование AHCI вместо RAID, если это возможно.\n\nДля преобразования таблицы разделов MBR в GPT с помощью sgdisk используйте опцию -g/--mbrtogpt:\n\n```\n# sgdisk -g /dev/sda\n```\n\nДля преобразования GPT в MBR используйте опцию -m/--gpttombr. Имейте в виду, что преобразовать более четырёх разделов из GPT в MBR невозможно.\n\n```\n# sgdisk -m /dev/sda\n```\n\n"
    },
    {
      "title": "Сортировка разделов",
      "level": 3,
      "content": "В ситуации, когда, например, новый раздел создаётся между двумя существующими или раздел удаляется, нумерация разделов может перестать соответствовать их реальному расположению на диске, и для исправления можно выполнить сортировку. В этом примере используется /dev/sda.\n\n```\n# sgdisk -s /dev/sda\n```\n\nЕсли вы не используете постоянные имена для блочных устройств, то вам может понадобиться обновить файлы конфигурации, в которых используется нумерация разделов, в частности /etc/fstab и/или /etc/crypttab.\n\n"
    },
    {
      "title": "Восстановление заголовка GPT",
      "level": 3,
      "content": "Если основной или резервный заголовок GPT оказался повреждён, можно восстановить его из сохранившегося заголовка с помощью gdisk. В данном примере используется /dev/sda.\n\n```\n# gdisk /dev/sda\n```\n\nВыберите r для опций восстановления и преобразования (только для экспертов). Далее выберите\n\n- b: использовать резервный заголовок GPT (воссоздать основной)\n- d: использовать основной заголовок GPT (воссоздать резервный)\n\nПосле этого используйте команду w для записи новой таблицы на диск и выхода.\n\n"
    },
    {
      "title": "Расширение диска GPT",
      "level": 3,
      "content": "После увеличения диска (например, в аппаратном RAID-массиве или на диске виртуальной машины) вновь добавленное место можно будет использовать не сразу, так как GPT хранит свои данные в конце диска. Необходимо переместить резервный заголовок GPT в новый конец диска.\n\nЗапустите sgdisk с опцией -e/--move-second-header, например:\n\n```\n# sgdisk -e /dev/sda\n```\n\nПосле этого посмотрите список разделов, и вы должны увидеть появившееся свободное место.\n\n"
    },
    {
      "title": "Отключение автоматического монтирования раздела GPT",
      "level": 3,
      "content": "systemd-gpt-auto-generator(8) будет автоматически монтировать разделы в соответствии с Discoverable Partitions Specification. Иногда это нежелательно.\n\nАвтоматическое монтирование можно отключить путём добавления атрибута раздела 63 («do not automount»).\n\nЗапустите gdisk, например:\n\n```\n# gdisk /dev/sda\n```\n\nВведите p для просмотра списка разделов и посмотрите номера разделов, для которых вы хотите отключить автоматическое монтирование.\n\nВведите x (экспертные команды).\n\nВведите a — команду установки атрибута. Введите номер нужного раздела и затем номер атрибута 63. После этого под строкой Set fields are: должно появиться 63 (do not automount). Нажмите Enter для завершения изменения атрибутов. Повторите этот шаг для всех нужных разделов.\n\nПосле завершения используйте команду w для записи новой таблицы на диск и выхода.\n\nТакже можно использовать sgdisk с опцией -A/--attributes=; смотрите sgdisk(8). Например, для установки атрибута 63 разделу /dev/sda2 выполните:\n\n```\n# sgdisk -A 2:set:63 /dev/sda\n```\n\n"
    },
    {
      "title": "EFI-приложение gdisk",
      "level": 3,
      "content": "Его нет в пакетах, но Род Смит предоставляет собранное бинарное приложение EFI на SourceForge. Скачайте gdisk-efi-*.zip и распакуйте архив. Для использования скопируйте gdisk_x64.efi в системный раздел EFI и запустите его с помощью вашего загрузчика или через UEFI Shell.\n\ngdisk_x64.efi позволяет редактировать таблицу разделов ещё до загрузки операционной системы. Он используется так же, как и двоичный файл gdisk в Linux.\n\nСмотрите README-efi.txt для более подробной информации.\n\n"
    },
    {
      "title": "Смотрите также",
      "level": 2,
      "content": "- GPT fdisk Tutorial - официальный сайт GPT fdisk.\n- Страница GPT fdisk на SourceForge\n\n"
    }
  ]
}