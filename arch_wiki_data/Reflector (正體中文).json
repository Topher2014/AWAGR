{
  "title": "Reflector (正體中文)",
  "url": "https://wiki.archlinux.org/title/Reflector_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **本條目或段落需要進行翻譯。** 本條目或段落需要進行翻譯。\n\n本條目或段落需要進行翻譯。\n\n相關文章\n\n- Mirrors\n- Pacman\n\nReflector 是一個腳本程式，它可以從 MirrorStatus 頁面獲得最新的鏡像列表，過濾最新的鏡像，按速度排序，並且覆蓋 /etc/pacman.d/mirrorlist 文件。\n\n"
    },
    {
      "title": "安裝",
      "level": 2,
      "content": "安裝 reflector 軟體包。\n\n"
    },
    {
      "title": "用法",
      "level": 2,
      "content": "- 在下面的例子中， /etc/pacman.d/mirrorlist 將被覆寫。執行之前請先進行備份。\n- 同步或更新 Pacman 之前，確保生成的 /etc/pacman.d/mirrorlist 中沒有你認為不信任的條目。\n\n執行下面的命令以查看所有可用的命令：\n\n```\n# reflector --help\n```\n\n"
    },
    {
      "title": "範例",
      "level": 3,
      "content": "以下載速度對最近同步的五個鏡像評分與排序，並覆蓋 /etc/pacman.d/mirrorlist 文件：\n\n```\n# reflector --verbose --latest 5 --sort rate --save /etc/pacman.d/mirrorlist\n```\n\n選擇200個最近同步的 HTTP 或 HTTPS 鏡像，依下載速度排序，並覆蓋 /etc/pacman.d/mirrorlist 文件：\n\n```\n# reflector --latest 200 --protocol http --protocol https --sort rate --save /etc/pacman.d/mirrorlist\n```\n\n選擇12小時內同步並且位於法國或德國的 HTTPS 鏡像，依下載速度排序，並覆蓋 /etc/pacman.d/mirrorlist 文件：\n\n```\n# reflector --country France --country Germany --age 12 --protocol https --sort rate --save /etc/pacman.d/mirrorlist\n```\n\n"
    },
    {
      "title": "Pacman hook",
      "level": 3,
      "content": "你可以建立一個 pacman hook 執行 reflector ，並在每次 pacman-mirrorlist 升級時刪除建立的 .pacnew 文件。\n\n```\n/etc/pacman.d/hooks/mirrorupgrade.hook\n```\n\n```\n[Trigger]\nOperation = Upgrade\nType = Package\nTarget = pacman-mirrorlist\n\n[Action]\nDescription = Updating pacman-mirrorlist with reflector and removing pacnew...\nWhen = PostTransaction\nDepends = reflector\nExec = /bin/sh -c \"reflector --country 'United States' --latest 200 --age 24 --sort rate --save /etc/pacman.d/mirrorlist; rm -f /etc/pacman.d/mirrorlist.pacnew\"\n```\n\n請確保用你要的參數代替 reflector 。\n\n"
    },
    {
      "title": "Systemd service",
      "level": 3,
      "content": "下面是服務單元等待網路連線後再執行 reflector 的例子：\n\n```\n/etc/systemd/system/reflector.service\n```\n\n```\n[Unit]\nDescription=Pacman mirrorlist update\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/reflector --protocol https --latest 30 --number 20 --sort rate --save /etc/pacman.d/mirrorlist\n\n[Install]\nRequiredBy=multi-user.target\n```\n\n啟動 reflector.service 將更新鏡像列表。要在每次開機時更新鏡像列表，請 啟用 此服務。\n\n"
    },
    {
      "title": "Systemd timer",
      "level": 3,
      "content": "假如你想每週執行 reflector.service ，請建立一個相關的 .timer 。舉例來說：\n\n```\n/etc/systemd/system/reflector.timer\n```\n\n```\n[Unit]\nDescription=Run reflector weekly\n\n[Timer]\nOnCalendar=Mon *-*-* 7:00:00\nRandomizedDelaySec=15h\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n```\n\n然後直接 啟動 reflector.timer 。\n\n"
    }
  ]
}