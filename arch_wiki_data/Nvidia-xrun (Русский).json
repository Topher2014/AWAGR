{
  "title": "Nvidia-xrun (Русский)",
  "url": "https://wiki.archlinux.org/title/Nvidia-xrun_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Nvidia-xrun — утилита, запускающая X сервер, используя дискретный графический процессор NVIDIA, на ноутбуках с поддержкой NVIDIA Optimus. Это решение предлагает полное использование GPU, а также повышенные совместимость и производительность.\n\nX сервер работает либо с интегрированным, либо с дискретным графическим процессором, но не с обоими сразу. Для использования другой видеокарты переключитесь на отдельную виртуальную консоль и запустите еще один X сервер.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "Note: **This article or section is out of date.** This article or section is out of date.\n\nThis article or section is out of date.\n\nУстановите:\n\n- nvidia\n- bbswitch\n- nvidia-xrunAUR, nvidia-xrun-gitAUR или nvidia-xrun-pmAUR, если bbswitch не поддерживает ваше оборудование [1]\n- Оконный менеджер, например, openbox или xfce4-session, так как запуск приложений напрямую с помощью nvidia-xrun работает некорректно.\n\n- или nvidia-xrun-pmAUR, если bbswitch не поддерживает ваше оборудование [1]\n\n"
    },
    {
      "title": "Установка корректного идентификатора шины",
      "level": 3,
      "content": "Найдите ID шины вашего дисплея:\n\n```\n$ lspci | grep -i nvidia | awk '{print $1}'\n```\n\nВыход будет аналогичен этому примеру: 01:00.0.\n\nПосле чего создайте файл, например, /etc/X11/nvidia-xorg.conf.d/30-nvidia.conf, для установки правильного ID шины:\n\n```\n/etc/X11/nvidia-xorg.conf.d/30-nvidia.conf\n```\n\n```\nSection \"Device\"\n    Identifier \"nvidia\"\n    Driver \"nvidia\"\n    BusID \"PCI:1:0:0\"\nEndSection\n```\n\nТакже можете изменить настройки NVIDIA, если возникли проблемы:\n\n```\n/etc/X11/nvidia-xorg.conf.d/30-nvidia.conf\n```\n\n```\nSection \"Screen\"\n    Identifier \"nvidia\"\n    Device \"nvidia\"\n    #  Option \"AllowEmptyInitialConfiguration\" \"Yes\"\n    #  Option \"UseDisplayDevice\" \"none\"\nEndSection\n```\n\n"
    },
    {
      "title": "Автоматический запуск оконного менеджер",
      "level": 3,
      "content": "Для удобства можете создать файл ~/.nvidia-xinitrc для запуска openbox:\n\n```\nif [ $# -gt 0 ]; then\n  $*\nelse\n  openbox-session\n  # Alternatively, you can also use xfce4:\n  # xfce4-session\nfi\n```\n\nТогда не придётся указывать приложение, просто выполните команду:\n\n```\n$ nvidia-xrun\n```\n\n"
    },
    {
      "title": "Использование bbswitch для управления картой NVIDIA",
      "level": 3,
      "content": "Когда карта NVIDIA не нужна, для отключения используется bbswitch. Скрипт nvidia-xrun автоматически позаботится о запуске оконного менеджера и включения карты NVIDIA. Для этого следует:\n\n- Загрузить модуль bbswitch при включении:\n\n```\n# echo 'bbswitch ' > /etc/modules-load.d/bbswitch.conf\n```\n\n- Отключить модуль nvidia при включении:\n\n```\n# echo 'options bbswitch load_state=0 unload_state=1' > /etc/modprobe.d/bbswitch.conf\n```\n\nПосле перезагрузки видеокарта NVIDIA будет отключена. Чтобы это увидеть, проверьте статус bbswitch:\n\n```\n$ cat /proc/acpi/bbswitch\n```\n\nДля принудительно включения или выключения видеокарты, выполните:\n\n```\n# tee /proc/acpi/bbswitch <<<ON\n # tee /proc/acpi/bbswitch <<<OFF\n```\n\nПодробнее о bbswitch смотрите в Bumblebee-Project/bbswitch.\n\n"
    },
    {
      "title": "Использование",
      "level": 2,
      "content": "После загрузки системы войдите в пользователя с виртуальной консоли и выполните nvidia-xrun <приложение>.\n\nЕсли способ выше не работает, переключитесь на неиспользуемую виртуальную консоль и попробуйте снова.\n\nКак упоминалось ранее, запуск приложений напрямую с помощью nvidia-xrun <application> не работает как следует, поэтому лучше создать ~/.nvidia-xinitrc, как описано выше, и использовать nvidia-xrun для запуска оконного менеджера.\n\n"
    },
    {
      "title": "Графический процессор NVIDIA не отключается или устанавливается по умолчанию",
      "level": 3,
      "content": "Если графический процессор NVIDIA по-прежнему не отключается или устанавливается по умолчанию, то придётся занести в чёрный список модули, приведённые ниже. Создайте этот файл и перезапустите систему:\n\n```\n/usr/lib/modprobe.d/nvidia-xrun.conf\n```\n\n```\nblacklist nvidia\nblacklist nvidia-drm\nblacklist nvidia-modeset\nblacklist nvidia-uvm\nblacklist nouveau\n```\n\nУбедитесь, что DRM Kernel Mode Setting отключен. См. NVIDIA (Русский)#DRM kernel mode setting и Kernel mode setting (Русский) для получения более подробной информации.\n\n"
    }
  ]
}