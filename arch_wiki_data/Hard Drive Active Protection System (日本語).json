{
  "title": "Hard Drive Active Protection System (日本語)",
  "url": "https://wiki.archlinux.org/title/Hard_Drive_Active_Protection_System_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "ハードディスクアクティブプロテクションシステム (Hard Drive Active Protection System, HDAPS) はハードドライブを突然の衝撃から保護します (ノートパソコンを机から落としたりバンバン叩いたりするなど)。ディスクのヘッドを停止することで、衝撃によってドライブのプラッタにぶつからないようにすることで保護します。これによって致命的な問題が発生するのを防ぎます。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 衝撃検出 1.1 tp_smapi 1.2 Invert モジュールパラメータ\n- 2 衝撃保護 2.1 hdapsd\n- 3 GUI ユーティリティ 3.1 gnome-hdaps-applet 3.2 kdeplasma-applets-hdaps-monitor 3.3 xfce4-hdaps 3.4 HDAPSicon 3.5 hdaps-gl\n- 4 参照\n\n- 1.1 tp_smapi\n- 1.2 Invert モジュールパラメータ\n\n- 2.1 hdapsd\n\n- 3.1 gnome-hdaps-applet\n- 3.2 kdeplasma-applets-hdaps-monitor\n- 3.3 xfce4-hdaps\n- 3.4 HDAPSicon\n- 3.5 hdaps-gl\n\n"
    },
    {
      "title": "衝撃検出",
      "level": 2,
      "content": "ハードウェアが何らかの衝撃検出をサポートしている必要があります。ノートパソコンのマザーボードに加速度計などが搭載されていれば OK です。ハードウェアが検出に対応していたら、次に、ハードウェアが検出したものをオペレーティングシステムに伝える手段が必要になります。このセクションでは加速度計の状態を OS に伝えるドライバーについて説明します。ドライバーを使うことによって衝撃を検出して保護することが可能です。\n\n"
    },
    {
      "title": "tp_smapi",
      "level": 3,
      "content": "tp_smapi は ThinkPad ノートパソコンのドライバーのセットです。サポートされている ThinkPad を使っている場合、たとえ HDAPS を使う予定がなくても、ドライバーをインストールすることを強く推奨します。たくさんある便利なことの一つとして、tp_smapi は加速度計の出力をジョイスティックデバイス /dev/input/js# として表します。\n\ntp_smapi を community リポジトリからインストールしてください。インストール後、tp_smapi を /etc/modules-load.d/tp_smapi.conf ファイルに追加します (systemd を使っている場合)。再起動後、ドライバーが有効になって、/sys/devices/platform/smapi ファイルシステムで確認できます。\n\nカーネルには HDAPS ドライバーが初めから組み込まれています。以前は、デフォルトのドライバーがロードされないように /etc/rc.local から手動でモジュールを insmod する必要がありました。community の tp_smapi パッケージは hdaps.ko を /lib/modules/$(uname -r)/updates にインストールするため、内蔵のモジュールよりも優先して使われます。そのため、MODULES に hdaps を追加することが可能です。\n\n"
    },
    {
      "title": "Invert モジュールパラメータ",
      "level": 3,
      "content": "ThinkPad の中には、X・Y 回転軸を正しく扱うために invert モジュールパラメータを設定する必要があるものがあります。そのような場合、/etc/modprobe.d/modprobe.conf にオプションを追加します:\n\n```\noptions hdaps invert=1\n```\n\ninvert=1 は ThinkPad T410 で使用する値です。invert オプションには以下の値を設定できます:\n\n- invert=1 はX・Y 軸両方を反対にします。\n- invert=2 は X 軸を反対にします (既に反対になっている場合、元に戻します)。\n- invert=4 は X 軸と Y 軸を交換します (反対にする前に交換します)。\n\nNote that options can be summed. For instance, invert=5 swaps the axes and inverts them. The maximum value of invert is obviously 7. If you do not know which option is correct for you, just try them out with hdaps-gl or some other GUI (see below). Alternatively, you can determine the exact value for your thinkpad model from this table under the column labelled \"HDAPS axis orientation\".\n\nAs an alternative to reloading the hdaps module, the invert value can also be written directly to /sys/devices/platform/hdaps/invert.\n\n"
    },
    {
      "title": "衝撃保護",
      "level": 2,
      "content": "ハードウェアが検出した衝撃を OS に報告するようになったら、データを使って何かをする必要があります。このセクションではセンサーの出力を衝撃の保護に変えるソフトウェアユーティリティを説明します。\n\n"
    },
    {
      "title": "hdapsd",
      "level": 3,
      "content": "hdapsd は HDAPS ジョイスティックデバイスの出力を監視して衝撃が起こりそうなのを確認して、カーネルにディスクのヘッドを停止するように命令します。\n\nhdaps の設定を変更したときは SMART の \"Load cycle count\" をチェックするようにしてください。感度が高すぎてヘッドが頻繁に停止し、ロードサイクルカウントが跳ね上がることがあります。\n\nhdapsd をインストールしてください。hdapsd.service を使って hdapsd デーモンを起動できます。\n\nsystemd の記事で書かれているように、ユニットファイルを編集することで hdapsd の動作パラメータを調整することができます。例えば、以下のファイルは感度と hdapsd デーモンのログの挙動を変更します:\n\n```\n/etc/systemd/system/hdapsd.service.d/sensitivity.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=/usr/bin/hdapsd --sensitivity=40 -blp\n```\n\nその後、設定をリロードしてください。\n\n"
    },
    {
      "title": "GUI ユーティリティ",
      "level": 2,
      "content": "Utilities exist to monitor hdapsd's status so you know what is going on while you are using your laptop. These are entirely optional, but very handy.\n\n"
    },
    {
      "title": "gnome-hdaps-applet",
      "level": 3,
      "content": "ハードドライブの現在の状態を表示する GNOME パネルアプレットです。\n\nパッケージが AUR に存在します: gnome-hdaps-appletAUR[リンク切れ: アーカイブ: aur-mirror]。デフォルトでは sda や hda を監視したくない場合、コンパイルする前に PKGBUILD を編集してください。\n\n"
    },
    {
      "title": "kdeplasma-applets-hdaps-monitor",
      "level": 3,
      "content": "KDE4 には HDAPS を監視する plasmoid が存在します: HDAPS monitor。AUR の kdeplasma-applets-hdaps-monitorAUR パッケージでインストールできます。\n\n"
    },
    {
      "title": "xfce4-hdaps",
      "level": 3,
      "content": "ハードドライブの現在の状態を表示する Xfce4 のパネルアプレットです。AUR からインストールできます: xfce4-hdapsAUR。インストールしたら、アプレットをパネルに追加してください。\n\n"
    },
    {
      "title": "HDAPSicon",
      "level": 3,
      "content": "HDAPSicon (旧名 thinkhdaps)、HDAPS のディスク保護状態を表示するスタンドアロンの GTK アプレットです。通知エリアにアプレットアイコンが表示されます。AUR からインストールできます: hdapsicon-gitAUR。\n\n"
    },
    {
      "title": "hdaps-gl",
      "level": 3,
      "content": "Thinkpad の 3D アニメーションを表示するシンプルな OpenGL アプリケーションです。Lenovo が Windows で配布しているアプリケーションに似ています。AUR の hdaps-glAUR でインストールできます。\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- How to protect the harddisk through APS at ThinkWiki\n- HDAPS at ThinkWiki\n\n"
    }
  ]
}