{
  "title": "Bumblebee (Русский)",
  "url": "https://wiki.archlinux.org/title/Bumblebee_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Ссылки по теме\n\n- PRIME\n- Nvidia-xrun (Русский)\n- NVIDIA Optimus (Русский)\n- Nouveau (Русский)\n- NVIDIA (Русский)\n- Intel graphics (Русский)\n\nИз FAQ Bumblebee:\n\nBumblebee — решение, позволяющее задействовать NVIDIA Optimus в ноутбуках с GNU/Linux, что включает в себя два графических адаптера с двумя разными профилями энергопотребления, использующих общий фреймбуфер.\n\nNote: **This article or section needs expansion.** This article or section needs expansion.\n\nThis article or section needs expansion.\n\n"
    },
    {
      "title": "Bumblebee: Optimus для Linux",
      "level": 2,
      "content": "Optimus реализует технологию гибридной графики без аппаратного коммутатора. Интегрированная видеокарта выводит на экран,в то время,как дискретная видеокарта занимается рендерингом, который требует более высокой вычислительной мощности графического процессора. Технология NVIDIA Optimus дает большую производительность, сберегая при этом заряд батареи, подключая дискретный графический процессор, когда это требуется.\n\nBumblebee — программное решение, базирующееся на VirtualGL и драйверах ядра, позволяющее использовать дискретный GPU, не имеющий физического подключения к экрану.\n\nBumblebee реализует технологию Optimus в два шага:\n\n- Дискретная видеокарта производит рендеринг на виртуальном дисплее, в то время как выводом на экран занимается интегрированная видеокарта.\n- Дискретная видеокарта отключается от питания, когда ее вычислительная способность не требуется.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "Перед установкой Bumblebee убедитесь, что поддержка NVIDIA Optimus включена в настройках BIOS, а дисплей подключён к интегрированной видеокарте.\n\nУстановите:\n\n- bumblebee — Основной пакет, содержащий демон и клиентское ПО.\n- mesa — Свободную реализацию спецификации OpenGL.\n- Соответствующую версию драйвера NVIDIA, см. NVIDIA#Installation.\n- Опционально установите xf86-video-intel — драйвер Xorg (Русский) для Intel.\n\nТакже включите репозиторий multilib для поддержки 32-битных приложений и установите:\n\n- lib32-virtualgl — виртуальный дисплей для рендеринга в 32-битных приложениях.\n- lib32-nvidia-utils или lib32-nvidia-340xx-utilsAUR (должен соответствовать версии обычного драйвера NVIDIA).\n\nЧтобы использовать Bumblebee, необходимо добавить обычного пользователя в группу bumblebee:\n\n```\n# gpasswd -a user bumblebee\n```\n\nТакже включите службу bumblebeed.service, перезагрузите систему и см. раздел #Использование.\n\n"
    },
    {
      "title": "Тестирование",
      "level": 3,
      "content": "Протестируйте bumblebee:\n\n```\n$ optirun glxgears -info\n```\n\nЕсли это не сработало:\n\n```\n$ optirun glxspheres64\n```\n\n"
    },
    {
      "title": "Запуск программ",
      "level": 3,
      "content": "```\n$ optirun [options] application [application-options]\n```\n\nДля примера, запуск firefox с параметром 'www.yandex.ru':\n\n```\n$ optirun firefox www.yandex.ru\n```\n\nДля просмотра документации и всех опций optirun используйте следующую команду:\n\n```\n$ man optirun\n```\n\n"
    },
    {
      "title": "Настройка",
      "level": 2,
      "content": "Вы можете настраивать bumblebee под свои нужды, редактируя /etc/bumblebee/bumblebee.conf\n\n"
    },
    {
      "title": "Использование VirtualGL в качестве 'моста'",
      "level": 4,
      "content": "Bumblebee отрисовывает, используя дискретную видеокарту NVIDIA на виртуальном дисплее с помощью VirtualGL,а затем отрисовка происходит на 'реальном' дисплее, когда интегрированная видеокарта передает изображение на X Server. Для увеличения скорости передачи 'Виртуальный дисплей'->'X Server' можно использовать различные методы сжатия,вызывая optirun с опцией -c\n\n```\n$ optirun -c compress-method application [application-options]\n```\n\nМетоды со сжатием:\n\n- jpeg\n- rgb\n- yuv\n\nМетоды без сжатия\n\n- proxy\n- xv\n\nТаблица производительности с ASUS N550JV приложение для тестирования: unigine-heavenAUR:\n\nTable content:\nCommand | FPS | Score | Min FPS | Max FPS\noptirun unigine-heaven | 25.0 | 630 | 16.4 | 36.1\noptirun -c jpeg unigine-heaven | 24.2 | 610 | 9.5 | 36.8\noptirun -c rgb unigine-heaven | 25.1 | 632 | 16.6 | 35.5\noptirun -c yuv unigine-heaven | 24.9 | 626 | 16.5 | 35.8\noptirun -c proxy unigine-heaven | 25.0 | 629 | 16.0 | 36.1\noptirun -c xv unigine-heaven | 22.9 | 577 | 15.4 | 32.2\n\nДля использования метода сжатия по-умолчанию выставьте переменную VGLTransport c параметром compress-method в /etc/bumblebee/bumblebee.conf:\n\n```\n/etc/bumblebee/bumblebee.conf\n```\n\n```\n[...]\n[optirun]\nVGLTransport=proxy\n[...]\n```\n\n"
    },
    {
      "title": "Использование Primus",
      "level": 4,
      "content": "Primus позволяет увеличить производительность и энергосбережение за счет неиспользования VirtualGL. Преимущества Primus перед стандартным Optirun:\n\n- уменьшенное использование дополнительных ресурсов (увеличена частота кадров) и оптимизированное решение (без сетевых процессов или процессов сжатия)\n- отсутствие бага с преждевременным выключением GPU\n- более стабильный,нежели Optirun, а также более прост в отладке\n- дискретная видеокарта используется только для обработки OpenGL,вся остальная информация обрабатывается и хранится в интегрированном графическом процессоре\n\n- Для запуска 32-битных приложений на 64-битной машине понадобится пакет lib32-primus (Должен быть подключен Multilib (Русский))\n\nПример запуска glxspheres32:\n\n```\n$ primusrun glxspheres32\n```\n\nДля запуска приложения с ипользованием VirtualGL используйте:\n\n```\n$ optirun -b primus glxspheres32\n```\n\n"
    },
    {
      "title": "Энергосбережение",
      "level": 3,
      "content": "Для регулировки потребления энергии на десктопном ПК используется пакет bbswitch\n\nДля настройки включения и отключения видеокарты редактируйте опции load_state и unload_state. Подробнее смотрите BBSwitch-документация.\n\n```\n/etc/modprobe.d/bbswitch.conf\n```\n\n```\noptions bbswitch load_state=0 unload_state=1\n```\n\n"
    },
    {
      "title": "Некорректная инициализация запуска видеокарты NVIDIA",
      "level": 4,
      "content": "Если ваша видеокарта NVidia некорректно запускается после последнего выключения, то следует выставить опцию TurnCardOffAtExit=false в /etc/bumblebee/bumblebee.conf - видеокарта будет выключаться каждый раз после отключения демона bumblebee. Для того,чтобы видеокарта NVidia постоянно работала,следует включить соответствующий сервис:\n\n```\n# systemctl enable nvidia-enable.service\n```\n\n```\n/etc/systemd/system/nvidia-enable.service\n```\n\n```\n[Unit]\nDescription=Enable NVIDIA card\nDefaultDependencies=no\n\n[Service]\nType=oneshot\nExecStart=/bin/sh -c 'echo ON > /proc/acpi/bbswitch'\n\n[Install]\nWantedBy=shutdown.target\n```\n\nДля более подробного разбора всех возможностей Bumblebee посетите английскую ветку wiki: bumblebee\n\n"
    },
    {
      "title": "[VGL] ERROR: Could not open display :8",
      "level": 3,
      "content": "Проблема заключается в VirtualGL, в этом случае можно использовать primus\n\n```\n$ optirun -b primus wine windows program.exe\n```\n\nЕсли использование драйвера NVIDIA решило проблему,то отредактируйте файл /etc/bumblebee/xorg.conf.nvidia и измените опцию ConnectedMonitor на CRT-0.\n\n"
    },
    {
      "title": "Xlib: extension \"GLX\" missing on display \":0.0\"",
      "level": 3,
      "content": "Если вы установили видеодрайвер с сайта NVIDIA, то проделайте следующее:\n\n1. Удалите драйвер:\n\n```\n# ./NVIDIA-Linux-*.run --uninstall\n```\n\n2. Удалите сгенерированный NVIDIA конфигурационный файл Xorg:\n\n```\n# rm /etc/X11/xorg.conf\n```\n\n3. Установите корректный видеодрайвер — см. раздел #Установка.\n\n"
    },
    {
      "title": "[ERROR]Cannot access secondary GPU: No devices detected",
      "level": 3,
      "content": "В некоторых случаях запуск optirun возвращает сообщение об ошибке вида:\n\n```\n[ERROR]Cannot access secondary GPU - error: [XORG] (EE) No devices detected.\n[ERROR]Aborting because fallback start is disabled.\n```\n\nВ этом случае вам следует переместить файл /etc/X11/xorg.conf.d/20-intel.conf куда-нибудь в другое место,а затем перезапустите the bumblebeed демона и это должно сработать. Если же вам нужны настройки модулей Intel, то соедините файл /etc/X11/xorg.conf.d/20-intel.conf c /etc/X11/xorg.conf.\n\nЗакомментируйте строку Drive в /etc/X11/xorg.conf.d/10-monitor.conf.\n\nЕсли вы используете драйвер nouveau попробуйте поменять его на nvidia драйвер.\n\nВам требуется обозначить видеокарту (в конфигурационных файлах /etc/X11/xorg.conf.d), используя корректный BusID получив его выводом команды lspci;\n\n```\nSection \"Device\"\n    Identifier \"nvidiagpu1\"\n    Driver \"nvidia\"\n    BusID \"PCI:0:1:0\"\nEndSection\n```\n\n"
    },
    {
      "title": "NVIDIA(0): Failed to assign any connected display devices to X screen 0",
      "level": 4,
      "content": "Если консоль возвращает сообщения об ошибке вида:\n\n```\n[ERROR]Cannot access secondary GPU - error: [XORG] (EE) NVIDIA(0): Failed to assign any connected display devices to X screen 0\n[ERROR]Aborting because fallback start is disabled.\n```\n\nВы должны поменять эту строку в /etc/bumblebee/xorg.conf.nvidia:\n\n```\nOption \"ConnectedMonitor\" \"DFP\"\n```\n\nНа:\n\n```\nOption \"ConnectedMonitor\" \"CRT\"\n```\n\n"
    },
    {
      "title": "Failed to initialize the NVIDIA GPU at PCI:1:0:0 (GPU fallen off the bus / RmInitAdapter failed!)",
      "level": 4,
      "content": "Добавьте rcutree.rcu_idle_gp_delay=1 в параметры ядра из конфигурации загрузчика (подробнее BBS post для примера).\n\n"
    },
    {
      "title": "Could not load GPU driver",
      "level": 4,
      "content": "Если консоль возвращает сообщения об ошибке вида:\n\n```\n[ERROR]Cannot access secondary GPU - error: Could not load GPU driver\n```\n\nИ вы пробуете загрузить модуль nvidia, но получаете это:\n\n```\nmodprobe nvidia\nmodprobe: ERROR: could not insert 'nvidia': Exec format error\n```\n\nЭто происходит потому,что видеодрайвер не может синхронизироваться с ядром, к примеру,если вы установили последний драйвер nvidia, но не можете обновить ядро. Полное обновление системы поможет исправить эту проблему. Если проблема не ушла,то попробуйте вручную скомпилировать пакеты nvidia для своего ядра. Потребуются: nvidia-dkms или скомпилированный nvidia из ABS.\n\n"
    },
    {
      "title": "NOUVEAU(0): [drm] failed to set drm interface version",
      "level": 4,
      "content": "Примите во внимание то,что nouveau драйвер в стадии тестирования. Как написано тут: here, лучшим выходом будет - установка официального драйвера nvidia.\n\n"
    },
    {
      "title": "/dev/dri/card0: failed to set DRM interface version 1.4: Permission denied",
      "level": 3,
      "content": "Это можно решить, добавив в /etc/bumblebee/xorg.conf.nvidia несколько строк. (Подробнее тут):\n\n```\nSection \"Screen\"\n    Identifier \"Default Screen\"\n    Device \"DiscreteNvidia\"\nEndSection\n```\n\n"
    },
    {
      "title": "ERROR: ld.so: object 'libdlfaker.so' from LD_PRELOAD cannot be preloaded: ignored",
      "level": 3,
      "content": "Вы пытаетесь запустить 32-битное приложение. Решит проблему запуск приложения через primus\n\n"
    },
    {
      "title": "Fatal IO error 11 (Resource temporarily unavailable) on X server",
      "level": 3,
      "content": "Измените параметр KeepUnusedXServer в /etc/bumblebee/bumblebee.conf c false на true. Программа запустится в фоновом режиме и bumblebee не будет 'видеть' её.\n\n"
    }
  ]
}