{
  "title": "Arch Rollback Machine (日本語)",
  "url": "https://wiki.archlinux.org/title/Arch_Rollback_Machine_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- パッケージのダウングレード\n\nArch Linux Archive (略して ALA), 旧称 Arch Linux Rollback Machine (略して ARM) は公式リポジトリのスナップショットや昔の ISO イメージ、ブートストラップ tarball などを保存しています。\n\nALA を使うことで以下のことができます:\n\n- パッケージを昔のバージョンにダウングレード (最新版が壊れていて、1つ前のバージョンに戻したい場合)\n- ある特定の時間まで全てのパッケージをリストア (全てのパッケージが壊れていて、2ヶ月前まで戻したい場合)\n- 1つ前のバージョンの ISO イメージを取得\n\nパッケージが保存される期間は数年間だけで、それ以降は archive.org の Arch Linux Historical Archive に移動されます。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 場所\n- 2 ディレクトリ 2.1 /repos 2.2 /packages 2.3 /iso\n- 3 FAQ 3.1 パッケージをダウングレードする方法 3.2 特定の日時まで全てのパッケージをリストアする方法\n- 4 Historical Archive 4.1 Historical Archive でパッケージを検索 4.2 Historical Archive からパッケージをダウンロード 4.3 パッケージのダウンロードを Historical Archive にリダイレクト\n- 5 歴史\n\n- 2.1 /repos\n- 2.2 /packages\n- 2.3 /iso\n\n- 3.1 パッケージをダウングレードする方法\n- 3.2 特定の日時まで全てのパッケージをリストアする方法\n\n- 4.1 Historical Archive でパッケージを検索\n- 4.2 Historical Archive からパッケージをダウンロード\n- 4.3 パッケージのダウンロードを Historical Archive にリダイレクト\n\n"
    },
    {
      "title": "場所",
      "level": 2,
      "content": "Arch Linux Archive は現在 https://archive.archlinux.org/ から利用可能です。\n\nソースコード を入手して自分で Arch Linux Archive をセットアップすることもできます。\n\n"
    },
    {
      "title": "ディレクトリ",
      "level": 2,
      "content": "Archive は以下のように3つのメインディレクトリに分かれています。\n\n```\n├── iso\n├── packages\n└── repos\n```\n\n"
    },
    {
      "title": "/repos",
      "level": 3,
      "content": "repos ディレクトリには公式ミラーの毎日のスナップショットが含まれており、以下のように日付でまとめられています。\n\n```\nrepos\n├── 2013\n│   ├── 08\n│   │   └── 31\n│   │       ├── community\n│   │       ├── community-staging\n│   │       ├── community-testing\n│   │       ├── core\n│   │       ├── extra\n│   │       ├── gnome-unstable\n│   │       ├── kde-unstable\n│   │       ├── lastsync\n│   │       ├── multilib\n│   │       ├── multilib-staging\n│   │       ├── multilib-testing\n│   │       ├── pool\n│   │       ├── staging\n│   │       └── testing\n│   ├── 09\n│   │   ├── 01\n│   │   ├── 02\n│   │   ├── ...\n│   │   ├── 21\n│   │   └── 22\n│   ├── 10\n│   │   ├── 01\n│   │   ├── 02\n│   │   ├── ...\n│   │\n│   ├── 11\n│   └── 12\n├── 2014\n│   ├── 01\n│   │   ├── 01\n│   │   ├── 02\n│   │   ├── ...\n│   │\n│   ├── 02\n│   ├── 03\n│   ├── ...\n│   └── 09\n│       ├── 01\n│       ├── ...\n│       └── 28\n├── last\n├── month\n└── week\n```\n\n"
    },
    {
      "title": "/packages",
      "level": 3,
      "content": "packages ディレクトリには全てのバージョンのパッケージと署名が含まれています。1つのパッケージに1つのディレクトリとなっており、パッケージのディレクトリは最初の一文字によってまとめられています。\n\n```\n├── packages\n│   ├── a\n│   │   ├── awesome\n│   │   │   ├── awesome-3.5.0-1-i686.pkg.tar.xz\n│   │   │   ├── awesome-3.5.0-1-i686.pkg.tar.xz.sig\n│   │   │   ├── awesome-3.5.0-1-x86_64.pkg.tar.xz\n│   │   │   ├── awesome-3.5.0-1-x86_64.pkg.tar.xz.sig\n│   │   │   ├── awesome-3.5.1-1-i686.pkg.tar.xz\n│   │   │   ├── awesome-3.5.1-1-i686.pkg.tar.xz.sig\n│   │   │   ├── ...\n│   │   │ \n│   │   ├── ...\n│   │   ├── awstats\n│   │   └── axel\n│   │   \n│   ├── b\n│   ├── ...\n│   └── z\n```\n\n.all サブディレクトリを使うことでパッケージの名前で直接アクセスすることができます。要するに、全てのパッケージの全てのバージョンが一つのディレクトリに収まっています。\n\n```\n├── packages\n│   ├── .all\n│   │   ├── awesome-3.5.1-1-i686.pkg.tar.xz\n│   │   ├── ...\n│   │   ├── zsh-5.0.2-3-i686.pkg.tar.xz\n│   │   ├── zsh-5.0.2-4-i686.pkg.tar.xz\n│   │   └── ...\n```\n\n完全なパッケージリストは次の URL からダウンロードできます (圧縮済みです): index.0.xz。\n\n```\n$ curl https://archive.archlinux.org/packages/.all/index.0.xz | unxz\n```\n\n```\n0ad-a14-1-i686\n0ad-a14-1-x86_64\n0ad-a14-2-i686\n...\nzziplib-0.13.62-1-x86_64\nzziplib-0.13.62-2-i686\nzziplib-0.13.62-2-x86_64\n```\n\n"
    },
    {
      "title": "/iso",
      "level": 3,
      "content": "iso ディレクトリには公式 ISO イメージとブートストラップ tarball が収められており、リリース日によって分けられています。\n\n```\n├── 2014.09.03\n├── 2014.10.01\n├── 2014.11.01\n├── 2014.12.01\n├── 2015.07.01\n├── 2015.08.01\n├── 2015.09.01\n└── 2017.04.01\n    ├── arch\n    ├── archlinux-2017.04.01-x86_64.iso\n    ├── archlinux-2017.04.01-x86_64.iso.sig\n    ├── archlinux-2017.04.01-x86_64.iso.torrent\n    ├── archlinux-bootstrap-2017.04.01-x86_64.tar.gz\n    ├── archlinux-bootstrap-2017.04.01-x86_64.tar.gz.sig\n    ├── md5sums.txt\n    └── sha1sums.txt\n```\n\n"
    },
    {
      "title": "パッケージをダウングレードする方法",
      "level": 3,
      "content": "/packages の中からダウングレードしたいパッケージを探して以下のようにインストールしてください:\n\n```\n# pacman -U https://archive.archlinux.org/packages/ ... packagename.pkg.tar.xz\n```\n\npacman はパッケージに付属している .sig ファイルを自動的にダウンロードして /etc/pacman.conf の設定にしたがって検証を実行します。\n\nもしくは、パッケージを手動でダウンロードして pacman -U でインストールする方法もあります。\n\nダウングレードを簡単にするツールについてはパッケージのダウングレード#公式パッケージを見てください。\n\n"
    },
    {
      "title": "特定の日時まで全てのパッケージをリストアする方法",
      "level": 3,
      "content": "特定の日時にあったパッケージにリストアするには、例えば2014年3月30日の場合、/etc/pacman.conf を編集して以下のようにサーバーを記述することで pacman にその時のパッケージをダウンロードさせます:\n\n```\n[core]\nSigLevel = PackageRequired\nServer=https://archive.archlinux.org/repos/2014/03/30/$repo/os/$arch\n\n[extra]\nSigLevel = PackageRequired\nServer=https://archive.archlinux.org/repos/2014/03/30/$repo/os/$arch\n\n[community]\nSigLevel = PackageRequired\nServer=https://archive.archlinux.org/repos/2014/03/30/$repo/os/$arch\n```\n\nもしくは以下の内容で /etc/pacman.d/mirrorlist を置き換えます:\n\n```\n##                                                                              \n## Arch Linux repository mirrorlist                                             \n## Generated on 2042-01-01                                                      \n##\nServer=https://archive.archlinux.org/repos/2014/03/30/$repo/os/$arch\n```\n\nそしてデータベースをアップデートして強制的にダウングレード:\n\n```\n# pacman -Syyuu\n```\n\n"
    },
    {
      "title": "Historical Archive",
      "level": 2,
      "content": "Arch Linux Archive を維持するのに大量のリソースが消費されるため、古いパッケージは随時消去されます。\n\n古いパッケージは削除される前に、archive.org の \"Arch Linux Historical Archive\" コレクションにアップロードされます。\n\nHistorical Archive には特定の日時における Arch パッケージの「スナップショット」を取得する機能がありません。ただし、archive.archlinux.org のリダイレクトによって古いパッケージをダウンロードしようとすると archive.org の Historical Archive にリダイレクトされるようになっています。ユーザーから見れば特に影響はありませんが、archive.org からのダウンロードは基本的に速度が遅くなります。\n\n"
    },
    {
      "title": "Historical Archive でパッケージを検索",
      "level": 3,
      "content": "Arch Linux Historical Archive コレクションには全てのパッケージのインデックスが存在します: https://archive.org/details/archlinuxarchive\n\n識別子を使ってパッケージに直接アクセスすることも可能です。識別子の基本パターンは:\n\n```\narchlinux_pkg_<sanitized package name>\n```\n\nサニタイズされたパッケージ名は、パッケージ名に含まれている @, +, . 記号をアンダーバーの _ に置き換えた名前となります。\n\n例えば lucene++ の識別子は archlinux_pkg_lucene__ です。\n\n識別子でパッケージの詳細ページにアクセスすることが可能です。例: https://archive.org/details/archlinux_pkg_lucene__\n\narchive.org の Python クライアント を使って検索を行うこともできます:\n\n```\n$ ia search subject:\"archlinux package\" subject:'mysql'\n```\n\n```\n{\"identifier\": \"archlinux_pkg_ejabberd-mod_mysql\"}\n{\"identifier\": \"archlinux_pkg_ejabberd-mod_mysql-svn\"}\n{\"identifier\": \"archlinux_pkg_gambas3-gb-db-mysql\"}\n{\"identifier\": \"archlinux_pkg_gambas3-gb-mysql\"}\n{\"identifier\": \"archlinux_pkg_libgda-mysql\"}\n```\n\n"
    },
    {
      "title": "Historical Archive からパッケージをダウンロード",
      "level": 3,
      "content": "全てのバージョンのパッケージ (と署名) はパッケージのダウンロードページからアクセスできます: https://archive.org/download/archlinux_pkg_lucene__\n\nパッケージの取得例:\n\n```\n$ wget https://archive.org/download/archlinux_pkg_cjdns/cjdns-16.1-3-x86_64.pkg.tar.xz{,.sig}\n# pacman -U https://archive.org/download/archlinux_pkg_cjdns/cjdns-16.1-3-x86_64.pkg.tar.xz\n```\n\npacman を使用する場合、依存関係を自分で解決する必要があります。\n\narchive.org の Python クライアント でダウンロードすることも可能です。\n\n特定のバージョンのパッケージをダウンロード:\n\n```\n$ ia download archlinux_pkg_cjdns cjdns-16.1-3-x86_64.pkg.tar.xz{,.sig}\n```\n\nパッケージの x86_64 版と署名を全てダウンロード:\n\n```\n$ ia download archlinux_pkg_cjdns --glob=\"*x86_64.pkg.tar.xz*\"\n```\n\n"
    },
    {
      "title": "パッケージのダウンロードを Historical Archive にリダイレクト",
      "level": 3,
      "content": "古いパッケージのダウンロードを archive.org にリダイレクトする orion サーバーの Nginx 設定:\n\n```\nlocation ~ /repos/201[3456]/.*/.*\\.pkg\\.tar\\.xz(\\.sig)? {\n        # Tricky regexp to separate the pkgname from the pkgver (both can contain \"-\")\n        rewrite ^/repos/.*/((.*?)-[^-/]+-[0-9]+-[^-]+.*\\.pkg\\.tar\\.xz(\\.sig)?)$ /archive.org/archlinux_pkg_$2/$1 last;\n}\n\n# archive.org download URLs look like:\n# https://archive.org/download/archlinux_pkg_lucene__/lucene++-1.4.2-3-i686.pkg.tar.xz\n# We need to remove @.+ in the identifier (archlinux_pkg_*) but keep it in the filename at the end.\nlocation /archive.org/ {\n        # Rewrite @, + and . into _\n        # This is recursive so it will work even for multiple replacement,\n        # with up to 10 replacements for each character (nginx recursion limit). \n        # Idea from https://stackoverflow.com/a/15934256\n        rewrite ^/archive\\.org/([^@]*)@(.*)/(.*)$   /archive.org/$1_$2/$3;\n        rewrite ^/archive\\.org/([^\\.]*)\\.(.*)/(.*)$ /archive.org/$1_$2/$3;\n        rewrite ^/archive\\.org/([^\\+]*)\\+(.*)/(.*)$ /archive.org/$1_$2/$3;\n        # Once there are no more @.+ in the identifier part, redirect to archive.org\n        rewrite ^/archive\\.org/([^@\\+\\.]*/.*)$ https://archive.org/download/$1 permanent;\n}\n```\n\n"
    },
    {
      "title": "歴史",
      "level": 2,
      "content": "- オリジナルの ARM (Archlinux Rollback Machine) は2013年8月18日に幕を閉じました [1]。\n- 新しい ARM は2013年8月31日から seblu.net でホストされています。\n- 2015年10月13日に、新しい URL が作られ昔の ARM ディレクトリは無くなりました。新しいソフトウェア、agetpkg-gitAUR が作られました。\n- 2015年12月19日に archive.archlinux.org に移動しました [2]。\n- 2018年6月5日に2013年〜2016年の古いパッケージは archive.org にアップロードされました。\n\n"
    }
  ]
}