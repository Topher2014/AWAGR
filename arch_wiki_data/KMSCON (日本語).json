{
  "title": "KMSCON (日本語)",
  "url": "https://wiki.archlinux.org/title/KMSCON_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- KMS\n- systemd\n- fbterm\n\nプロジェクトの GitHub ページより:\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 機能\n- 2 インストール\n- 3 CJK サポート\n- 4 トラブルシューティング 4.1 Xorg と kmscon の切り替えに問題が発生する 4.2 音声を制御できない 4.3 Vim で端末の出力が消去されない 4.4 自動ログイン 4.5 HiDPI のサポート 4.6 KMS コンソールからウィンドウマネージャーを起動できない\n\n- 4.1 Xorg と kmscon の切り替えに問題が発生する\n- 4.2 音声を制御できない\n- 4.3 Vim で端末の出力が消去されない\n- 4.4 自動ログイン\n- 4.5 HiDPI のサポート\n- 4.6 KMS コンソールからウィンドウマネージャーを起動できない\n\n"
    },
    {
      "title": "機能",
      "level": 2,
      "content": "Kmscon はカーネル内蔵の linux コンソールの互換品として機能します。以下の機能が存在します:\n\n- vt220 から vt510 までの完全な実装。\n- 国際化の完全サポート: Kmscon は CJK を含む、Unicode 文字を全て表示できます。 Kmscon は libxkbcommon を使って国際化キーボードを扱えるため、X キーボードでサポートされている全てのキーボードレイアウトを利用することが可能です。\n- ハードウェアアクセラレーションを使ったレンダリング。\n- Multi-seat 可能。\n\n- Kmscon は CJK を含む、Unicode 文字を全て表示できます。\n- Kmscon は libxkbcommon を使って国際化キーボードを扱えるため、X キーボードでサポートされている全てのキーボードレイアウトを利用することが可能です。\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "その名前にかかわらず、KMS は kmscon に絶対必要というわけではありません。Kmscon は次のビデオバックエンドをサポートしています: fbdev (Linux fbdev ビデオバックエンド), drm2d (Linux DRM ソフトウェアレンダリングバックエンド), drm3d (Linux DRM ハードウェアレンダリングバックエンド)。あなたの環境でこの中のどれかひとつでも利用できるようにしてください。\n\nkmsconAUR もしくは開発版の kmscon-gitAUR をインストールしてください。あるいは kmscon-patched-gitAUR をインストールすることもできます。このパッチされたバージョンには依存パッケージの libtsm-patched-gitAUR と合わせて複数の修正や改善kmscon 9.0.0が含まれています。\n\nTTY1 で kmscon を使えるようにするには、以下を実行してください:\n\n```\n# systemctl disable getty@tty1.service\n# systemctl enable kmsconvt@tty1.service\n```\n\n全ての仮想端末で kmscon を有効にする場合は、root で、以下を実行してください:\n\n```\n# ln -s /usr/lib/systemd/system/kmsconvt\\@.service /etc/systemd/system/autovt\\@.service\n```\n\nこれで systemd がそれぞれの VT で agetty の代わりに kmscon を起動するようになります。より正確に言うと、このコマンドは systemd-logind が新しい VT で getty@.service の代わりに kmsconvt@.service を使うようにさせます。getty@.service を使っている他のユニットやスクリプトにはこの変更が適用されません。\n\n何らかの理由で kmscon が実行できないときは、代わりに getty@.service が起動されます。そのため問題が生じても動作を継続するためのフォールバックが常に存在します。さらに、VT が利用できない場合、このユニットは何も起動しません。\n\n"
    },
    {
      "title": "CJK サポート",
      "level": 2,
      "content": "Kmscon はデフォルトのフォントエンジン pango を通して CJK 文字のレンダリングをサポートしています。ただし、モノスペースフォントのエイリアスを適切な CJK フォントにマップするよう fontconfig を設定する必要があります。日本語ユーザーは、以下のテンプレートで日本語を表示できます:\n\n```\n/etc/fonts/conf.d/99-kmscon.conf\n```\n\n```\n<?xml version=\"1.0\"?>\n<!DOCTYPE fontconfig SYSTEM \"fonts.dtd\">\n<fontconfig>\n<match>\n        <test name=\"family\"><string>monospace</string></test>\n        <edit name=\"family\" mode=\"prepend\" binding=\"strong\">\n                <string>DejaVu Sans Mono</string>\n                <string>IPAGothic</string>\n        </edit>\n</match>\n</fontconfig>\n```\n\nttf-dejavu と otf-ipafont をインストールしてください。両方とも公式リポジトリに含まれています。\n\n"
    },
    {
      "title": "Xorg と kmscon の切り替えに問題が発生する",
      "level": 3,
      "content": "Xorg と kmscon の切り替えに問題が発生する場合は ExecStart に --hwaccel --drm を追加するとよいかもしれません。\n\n```\nExecStart=/usr/bin/kmscon \"--vt=%I\" --seats=seat0 --no-switchvt --font-name Terminus --font-size 12 --hwaccel --drm\n```\n\n"
    },
    {
      "title": "音声を制御できない",
      "level": 3,
      "content": "バージョン 7 で、オーディオをコントロールできない場合、ユーザーを audio グループに追加してください。ただしグループに追加すると問題が発生します。\n\n"
    },
    {
      "title": "Vim で端末の出力が消去されない",
      "level": 3,
      "content": "Vim を開いたときに端末の出力が消えない場合があります。ファイルの編集は可能ですがテキストが変更するまで表示されません。回避策として、TERM=vt220 環境変数を設定してみてください。もしくは、vi や Neovim などの vi ライクなテキストエディタを使ってください。\n\n"
    },
    {
      "title": "自動ログイン",
      "level": 3,
      "content": "これを /etc/kmscon/kmscon.conf に追加することで、パスワードを要求せずにユーザーを自動的にログインさせることができます。\n\n```\n# Modify this command to do what you need\n \n # Example: Login an user asking for user and password\n login=/bin/bash --login\n \n # Example: Login an user without asking for password\n login=/bin/bash -c su <your_username>\n```\n\n"
    },
    {
      "title": "HiDPI のサポート",
      "level": 3,
      "content": "Ctrl++、Ctrl+Shift+=、Ctrl+- のショートカットを使用して、その場でフォントサイズを変更できます。また、/etc/kmscon/kmscon.conf で 'font-dpi' と 'font-size' を設定することもできます。たとえば、'font-dpi=288' 288 は 96 * 3、つまり 300% のスケーリングです。96 がデフォルトです。\n\n"
    },
    {
      "title": "KMS コンソールからウィンドウマネージャーを起動できない",
      "level": 3,
      "content": "コマンドラインから startx や sway などを使用して Xorg や Wayland セッションを起動しようとすると失敗します。 この目的のために従来の非 KMS tty を使用するか、ログインマネージャーを利用してください。\n\n"
    }
  ]
}