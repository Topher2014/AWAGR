{
  "title": "Automatic login to virtual console (日本語)",
  "url": "https://wiki.archlinux.org/title/Automatic_login_to_virtual_console_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- ディスプレイマネージャ\n\ngetty はターミナルのラインと接続されたターミナルを管理するプログラムの総称です。getty の目的は権限のないアクセスからシステムを保護することにあります。通常、getty のプロセスは systemd によって起動され、ターミナルのラインを管理します。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール\n- 2 ヒントとテクニック 2.1 階段効果 2.2 仮想コンソールの追加 2.3 仮想コンソールに自動ログイン 2.3.1 仮想コンソール 2.3.2 シリアルコンソール 2.3.3 Nspawn コンソール 2.4 仮想コンソールのデフォルトユーザーのログイン時に、パスワード入力のみ表示する 2.5 tty1 にブートメッセージを残す 2.6 タイムアウト後にディスプレイをオフにする\n- 3 参照\n\n- 2.1 階段効果\n- 2.2 仮想コンソールの追加\n- 2.3 仮想コンソールに自動ログイン 2.3.1 仮想コンソール 2.3.2 シリアルコンソール 2.3.3 Nspawn コンソール\n- 2.4 仮想コンソールのデフォルトユーザーのログイン時に、パスワード入力のみ表示する\n- 2.5 tty1 にブートメッセージを残す\n- 2.6 タイムアウト後にディスプレイをオフにする\n\n- 2.3.1 仮想コンソール\n- 2.3.2 シリアルコンソール\n- 2.3.3 Nspawn コンソール\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "Arch Linux におけるデフォルトの getty プログラムは agetty であり、util-linux パッケージの一部です。\n\n代替手段は次の通りです。\n\n- mingetty — 自動ログインができる最小主義の getty\n\n"
    },
    {
      "title": "階段効果",
      "level": 3,
      "content": "agetty はログインを待っている間、TTY の設定を変更し、改行が CR-LF に変換されないようにします。このため、コンソールに出力されるメッセージに「階段効果」が発生する傾向があります。\n\nこれは全く無害ですが、一度ログに記録されると持続する場合、この動作を修正することができます。\n\n```\n$ stty onlcr\n```\n\nこの件に関しては、こちらの forums discussion を参照してください。\n\n"
    },
    {
      "title": "仮想コンソールの追加",
      "level": 3,
      "content": "Agetty は仮想コンソールを管理し、Arch Linux ではデフォルトで 6 つの仮想コンソールが提供されています。通常、Ctrl+Alt+F1 から Ctrl+Alt+F6 までのキーでアクセスできます。\n\n/etc/systemd/logind.conf ファイルを開き、オプション NAutoVTs=6 をブート時に必要な仮想端末の数に設定します。\n\n必要に応じて、getty@ttyN.service サービスを直接一時的に開始することもできます。\n\n"
    },
    {
      "title": "仮想コンソールに自動ログイン",
      "level": 3,
      "content": "agetty に渡されるデフォルトパラメータを上書きする systemd のドロップインファイルを使って設定を行います。\n\n設定は仮想コンソールとシリアルコンソールで異なります。ほとんどの場合、設定するのは仮想コンソールの自動ログインでしょう。デバイス名は ttyN で、N が数字です。シリアルコンソールのデバイス名は ttySN のようになり、N は同じく数字になります。\n\n"
    },
    {
      "title": "仮想コンソール",
      "level": 4,
      "content": "getty@tty1.service のために次の内容でドロップインファイルを作成します:\n\n```\n/etc/systemd/system/getty@tty1.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -f -- \\\\u' --noclear --autologin username %I $TERM\n```\n\n- デフォルトの getty@.service にあるオプション Type=idle は、すべてのジョブ(ユニットへの状態変更リクエスト)が完了するまでサービスの起動を遅らせ、ログインプロンプトがブートメッセージで汚染されないようにします。X を自動的に開始する場合、ドロップインファイルに Type=simple を追加して getty@tty1.service を直ちに開始することが有用です。初期化システムと startx の両方をサイレントモードにして、ブート中のメッセージが混在しないようにすることができます。\n- ログインプロンプトを完全に非表示にする仮想コンソール drop-in ファイルの例については、サイレントブート#agetty を参照してください。\n- 上記のスニペットは、loginctl のセッションタイプを tty に設定します。必要であれば(例えばX を自動的に開始する場合など)、このファイルに Environment=XDG_SESSION_TYPE=x11 または Environment=XDG_SESSION_TYPE=wayland を追加して、セッションタイプを手動で wayland または x11 に設定することが可能です。\n\n完全な自動ログインを望まないが、ユーザー名を入力したくない場合は、仮想コンソールログイン時にデフォルトユーザーのパスワードのみを要求するを参照してください。\n\ntty1 以外の tty を使用したい場合は、デフォルトの getty 数を変更する方法を参照してください。\n\n"
    },
    {
      "title": "シリアルコンソール",
      "level": 4,
      "content": "ドロップインファイルを作成します:\n\n```\n/etc/systemd/system/serial-getty@ttyS0.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/usr/bin/agetty --autologin username -s %I 115200,38400,9600 vt102\n```\n\n"
    },
    {
      "title": "Nspawn コンソール",
      "level": 4,
      "content": "systemd-nspawn コンテナに自動ログインするには、console-getty.service を上書きするためにドロップインファイルを作成します:\n\n```\n/etc/systemd/system/console-getty.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -f -- \\\\u' --noclear --keep-baud --autologin username - 115200,38400,9600 $TERM\n```\n\nmachinectl login my-container メソッドを使用してコンテナにアクセスする場合は、pts/[0-9] 仮想 tty を管理する container-getty@.service テンプレートも調整してください:\n\n```\n/etc/systemd/system/container-getty@.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -f -- \\\\u' --noclear --keep-baud --autologin username - 115200,38400,9600 $TERM\n```\n\n"
    },
    {
      "title": "仮想コンソールのデフォルトユーザーのログイン時に、パスワード入力のみ表示する",
      "level": 3,
      "content": "Getty はデフォルトユーザーで仮想コンソールからログインする際に、パスワードを入力しますが、ユーザー名を入力する必要はありません。例えば、tty1 上で username のパスワードを要求する場合です:\n\n```\n/etc/systemd/system/getty@tty1.service.d/skip-username.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -- username' --noclear --skip-login - $TERM\n```\n\n"
    },
    {
      "title": "tty1 にブートメッセージを残す",
      "level": 3,
      "content": "デフォルトで、Arch では getty@tty1 サービスが有効になっています。サービスファイルは既に --noclear を使うようになっているので、agetty が画面をクリアすることはありません。しかし、systemd は起動する前に画面をクリアします。この動作を無効にするには、ドロップインファイルを作成します。\n\n```\n/etc/systemd/system/getty@tty1.service.d/noclear.conf\n```\n\n```\n[Service]\nTTYVTDisallocate=no\n```\n\n- カーネルパラメータから quiet を必ず削除してください。\n- KMS の起動が遅いと、最初の数回のブートメッセージがクリアされないかもしれません。カーネルモード設定#KMS の早期開始 か カーネルモード設定#モード設定を無効にする を参照してください。\n\n"
    },
    {
      "title": "タイムアウト後にディスプレイをオフにする",
      "level": 3,
      "content": "システムをサーバーとして使用していてもディスプレイが接続されている場合、ディスプレイは常にオンのままになります。 ディスプレイを5分後にオフにするには、ドロップインファイル を作成してください。 キーを押すとディスプレイが再びオンになります。\n\n```\n/etc/systemd/system/getty@tty1.service.d/blankscreen.conf\n```\n\n```\n[Service]\nExecStartPost=-/usr/bin/setterm --blank 5\n```\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- Systemd#起動時のデフォルトターゲットを変更する\n- The TTY demystified\n- Wikipedia:tty (unix)\n\n"
    }
  ]
}