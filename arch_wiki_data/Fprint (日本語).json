{
  "title": "Fprint (日本語)",
  "url": "https://wiki.archlinux.org/title/Fprint_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- Fingerprint-gui\n- ThinkFinger\n\nfprint のホームページ より:\n\nノートパソコンに内蔵されている指紋リーダーを使用して PAM を使ったログインを行うというアイデアです。この記事ではバックアップ用にログインで通常のパスワードを使う方法も説明しています (多くの理由により、指紋スキャナーのみの使用は推奨されません)。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 要件\n- 2 インストール\n- 3 設定 3.1 ログイン設定 3.2 指紋署名の作成 3.3 登録の制限\n- 4 トラブルシューティング 4.1 利用可能なデバイスがない 4.2 サスペンド後のログインプロンプト表示時に gdm がハングする 4.3 デバイスをサスペンド中に予期しないエラーが発生 4.4 指紋認証が Polkit エージェントで有効にならない 4.5 デバッグ 4.6 スリープから復帰後、指紋リーダーデバイスが初期化される前に fprintd が開始される 4.7 登録は機能するが、認証が機能しない\n\n- 3.1 ログイン設定\n- 3.2 指紋署名の作成\n- 3.3 登録の制限\n\n- 4.1 利用可能なデバイスがない\n- 4.2 サスペンド後のログインプロンプト表示時に gdm がハングする\n- 4.3 デバイスをサスペンド中に予期しないエラーが発生\n- 4.4 指紋認証が Polkit エージェントで有効にならない\n- 4.5 デバッグ\n- 4.6 スリープから復帰後、指紋リーダーデバイスが初期化される前に fprintd が開始される\n- 4.7 登録は機能するが、認証が機能しない\n\n"
    },
    {
      "title": "要件",
      "level": 2,
      "content": "使っている指紋スキャナーがサポートされていることを確認してください。あなたのデバイスがサポートされているかどうかは サポートされているデバイスのリストもしくは、サポートされていないデバイスのリストあなたのデバイスを確認するには、次を入力してください:\n\n```\n$ lsusb\n```\n\nlsusb ツールは、usbutils パッケージ内で使用できます。\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "公式リポジトリから fprintd をインストールしてください。imagemagick も必要かもしれません。\n\nデバイスによっては、libfprint の別のフォークが必要で、メインの libfprint とは (まだ?) マージされていないようです:\n\n- libfprint-tod — タッチベースのセンサー用。\n\n- libfprint-elanmoc2 — ELANの 04f3:0c4c が待機していて、マージが必要。\n\n- libfprint-elanmoc2-newdrvs — 実験的な 04f3:0c4c または 04f3:0c00 用、マージ待ち。\n\n"
    },
    {
      "title": "ログイン設定",
      "level": 3,
      "content": "- GDM を使っているなら、ログインメニューで指紋オプションが使えるはずです (使えない場合、ユーザーを input ユーザーグループ に追加してみてください) このセクションは飛ばして下さい。\n- SDDM を使う場合、SDDM#指紋認証の利用 を参照してください。\n\npam_fprintd.so を sufficient として /etc/pam.d/system-local-login の auth セクションの一番上に追加してください:\n\n```\n/etc/pam.d/system-local-login\n```\n\n```\nauth      sufficient pam_fprintd.so\nauth      include   system-login\n...\n```\n\nこれで最初に指紋によるログインが試行され、それが失敗したりユーザーのホームディレクトリに指紋署名がない場合、パスワードによるログインになります。\n\n同じ方法で /etc/pam.d/{login,su,sudo,gdm,lightdm} にある他のファイルを変更することもできます。たとえば、polkit ベースの認証 (GNOME やその他多くのデスクトップ環境) に使用される /etc/pam.d/polkit-1 を編集する場合です。もし /etc/pam.d/polkit-1 が存在しない場合は、/usr/lib/pam.d/polkit-1 からコピーしてください。KDE では、/etc/pam.d/kde-fingerprint に指紋認証が既に設定されているため、そのファイルを編集する必要はありません。\n\n指紋データが存在する場合、/etc/pam.d/ 内の任意の設定ファイルに pam_fprintd.so を sufficientとして追加すると、指紋認証のみが求められるようになります。ただし、シェルがなくて Ctrl+c で指紋認証をキャンセルできない場合、パスワードの使用ができなくなる点に注意してください。グラフィカルインターフェースでパスワードまたは指紋のどちらかを使用できるようにするには、必要なファイルの先頭に次の行を追加してください:\n\n```\n/etc/pam.d/sudo\n```\n\n```\nauth\t\tsufficient  \tpam_unix.so try_first_pass likeauth nullok\nauth\t\tsufficient  \tpam_fprintd.so\n...\n```\n\n最初にパスワードを促され、入力せずに Enter キーを押すと指紋認証が行われます。\n\n指紋とパスワードの入力を同時に促したい場合は、pam-fprint-grosshackAUR を使用することができます。これは、Gnome の組み込み polkit エージェントのような、空白のパスワード入力を許さないグラフィカルなプログラムで必要になることがあります。このパッケージを使用するには、必要なファイルの先頭に次の行を追加します:\n\n```\nauth\t\tsufficient  \tpam_fprintd_grosshack.so\nauth\t\tsufficient  \tpam_unix.so try_first_pass nullok\n...\n```\n\n"
    },
    {
      "title": "指紋署名の作成",
      "level": 3,
      "content": "登録するには、認証エージェントを実行する必要があります。\n\n指の署名を追加するには、次を実行してください:\n\n```\n$ fprintd-enroll\n```\n\nまたは、5 本の指全ての署名を新しく作成するには:\n\n```\n$ fprintd-delete \"$USER\"\n$ for finger in {left,right}-{thumb,{index,middle,ring,little}-finger}; do fprintd-enroll -f \"$finger\" \"$USER\"; done\n```\n\n指定された指をスキャンするように指示されます。右手の人差し指を 5回スワイプしてください。その後、/var/lib/fprint/ に署名が作成されます。\n\nまた、認証エージェントなしで登録することもできます。\n\n```\n# fprintd-enroll user\n```\n\n新しく作成されたフィンガープリントを確認するには、次のようにします:\n\n```\n$ fprintd-verify\n```\n\n詳しくは、fprintd(1) を見て下さい。\n\n"
    },
    {
      "title": "登録の制限",
      "level": 3,
      "content": "デフォルトでは新しい指紋を登録するのにパスワードを入力する必要はありません。Polkit ルールを使うことでこの動作を変更することができます。\n\npolkit の設定ファイルは、次の2つの場所に保存されています。\n\n- /etc/polkit-1/rules.d/\n- /usr/share/polkit-1/rules.d/\n\n以下の例ではスーパーユーザーだけが指紋を登録できるようになります:\n\n```\n/etc/polkit-1/rules.d/50-net.reactivated.fprint.device.enroll.rules\n```\n\n```\npolkit.addRule(function (action, subject) {\n  if (action.id == \"net.reactivated.fprint.device.enroll\") {\n    return subject.user == \"root\" ? polkit.Result.YES : polkit.result.NO\n  }\n})\n```\n\n"
    },
    {
      "title": "利用可能なデバイスがない",
      "level": 3,
      "content": "サポートされているデバイス が見つからない、または既に開いている(使用中)と言われる場合は、fprintd のログを journal で確認してください:\n\n次のようなログエントリが見つかるかもしれません:\n\n```\nfprintd[2936592]: Corrupted message received\nfprintd[2936592]: Ignoring device due to initialization error: unsupported firmware version\n```\n\nFwupd でデバイスのファームウェアを最新の状態にしてください。\n\n"
    },
    {
      "title": "サスペンド後のログインプロンプト表示時に gdm がハングする",
      "level": 3,
      "content": "この問題は libfprint repositoryで説明されています。開発者の答えは以下の通りです:\n\n提案されている修正方法は、以下のように作成することです:\n\n```\n/etc/modprobe.d/bluetooth-blacklist.conf\n```\n\n```\nblacklist btusb\n```\n\nまたは、すぐに以下のコマンドを実行します:\n\n```\n# rmmod btusb\n```\n\nその後、デバイスの初期化を試みることはなくなります。\n\n"
    },
    {
      "title": "デバイスをサスペンド中に予期しないエラーが発生",
      "level": 3,
      "content": "この問題は libfprint repositoryで説明されています:\n\n"
    },
    {
      "title": "指紋認証が Polkit エージェントで有効にならない",
      "level": 3,
      "content": "Linux PAM に指紋ルールを追加した後、指紋認識は SDDM と sudo に対してのみ機能しますが、polkit に対しては機能しません。\n\n50-default.rules ファイルを /etc/ にコピーし、グループ名 wheel をユーザーグループに変更します。\n\n```\n# cp /usr/share/polkit-1/rules.d/50-default.rules /etc/polkit-1/rules.d/\n```\n\n```\n/etc/polkit-1/rules.d/50-default.rules\n```\n\n```\npolkit.addAdminRule(function(action, subject) {\n    return [\"unix-group:wheel\"];\n});\n```\n\n"
    },
    {
      "title": "デバッグ",
      "level": 3,
      "content": "次の環境変数とコマンドラインフラグを使用します:\n\n```\n# G_MESSAGES_DEBUG=all /usr/lib/fprintd -t\n```\n\n"
    },
    {
      "title": "スリープから復帰後、指紋リーダーデバイスが初期化される前に fprintd が開始される",
      "level": 3,
      "content": "次の systemd サービスを作成して 有効化 します。3-3 を指紋リーダーのバス ID とポートに置き換えます。これは、lsusb -t を使用して見つけることができます。\n\n```\n/etc/systemd/system/fingerprint.service\n```\n\n```\n[Unit]\nDescription=Kill fprintd and enable USB persist before sleep\nBefore=sleep.target\n\n[Service]\nExecStart=/usr/bin/sh -c \"killall fprintd; echo 1 > /sys/bus/usb/devices/3-3/power/persist\"\n\n[Install]\nWantedBy=sleep.target\n```\n\n"
    },
    {
      "title": "登録は機能するが、認証が機能しない",
      "level": 3,
      "content": "一部のタッチ式指紋リーダーは、fprint のアルゴリズムが正常に動作するには小さすぎるイメージを生成します。その場合の一般的な回避策として、センサーをタッチするのではなくスワイプする方法があります。ただし、適切なイメージが生成される速度はセンサーによって異なる場合があります。一部のセンサーはゆっくりとスワイプする必要があり、他のセンサーでは速いスワイプが必要です。以下のリンクに、良い イメージがどのようなものであるべきかについてのヒント が記載されています。\n\nさまざまな速度で練習して、どちらがより良いイメージを生成するかを確認したい場合は、スクリプト [1] を選択し、上記の例と比較します (ソースから libfprint をコンパイルする必要があります)\n\nこちらも参照 https://gitlab.freedesktop.org/libfprint/libfprint/-/issues/174\n\n"
    }
  ]
}