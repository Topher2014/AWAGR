{
  "title": "Аппаратное ускорение видео",
  "url": "https://wiki.archlinux.org/title/%D0%90%D0%BF%D0%BF%D0%B0%D1%80%D0%B0%D1%82%D0%BD%D0%BE%D0%B5_%D1%83%D1%81%D0%BA%D0%BE%D1%80%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Аппаратное ускорение видео (англ.) позволяет выполнять операции кодирования и декодирования видео на стороне видеокарты, разгружая CPU и экономя энергию.\n\nСуществуют несколько реализаций этой технологии на Linux:\n\n- Video Acceleration API (VA-API) — разработанная Intel спецификация и свободная библиотека, предоставляющая аппаратное ускорение кодирования и декодирования видео.\n- Video Decode and Presentation API for Unix (VDPAU) — разработанная NVIDIA свободная библиотека и API для переноса части процесса декодирования видео и его постобработки на сторону GPU.\n- NVDECODE/NVENCODE — проприетарные API аппаратного ускорения, используемые в таких поколениях GPU от NVIDIA, как Fermi, Kepler, Maxwell и Pascal.\n\nТакже всесторонний обзор поддержки данных технологий со стороны драйверов и приложений доступен в разделе #Сравнительные таблицы.\n\n"
    },
    {
      "title": "Intel",
      "level": 3,
      "content": "Свободные драйверы Intel graphics поддерживают VA-API:\n\n- Серия HD Graphics, начиная с Broadwell (~2015) и новее, поддерживается intel-media-driver.\n- GMA 4500 series и более новые GPU до Coffee Lake поддерживаются libva-intel-driver.\n- Декодирование H.264 на GMA 4500 поддерживается libva-intel-driver-g45-h264AUR, см. Intel graphics (Русский)#Декодирование H.264 на GMA 4500.\n- Гибридное декодирование VP9 на процессорах от Broadwell до Skylake, а также гибридное декодирование VP8 на процессорах от Haswell до Skylake, поддерживается intel-hybrid-codec-driverAUR[ссылка недействительна: package not found].\n- Skylake и более новые поколения также требуют linux-firmware.\n\n"
    },
    {
      "title": "NVIDIA",
      "level": 3,
      "content": "Свободный драйвер Nouveau поддерживает как VA-API, так и VDPAU:\n\n- GeForce 8 series и новее (до GeForce GTX 750) поддерживаются libva-mesa-driver[ссылка недействительна: package not found] и mesa-vdpau[ссылка недействительна: package not found].\n- Необходим nouveau-fwAUR — пакет с микропрограммой, которая на сегодняшний день извлекается из бинарного драйвера NVIDIA.\n\nПроприетарный драйвер NVIDIA поддерживает следующие технологии с помощью пакета nvidia-utils:\n\n- VDPAU на серии GeForce 8 и новее;\n- NVDECODE на Fermi и новее [1];\n- NVENCODE на Kepler и новее.\n\n"
    },
    {
      "title": "ATI/AMD",
      "level": 3,
      "content": "Свободные драйверы ATI и AMDGPU поддерживают как VA-API, так и VDPAU:\n\n- VA-API на Radeon HD 2000 и новее поддерживается libva-mesa-driver[ссылка недействительна: package not found].\n- VDPAU на Radeon R300 и новее поддерживается mesa-vdpau[ссылка недействительна: package not found].\n\nПроприетарный драйвер AMDGPU PRO основывается на драйвере AMDGPU и поддерживает как VA-API, так и VDPAU.\n\n"
    },
    {
      "title": "Слои преобразований",
      "level": 3,
      "content": "Активация поддержки VA-API при её отсутствии в драйвере:\n\n- libva-vdpau-driverAUR – бекенд VDPAU для VA-API.\n- libva-vdpau-driver-chromiumAUR[ссылка недействительна: package not found] – бекенд VDPAU для VA-API с патчем, позволяющим взаимодействовать с Chromium.\n- libva-vdpau-driver-vp9-gitAUR – экспериментальная поддержка VP9.\n\nАктивация поддержки VDPAU при её отсутствии в драйвере:\n\n- libvdpau-va-gl – бекенд VA-API для VDPAU, поддерживается только H.264 (англ.).\n\n"
    },
    {
      "title": "Проверка",
      "level": 2,
      "content": "Аппаратное ускорение, скорее всего, хорошо заработает по умолчанию. Проверить это можно описанными ниже способами.\n\n"
    },
    {
      "title": "Проверка VA-API",
      "level": 3,
      "content": "Проверьте настройки VA-API, выполнив vainfo (предоставляется пакетом libva-utils):\n\n```\n$ vainfo\n```\n\n```\nlibva info: VA-API version 0.39.4\nlibva info: va_getDriverName() returns 0\nlibva info: Trying to open /usr/lib/dri/i965_drv_video.so\nlibva info: Found init function __vaDriverInit_0_39\nlibva info: va_openDriver() returns 0\nvainfo: VA-API version: 0.39 (libva 1.7.3)\nvainfo: Driver version: Intel i965 driver for Intel(R) Skylake - 1.7.3\nvainfo: Supported profile and entrypoints\n      VAProfileMPEG2Simple            :\tVAEntrypointVLD\n      VAProfileMPEG2Simple            :\tVAEntrypointEncSlice\n      VAProfileMPEG2Main              :\tVAEntrypointVLD\n      VAProfileMPEG2Main              :\tVAEntrypointEncSlice\n      VAProfileH264ConstrainedBaseline:\tVAEntrypointVLD\n      VAProfileH264ConstrainedBaseline:\tVAEntrypointEncSlice\n      VAProfileH264ConstrainedBaseline:\tVAEntrypointEncSliceLP\n      VAProfileH264Main               :\tVAEntrypointVLD\n      VAProfileH264Main               :\tVAEntrypointEncSlice\n      VAProfileH264Main               :\tVAEntrypointEncSliceLP\n      VAProfileH264High               :\tVAEntrypointVLD\n      VAProfileH264High               :\tVAEntrypointEncSlice\n      VAProfileH264High               :\tVAEntrypointEncSliceLP\n      VAProfileH264MultiviewHigh      :\tVAEntrypointVLD\n      VAProfileH264MultiviewHigh      :\tVAEntrypointEncSlice\n      VAProfileH264StereoHigh         :\tVAEntrypointVLD\n      VAProfileH264StereoHigh         :\tVAEntrypointEncSlice\n      VAProfileVC1Simple              :\tVAEntrypointVLD\n      VAProfileVC1Main                :\tVAEntrypointVLD\n      VAProfileVC1Advanced            :\tVAEntrypointVLD\n      VAProfileNone                   :\tVAEntrypointVideoProc\n      VAProfileJPEGBaseline           :\tVAEntrypointVLD\n      VAProfileJPEGBaseline           :\tVAEntrypointEncPicture\n      VAProfileVP8Version0_3          :\tVAEntrypointVLD\n      VAProfileVP8Version0_3          :\tVAEntrypointEncSlice\n      VAProfileHEVCMain               :\tVAEntrypointVLD\n      VAProfileHEVCMain               :\tVAEntrypointEncSlice\n```\n\nVAEntrypointVLD означает, что видеокарта способна декодировать данный формат, а VAEntrypointEncSlice означает, что данный формат можно кодировать.\n\nВ данном примере используется драйвер i965:\n\n```\nlibva info: Trying to open /usr/lib/dri/i965_drv_video.so\n```\n\nЕсли при выполнении vainfo отображается следующая ошибка:\n\n```\nlibva info: va_openDriver() returns -1\nvaInitialize failed with error code -1 (unknown libva error),exit\n```\n\nНеобходимо задать корректный драйвер, см. #Настройка VA-API.\n\n"
    },
    {
      "title": "Проверка VDPAU",
      "level": 3,
      "content": "Установите пакет vdpauinfo, чтобы получить полный отчёт о конфигурации драйвера VDPAU и убедиться, что он загружен корректно:\n\n```\n$ vdpauinfo\n```\n\n```\ndisplay: :0   screen: 0\nAPI version: 1\nInformation string: G3DVL VDPAU Driver Shared Library version 1.0\n\nVideo surface:\n\nname   width height types\n\n420    16384 16384  NV12 YV12 \n422    16384 16384  UYVY YUYV \n444    16384 16384  Y8U8V8A8 V8U8Y8A8 \n\nDecoder capabilities:\n\nname                        level macbs width height\n\nMPEG1                          --- not supported ---\nMPEG2_SIMPLE                    3  9216  2048  1152\nMPEG2_MAIN                      3  9216  2048  1152\nH264_BASELINE                  41  9216  2048  1152\nH264_MAIN                      41  9216  2048  1152\nH264_HIGH                      41  9216  2048  1152\nVC1_SIMPLE                      1  9216  2048  1152\nVC1_MAIN                        2  9216  2048  1152\nVC1_ADVANCED                    4  9216  2048  1152\n\n..\n```\n\n"
    },
    {
      "title": "Настройка",
      "level": 2,
      "content": "Несмотря на то, что видеодрайвер должен автоматически активировать поддержку аппаратного ускорения видео с помощью VA-API и VDPAU, в некоторых случаях может потребоваться настроить VA-API/VDPAU вручную. Перед тем как продолжать чтение данного раздела, просмотрите раздел #Проверка.\n\nНазвания драйверов по умолчанию угадываются системой, если остутствуют какие-либо другие настройки. Однако они часто не совпадают и не работают. Предполагаемые значения можно просмотреть, выполнив следующую команду:\n\n```\n$ grep -iE 'vdpau | dri driver' /var/log/Xorg.0.log\n```\n\n```\n(II) RADEON(0): [DRI2] DRI driver: radeonsi\n(II) RADEON(0): [DRI2] VDPAU driver: radeonsi\n```\n\nВ данном случае по умолчанию используется radeonsi для VA-API и VDPAU.\n\n"
    },
    {
      "title": "Настройка VA-API",
      "level": 3,
      "content": "Драйвер VA-API можно переопределить с помощью переменной окружения LIBVA_DRIVER_NAME:\n\n- Intel graphics: Укажите i965, если используется libva-intel-driver. Укажите iHD, если используется intel-media-driver.\n- NVIDIA: Укажите nouveau, если используется Nouveau. Укажите vdpau, если используется NVIDIA.\n- ATI/AMD: Укажите radeonsi, если используется AMDGPU.\n\n- Укажите i965, если используется libva-intel-driver.\n- Укажите iHD, если используется intel-media-driver.\n\n- Укажите nouveau, если используется Nouveau.\n- Укажите vdpau, если используется NVIDIA.\n\n- Укажите radeonsi, если используется AMDGPU.\n\nNote: **${LIBVA_DRIVER_NAME}** \n\n- Установленные драйверы находятся в /usr/lib/dri/ и используются как /usr/lib/dri/${LIBVA_DRIVER_NAME}_drv_video.so.\n- Некоторые драйверы устанавливаются несколько раз под разными именами в целях совместимости. Их список можно увидеть, выполнив команду sha1sum /usr/lib/dri/* | sort.\n- LIBVA_DRIVERS_PATH может использоваться для переопределения расположения драйверов VA-API.\n- Начиная с версии 12.0.1, libva-mesa-driver[ссылка недействительна: package not found] предоставляет radeonsi вместо gallium.\n\n"
    },
    {
      "title": "Настройка VDPAU",
      "level": 3,
      "content": "Драйвер VDPAU можно переопределить с помощью переменной окружения VDPAU_DRIVER.\n\nКорректное название драйвера зависит от конфигурации:\n\n- Если используется Intel Graphics или AMD Catalyst, необходимо задать va_gl.\n- Если используется свободный драйвер AMD/ATI, задайте соответствующую версию драйвера, в зависимости от видеокарты. См. #Проверка.\n- Если используется свободный драйвер Nouveau, задайте nouveau.\n- Если используется проприетарный драйвер NVIDIA, задайте nvidia.\n\nNote: **${VDPAU_DRIVER}** \n\n- Установленные драйверы находятся в /usr/lib/vdpau/ и используются как /usr/lib/vdpau/libvdpau_${VDPAU_DRIVER}.so.\n- Некоторые драйверы устанавливаются несколько раз под разными именами в целях совместимости. Их список можно увидеть, выполнив команду sha1sum /usr/lib/vdpau/*.\n- В случае с конфигурацией с гибридной графикой (как с NVIDIA, так и с AMD), может потребоваться задать переменную окружения DRI_PRIME=1. См. статью PRIME для получения более подробной информации.\n\n"
    },
    {
      "title": "Настройка приложений",
      "level": 3,
      "content": "Мультимедийные фреймворки:\n\n- FFmpeg#Hardware video acceleration (англ.)\n- GStreamer#Hardware video acceleration (англ.)\n\nВидеоплееры:\n\n- Browser plugins#Adobe Flash Player (англ.)\n- Kodi#Hardware video acceleration (англ.)\n- MPlayer#Hardware video acceleration (англ.)\n- mpv#Hardware video acceleration (англ.)\n- VLC media player#Hardware video acceleration (англ.)\n\nВеб-браузеры:\n\n- Chromium#Hardware video acceleration (англ.)\n- Firefox (Русский)#Аппаратное ускорение видео\n- GNOME/Web#Video (англ.)\n\n"
    },
    {
      "title": "Ошибка \"Failed to open VDPAU backend\"",
      "level": 3,
      "content": "Необходимо задать переменную VDPAU_DRIVER, указывающую на корректный драйвер. См. #Настройка VDPAU.\n\n"
    },
    {
      "title": "Ошибка \"init failed\" с VAAPI",
      "level": 3,
      "content": "Данная ошибка (например, libva: /usr/lib/dri/i965_drv_video.so init failed) может происходить из-за неправильного определения Wayland. Одно из решений — сбросить переменную $DISPLAY, таким образом, mpv, MPlayer, VLC и т.д. не будут исходить из того, что используется X11. Также можно добавить аргумент --gpu-context=wayland, если используется mpv.\n\n"
    },
    {
      "title": "Драйверы VA-API",
      "level": 3,
      "content": "Table content:\nКодек | libva-intel-driver [2] | intel-media-driver [3] | libva-mesa-driver[ссылка недействительна: package not found] [4] [5] | libva-vdpau-driverAUR (адаптер VDPAU)\nДекодирование\nMPEG-2 | GMA 4500 и новее | Broadwell и новее | Radeon HD 6000 и новееGeForce 8 и новее1 | См. #Драйверы VDPAU\nMPEG-44 | Нет | Нет | Radeon HD 6000 и новее\nVC-1 | Sandy Bridge и новее | Broadwell и новее | Radeon HD 2000 и новееGeForce 9300 и новее1\nH.264/MPEG-4 AVC | GMA 45002, Ironlake и новее | Radeon HD 2000 и новееGeForce 8 и новее1\nH.265/HEVC 8bit | Cherryview/Braswell и новее | Skylake и новее | Radeon R9 Fury и новее\nH.265/HEVC 10bit | Broxton и новее | Broxton/Apollo Lake и новее | Radeon 400 и новее\nVP8 | Broadwell и новее | Broadwell и новее | Нет | Нет\nVP9 8bit | Broxton и новее Гибридное: Broadwell to Skylake3 | Broxton/Apollo Lake и новее | Raven Ridge и новее | См. #Драйверы VDPAU5\nVP9 10bit | Kaby Lake и новее | Kaby Lake и новее | Нет\nКодирование\nMPEG-2 | Ivy Bridge и новее | Broadwell и новеекроме Broxton/Apollo Lake | Нет | –\nH.264/MPEG-4 AVC | Sandy Bridge и новее | Broadwell и новее | Radeon HD 7000 и новее\nH.265/HEVC 8bit | Skylake и новее | Skylake и новее | Radeon 400 и новее\nH.265/HEVC 10bit | Kaby Lake и новее | Kaby Lake и новее | Raven Ridge и новее\nVP8 | Cherryview/Braswell и новее Гибридное: от Haswell до Skylake3 | Нет\nVP9 8bit | Kaby Lake и новее | Icelake и новее\nVP9 10bit | Нет\n\n- 1 До GeForce GTX 750.\n- 2 Поддерживается libva-intel-driver-g45-h264AUR.\n- 3 Гибридный кодировщик VP8 и декодировщик VP9 поддерживается intel-hybrid-codec-driverAUR[ссылка недействительна: package not found].\n- 4 MPEG-4 отключён по умолчанию из-за ограничений VAAPI. Задайте переменную окружения VAAPI_MPEG4_ENABLED=true, если вы всё-таки хотите протестировать данную функцию.\n- 5 Экспериментальная поддержка VP9 доступна в libva-vdpau-driver-vp9-gitAUR.\n\n"
    },
    {
      "title": "Драйверы VDPAU",
      "level": 3,
      "content": "Table content:\nКодек | mesa-vdpau[ссылка недействительна: package not found] [6] [7] | nvidia-utils | libvdpau-va-gl(адаптер VA-API)\nДекодирование\nMPEG-2 | Radeon R300 и новее GeForce 8 и новее1 | GeForce 8 и новее | Нет\nMPEG-4 | Radeon HD 6000 и новее GeForce 200 и новее1 | GeForce 200 и новее\nVC-1 | Radeon HD 2000 и новее GeForce 9300 и новее1 | GeForce 8 и новее2\nH.264/MPEG-4 AVC | Radeon HD 2000 и новее GeForce 8 и новее1 | GeForce 8 и новее | См. #Драйверы VA-API\nH.265/HEVC 8bit | Radeon R9 Fury и новее | GeForce 900 и новее3 | Нет\nH.265/HEVC 10bit | Radeon 400 и новее | Нет4\nVP9 8bit | Нет | GeForce 900 и новее3\nVP9 10bit | Нет | Нет4\n\n- 1 До GeForce GTX 750.\n- 2 Кроме GeForce 8800 Ultra, 8800 GTX, 8800 GTS (320/640 MB).\n- 3 Кроме GeForce GTX 970 и GTX 980.\n- 4 Реализация NVIDIA ограничена 8-битными потоками [8] [9].\n\n"
    },
    {
      "title": "Драйвер NVIDIA",
      "level": 3,
      "content": "Table content:\nКодек | nvidia-utils [10]\nNVDECODE | NVENCODE\nMPEG-2 | Fermi и новее1 | Нет\nVC-1\nH.264/MPEG-4 AVC | Kepler и новее2\nH.265/HEVC 8bit | Maxwell (GM206) и новее | Maxwell (2nd Gen) и новее\nH.265/HEVC 10bit | Pascal и новее\nVP8 | Maxwell (2nd Gen) и новее | Нет\nVP9 8bit | Maxwell (GM206) и новее\nVP9 10bit | Pascal и новее\n\n- 1 Кроме GM108 (не поддерживается)\n- 2 Кроме GM108 и GP108 (не поддерживаются)\n\n"
    },
    {
      "title": "Поддержка приложениями",
      "level": 3,
      "content": "Table content:\nПриложение | Декодирование | Кодирование | Документация\nVA-API | VDPAU | NVDECODE | VA-API | NVENCODE\nFFmpeg | Да | Да | Да | Да | Да | FFmpeg#Hardware video acceleration (англ.)\nGStreamer | Да1 | Да | Да2 | Да1 | Да2 | GStreamer#Hardware video acceleration (англ.)\nKodi | Да | Да | Да | – | – | Kodi#Hardware video acceleration (англ.)\nmpv | Да | Да | Да | – | – | Mpv (Русский)#Аппаратное декодирование\nVLC media player | Да | Да | Нет | – | – | VLC media player#Hardware video acceleration (англ.)\nMPlayer | Да3 | Да | Нет | – | – | MPlayer#Hardware video acceleration (англ.)\nFlash | Нет4 | Да4 | Нет | – | – | Browser plugins#Adobe Flash Player (англ.)\nChromium | Да5 | Нет | Нет | ? | Нет | Chromium#Hardware video acceleration (англ.)\nFirefox | Да6 | Нет | Нет | Нет | Нет | Firefox (Русский)#Аппаратное ускорение видео\nGNOME/Web | Да1 | Да | Да2 | ? | ? | GNOME/Web#Video (англ.)\n\n- 1 GStreamer использует белый список[устаревшая ссылка 2024-01-13 ⓘ] (англ.) драйверов VA-API. Чтобы использовать другие драйверы (например, intel-media-driver), задайте переменную окружения GST_VAAPI_ALL_DRIVERS=1.\n- 2 NVDECODE/NVENCODE отключён в пакете Arch.\n- 3 Поддержка VA-API доступна в mplayer-vaapiAUR[ссылка недействительна: package not found].\n- 4 VDPAU поддерживается только NPAPI-плагином. Доступен экспериментальный адаптер в виде PPAPI-плагина для NPAPI-браузеров, который частично поддерживает ускорение VA-API и VDPAU.\n- 5 Поддержка VA-API доступна в chromium-vaapiAUR[ссылка недействительна: package not found]. Wayland не поддерживается, а Xwayland не работает корректно (англ.) с libva-intel-driver.\n- 6 Начиная с Firefox 75 (firefox-nightlyAUR). В Firefox 75 поддерживаются только технологии H.264 и Wayland, а поддержка отличных от H.264 стандартов реализована в Firefox 76 и выше. Поддержка X11 на данный момент отсутствует. [11][12][13]\n\n"
    }
  ]
}