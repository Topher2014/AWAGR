{
  "title": "Fail2ban (Español)",
  "url": "https://wiki.archlinux.org/title/Fail2ban_(Espa%C3%B1ol)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **2020-08-07** \n\nArtículos relacionados\n\n- sshguard (Español)\n- Security (Español)\n\nFail2ban escanea los archivos de registro (por ejemplo, /var/log/httpd/error_log) y prohíbe las IP que muestran signos maliciosos así como la que muestren muchos errores de contraseña, búsqueda de vulnerabilidades, etc. Normalmente, Fail2ban se utiliza para actualizar las reglas del cortafuegos a fin de rechazar las direcciones IP durante un período de tiempo específico, aunque también permite configurar cualquier otra acción (por ejemplo, enviar un correo electrónico).\n\n"
    },
    {
      "title": "Instalación",
      "level": 2,
      "content": "Instale fail2ban.\n\n"
    },
    {
      "title": "Utilización",
      "level": 2,
      "content": "Configure Fail2ban y active/inicie fail2ban.service.\n\n"
    },
    {
      "title": "fail2ban-client",
      "level": 3,
      "content": "fail2ban-client permite monitorear un «conjunto de reglas encapsuladas» (en adelante, cápsulas) (recarga, reinicio, estado, etc.). Para ver todas las órdenes disponibles:\n\n```\n$ fail2ban-client\n```\n\nPara ver todas las cápsulas activadas:\n\n```\n# fail2ban-client status\n```\n\nPara verificar el estado de una cápsula, por ejemplo para sshd:\n\n```\n# fail2ban-client status sshd\n```\n\n```\nStatus for the jail: sshd\n|- Filter\n|  |- Currently failed: 1\n|  |- Total failed:     9\n|  `- Journal matches:  _SYSTEMD_UNIT=sshd.service + _COMM=sshd\n`- Actions\n   |- Currently banned: 1\n   |- Total banned:     1\n   `- Banned IP list:   0.0.0.0\n```\n\n"
    },
    {
      "title": "Configuración",
      "level": 2,
      "content": "Debido a la posibilidad de que el archivo /etc/fail2ban/jail.conf se sobrescriba o actualice durante una puesta al día de la distribución, se recomienda crear un archivo local /etc/fail2ban/jail.local. Por ejemplo, para cambiar el tiempo de prohibición predeterminado a 1 día:\n\n```\n/etc/fail2ban/jail.local\n```\n\n```\n[DEFAULT]\nbantime = 1d\n```\n\nO cree archivos separados name.local en el directorio /etc/fail2ban/jail.d, por ejemplo /etc/fail2ban/jail.d/sshd.local.\n\nReinicie fail2ban.service para aplicar los cambios de configuración.\n\n"
    },
    {
      "title": "Activar cápsulas",
      "level": 3,
      "content": "Por defecto, todas las cápsulas están desactivadas. Añada enabled = true a la cápsula que desea usar, por ejemplo, para activar la cápsula OpenSSH:\n\n```\n/etc/fail2ban/jail.local\n```\n\n```\n[sshd]\nenabled = true\n```\n\nVea #Cápsula SSH personalizada.\n\n"
    },
    {
      "title": "Recibir un correo electrónico de alerta",
      "level": 3,
      "content": "Si desea recibir un correo electrónico cuando alguien ha sido baneado, debe configurar un cliente SMTP (por ejemplo, msmtp) y cambiar la acción predeterminada, como se indica a continuación.\n\n```\n/etc/fail2ban/jail.local\n```\n\n```\n[DEFAULT]\ndestemail = yourname@example.com\nsender = yourname@example.com\n\n# para prohibir y enviar un correo electrónico con un informe sobre «whois» al correo electrónico.\naction = %(action_mw)s\n\n# hace lo mismo que «action_mw» pero también envía líneas de registro relevantes.\n#action = %(action_mwl)s\n```\n\n"
    },
    {
      "title": "Firewall y servicios",
      "level": 3,
      "content": "Por defecto, Fail2ban utiliza Iptables. Sin embargo, la configuración de la mayoría de cortafuegos y servicios es sencilla. Por ejemplo, para usar Nftables:\n\n```\n/etc/fail2ban/jail.local\n```\n\n```\n[DEFAULT]\nbanaction = nftables\n```\n\nConsulte /etc/fail2ban/action.d/ para ver otros ejemplos, por ejemplo ufw.conf.\n\n"
    },
    {
      "title": "Cápsula SSH personalizada",
      "level": 3,
      "content": "Edite /etc/fail2ban/jail.d/sshd.local, agregue esta sección y actualice la lista de direcciones IP confiables en ignoreip:\n\n```\n/etc/fail2ban/jail.d/sshd.local\n```\n\n```\n[sshd]\nenabled   = true\nfilter    = sshd\nbanaction = iptables\nbackend   = systemd\nmaxretry  = 5\nfindtime  = 1d\nbantime   = 2w\nignoreip  = 127.0.0.1/8\n```\n\n- Podría ser necesario configurar LogLevel VERBOSE en /etc/ssh/sshd_config para permitir la monitorización completa por fail2ban, de lo contrario, los fallos de contraseña podrían no registrarse correctamente.\n- Fail2ban tiene soporte para IPv6 desde la versión 0.10. Adapte su cortafuegos en consecuencia, por ejemplo inicie/active ip6tables.service.\n\n- Si utiliza un front-end para iptables como ufw, se puede usar banaction = ufw en lugar de iptables.\n- Si opta por Shorewall, se puede usar banaction = shorewall y también establecer BLACKLIST en ALL en /etc/shorewall/shorewall.conf, de lo contrario, la regla agregada para prohibir una dirección IP afectará solo a las conexiones nuevas.\n\n"
    },
    {
      "title": "Fortalecer el servicio",
      "level": 3,
      "content": "Actualmente, Fail2ban debe ejecutarse como root. Por lo tanto, es posible que desee considerar fortalecer el proceso con systemd (Español).\n\nCree un archivo de configuración drop-in para fail2ban.service:\n\n```\n/etc/systemd/system/fail2ban.service.d/override.conf\n```\n\n```\n[Service]\nPrivateDevices=yes\nPrivateTmp=yes\nProtectHome=read-only\nProtectSystem=strict\nNoNewPrivileges=yes\nReadWritePaths=-/var/run/fail2ban\nReadWritePaths=-/var/lib/fail2ban\nReadWritePaths=-/var/log/fail2ban\nReadWritePaths=-/var/spool/postfix/maildrop\nReadWritePaths=-/run/xtables.lock\nCapabilityBoundingSet=CAP_AUDIT_READ CAP_DAC_READ_SEARCH CAP_NET_ADMIN CAP_NET_RAW\n```\n\nEl parámetro CAP_DAC_READ_SEARCH de CapabilityBoundingSet permitirá a Fail2ban el acceso de lectura completa a cada directorio y archivo. Los parámetros CAP_NET_ADMIN y CAP_NET_RAW permitirán que Fail2ban funcione en cualquier cortafuegos que tenga una interfaz en línea de órdenes. Consulte capabilities(7) para obtener más información.\n\nAl usar ProtectSystem=strict la jerarquía del sistema de archivos será de «solo lectura», ReadWritePaths permitirá que Fail2ban tenga acceso de escritura en las rutas que considere necesarias.\n\nCree /etc/fail2ban/fail2ban.local con la ruta correcta logtarget:\n\n```\n/etc/fail2ban/fail2ban.local\n```\n\n```\n[Definition]\nlogtarget = /var/log/fail2ban/fail2ban.log\n```\n\nCree el directorio /var/log/fail2ban/ como root.\n\nFinalmente, recargue el demonio de systemd para aplicar los cambios de la unidad y reinicie fail2ban.service.\n\n"
    },
    {
      "title": "Véase también",
      "level": 2,
      "content": "- Using a Fail2Ban Jail to Whitelist a User\n- Optimising your Fail2Ban filters\n- Fail2Ban and sendmail\n- Fail2Ban and iptables\n- Fail2Ban 0.8.3 Howto\n- Monitoring the fail2ban log\n- Supervisión del registro de fail2ban\n\n"
    }
  ]
}