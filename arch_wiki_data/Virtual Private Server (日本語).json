{
  "title": "Virtual Private Server (日本語)",
  "url": "https://wiki.archlinux.org/title/Virtual_Private_Server_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- サーバー\n\nWikipedia:ja:バーチャル・プライベート・サーバ より:\n\nこの記事では仮想専用サーバーにおける Arch Linux の利用について検討して、VPS 固有のインストール手順・フィックスなども述べます。\n\n- Linux 2.6.32 は systemd バージョン 205 からサポートされていません (そして systemd 212 以降では動作しません)。コンテナによる仮想化環境は多くが古いカーネルを使っており、そのような環境では Arch Linux を最新状態に保つことができない可能性があります。ただし、OpenVZ は、カーネルビルド 042stab094.7 から、CLOCK_BOOTTIME 機能をバックポートしているため最新の systemd でも動作します。\n- systemd バージョン 220 から OpenVZ コンテナで動作しません [1]。この問題は OpenVZ カーネル 042stab111.1 で修正されました [2]。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 Arch Linux を提供しているプロバイダ\n- 2 インストール 2.1 KVM 2.2 OpenVZ 2.2.1 OpenVZ プロバイダで最新の Arch Linux をインストール 2.2.1.1 必須要件 2.2.1.2 クリーンな Arch Linux 環境を作成 2.2.1.3 VPS にあるものを全て Arch 環境と置き換える 2.2.1.4 設定 2.3 Xen\n\n- 2.1 KVM\n- 2.2 OpenVZ 2.2.1 OpenVZ プロバイダで最新の Arch Linux をインストール 2.2.1.1 必須要件 2.2.1.2 クリーンな Arch Linux 環境を作成 2.2.1.3 VPS にあるものを全て Arch 環境と置き換える 2.2.1.4 設定\n- 2.3 Xen\n\n- 2.2.1 OpenVZ プロバイダで最新の Arch Linux をインストール 2.2.1.1 必須要件 2.2.1.2 クリーンな Arch Linux 環境を作成 2.2.1.3 VPS にあるものを全て Arch 環境と置き換える 2.2.1.4 設定\n\n- 2.2.1.1 必須要件\n- 2.2.1.2 クリーンな Arch Linux 環境を作成\n- 2.2.1.3 VPS にあるものを全て Arch 環境と置き換える\n- 2.2.1.4 設定\n\n"
    },
    {
      "title": "Arch Linux を提供しているプロバイダ",
      "level": 2,
      "content": "- カスタムディスクイメージをロード (Xen や KVM などのハードウェア仮想化が必須)\n- chroot 下でインストール、例えば vps2arch スクリプトを使う (systemd 220/221 の バグ に対応しています)\n- 他のディストリビューション上で rsync を使って Arch を同期して、OpenVZ プロバイダで最新の Arch Linux をインストール\n\nTable content:\nプロバイダ | Arch リリース | 仮想化 | 場所 | 注記\n4smart.cz | 2013.08 | OpenVZ | プラハ, CZ | (チェコ語のサイト) システムをアップデートするときは pacman.conf で [tredaelli-systemd] を使うようにしてください。\nABLENET VPS | 2015.05.01 | KVM | 大阪 | \naffinity.net.nz | 2013.08.01 | KVM | オークランド, ニュージーランド (NZ) | IRC チャンネルが ircs.kiwicon.org の #affinity に存在します。\nAtlantic.Net | 2015.05.01 | KVM | NYC/SF/トロント/ダラス/オーランド, US & カナダ | 100% SSD のワンクリック Arch Linux。30秒ですぐにセットアップ。\nBuyVM | 2013.07.01 | KVM | LA, バッファロー NY | 登録時には別の OS を選択しなくてはなりません。アクセスできるようになったら、最新の Arch ISO をマウントして再起動を選択して手動でインストールします。\nCoinshost | 2015.04 | Xen | チューリッヒ, スイス | Bitcoin などの暗号通貨が使えます。\nConoHa | 2017.05.08 | KVM | 日本(東京), アメリカ(サンノゼ), シンガポール | \nCherry Host | 最新 | KVM | サンティー, US-CA | Arch をインストールするにはサポートチケットを送信する必要があります。\nDirectVPS | 2014.01.xx | OpenVZ | アムステルダム, NL; ロッテルダム, NL | オランダ語のサイト。\nEdis | 2013.03.01 | vServer, KVM, OpenVZ | 世界中に多数所在 | 専用サーバや、マン島 (IM) にある\"オフショア\"な場所も選べます。\nGigaTux | 2013.06.01 | Xen | シカゴ, US-IL; フランクフルト, DE; ロンドン, GB; サンノゼ, US-CA | \nHost Virtual | 2014.06.01 | KVM | 世界中に多数所在 | KVM 仮想化を使っています。\"Xen ベースの仮想化\"をうたっており ISO からインストールできる 機能 リストがサイトに存在します。\nHostigation | 最新 | OpenVZ, KVM | シャーロット, US-NC; ロサンジェルス, US-CA | \nKloud51 | 最新 | OpenVZ | US-CA, カナダ | SSD, 2つのイメージが存在: ベアボーン環境あるいは OpenBox, XRDP, Firefox, Fail2ban, Geany, Yaourt などが設定済みのデスクトップ。\nLeapswitch Networks | 2013.10.xx | OpenVZ/KVM | USA, インド, ポルトガル, スペイン, ウクライナ, ドイツ | 現在 Arch Linux はコントロールパネルから再インストールするときだけ選べます。申し込みフォームにはありません。\nLinevast.de | 最新 | OpenVZ, KVM | ドイツ | ワンクリックの OS インストーラーで OpenVZ や KVM で動作する Arch Linux を選べます。\nLinode.com | 2016.06.01 | Xen, KVM | 東京, JP; US 複数; ロンドン, GB | カスタムカーネルを実行するために、linux-linodeAUR をインストールしてください (linux では32ビットの Linode 上で動作しません)。最初は NIC の enp4s0 は eth0 に名前が変更されますが再起動すると enp4s0 に戻ります。再起動で sshd で接続できなくなる可能性があります。\nLYLIX | 2014.01.xx | OpenVZ | US 複数; ヨーロッパ | 32ビットと64ビットが利用可能。\nNetcup | 2012.11.xx | KVM | ドイツ (DE) | ドイツ語のサイト。\nお名前.com VPS | 2011.08.19 | KVM | 日本 | \nOnePoundWebHosting | 2013.05.xx | Xen PV, Xen HVM | イギリス (UK) | レジストラでもあります。サーバーの場所は特定できません。\nOVH | 最新 | KVM | フランス, カナダ | \nPacmanVPS | 最新 | KVM | カナダ (CA), ポーランド (PL) | 全てのカーネルに対応。テンプレートを使用するか VNC コンソールで ISO から手動でインストールできます。\nProplay | 最新 | OpenVZ, KVM | ドイツ (DE) | ドイツ語のサイト。\nRackspace Cloud | 2013.6 | Xen | 世界中に多数所在 | 料金は時間単位。\"next gen\" の VPS を使って下さい (mycloud.rackspace.com パネルを使用)。第1世代の Rackspace VPS の Arch イメージは古くなっています。\nRamHost.us | 2013.05.01 | OpenVZ, KVM | ロサンゼルス, US-CA; 英国 (GB); アトランタ, US-GA; ドイツ (DE) | RamHost の IRC ネットワークで最新 ISO をリクエストできます。\nRamNode | 2016.01.01 | SSD と SSD キャッシュ: KVM | アルブラッセルダム, NL; アトランタ, GA-US; ロサンゼルス, CA-US; ニューヨーク, NY-US; シアトル, WA-US | KVM サービスで Host/CPU パススルーができます [3]。頻繁にセールをやっています [4]。VNC ビューアを使って ISO から手動で Arch をインストールする必要があります。\nRoseHosting | 最新 | OpenVZ, KVM | セントルイス, ミズーリ, USA | SSD によるホスティングプランがあり24時間365日サポート。\nSeedVPS | 最新 | OpenVZ, KVM | アムステルダム, オランダ | オランダ (NL) の Linux VPS と Windows VPS ホスティング。サポートチケットで新しい ISO をリクエストできます。\nTilaa | 2016.03.01 | KVM | アムステルダム, NL | \nTransIP | 2017.01.01 | KVM | アムステルダム, NL | レジストラ。\nupCUBE | 最新 | Docker | ドイツ | 様々な Arch Linux テンプレートが用意されています。\nVirpus | 2014.11.07 | Xen | カンザスシティ, US-KS; ロサンジェルス, US-CA | Wow Technologies, Inc の子会社。ライブチャット、メール、電話、チケットシステムによる24時間365日サポート。\nVirtual Master | 2012-08 | ?? | プラハ, CZ | \nVPS6.NET | 2013.01.xx | OpenVZ, Xen, HVM-ISO | US 複数; フランクフルト, DE; ブカレスト, RO; イスタンブール, TR | レジストラ。\nVPSBG.eu | 2013.10 | OpenVZ | ソフィア, ブルガリア | ブルガリアのオフショア VPS - 匿名の登録と Bitcoin による支払いが可能。\nVPSSERVER | 2015.07 | KVM | シカゴ, US-IL; ダラス, US-TX; マイアミ, US-FL; ニューヨーク, US-NY; シリコンバレー, US-CA; アムステルダム, NL; フランクフルト, DE; ロンドン, UK | \nWorld4You | 2015.10.28 | OpenVZ | オーストリア (AT) | インターネットホスティングプロバイダ。クイックセットアップ。24時間365日対応。共有ウェブホスティング。CentOS, Debian, Ubuntu, Fedora, Arch の OpenVZ サーバー。新しい systemd (227) に対応。\nXenVZ | 2009.12.07 | OpenVZ, Xen | イギリス (UK), アメリカ (US) | ハードウェア\n1984hosting.com | 2016.x | Xen | アイスランド (IS) | ハードウェア はあらゆるイメージを使うことができ、デフォルトのイメージリストに Arch が存在します。\n\n"
    },
    {
      "title": "KVM",
      "level": 3,
      "content": "QEMU#(Arch) Linux ゲストを用意するを見て下さい。\n\n"
    },
    {
      "title": "OpenVZ プロバイダで最新の Arch Linux をインストール",
      "level": 4,
      "content": "Arch Linux のインストール環境を使用中の OpenVZ VPS の上から直接コピーすることができます。このチュートリアルでは pacstrap を使って (標準的なインストールと同じように) Arch Linux の基本的なインストール環境を作成してから rsync を使って対象の VPS の中身を置き換える方法を説明します。\n\nこの方法は (少しばかり修正を加えることで) 既存の Arch 環境を様々な環境に移植するのにも使うことができ、OpenVZ から Xen に、または Xen から OpenVZ に移行するときも使えることが確認済みです。Xen などのハードウェア仮想化プラットフォーム (もしくは物理ハードウェア) にインストールするときは、別段の作業が必要になります (mkinitcpio の実行とブートローダーのインストール)。\n\n- Arch Linux マシン 物事を簡単にするために、インストール先の VPS とアーキテクチャは同じにしてください (x86_64 または i686)。 他のディストリビューションから環境を作成したい場合、arch-bootstrap.sh を使うことで pacstrap を置き換えられます。\n- 公式リポジトリの arch-install-scripts, rsync, openssh パッケージ SSH は必ずしも必要なわけではありませんが、ここでは SSH 経由で rsync を使用します。\n- 何らかのディストリビューションが動作していて rsync と SSH サーバーが立ち上がっている VPS OpenVZ があなたのインストール先のアーキテクチャをサポートしていればアーキテクチャは特に問題ありません (x86_64 または i686)。\n- OpenVZ のシリアルコンソール機能 (通常はプロバイダのコントロールパネルからアクセスできます) シリアルコンソールが使えない場合、以下の環境作成のすぐ後に VPS のネットワーク設定をする必要があります。\n\n- 物事を簡単にするために、インストール先の VPS とアーキテクチャは同じにしてください (x86_64 または i686)。\n- 他のディストリビューションから環境を作成したい場合、arch-bootstrap.sh を使うことで pacstrap を置き換えられます。\n\n- SSH は必ずしも必要なわけではありませんが、ここでは SSH 経由で rsync を使用します。\n\n- OpenVZ があなたのインストール先のアーキテクチャをサポートしていればアーキテクチャは特に問題ありません (x86_64 または i686)。\n\n- シリアルコンソールが使えない場合、以下の環境作成のすぐ後に VPS のネットワーク設定をする必要があります。\n\nroot で、新しい環境を作成 (任意で build は適当なディレクトリに置き換えてください):\n\n```\n# mkdir build\n# pacstrap -cd build\n```\n\npacstrap コマンドに以下のオプションを付けても良いでしょう:\n\n- -C custom-pacman-config.conf - pacman のカスタム設定ファイルを使用。デフォルトでは pacstrap はローカルの pacman.conf に従って環境構築します。設定ファイルによって作成環境のアーキテクチャ (i686 または x86_64) やミラーリストなどが決定されます。\n- -G - pacstrap がシステムの pacman キーリングを新しい環境にコピーしないようにします。このオプションを使う場合、設定ステップでキーリングをセットアップするために pacman-key --init と pacman-key --populate archlinux を実行する必要があります。\n- -M - pacstrap がシステムの pacman ミラーリストを新しい環境にコピーしないようにします。\n- デフォルトの base パッケージ以外にも、インストールしたいパッケージを pacstrap に追加できます。例: pacstrap -cd build base openssh dnsutils gnu-netcat traceroute vim。\n\nVPS 上の全てのファイルやディレクトリを build ディレクトリの中身で置き換えてください (\"YOUR.VPS.IP.ADDRESS\" は適当なアドレスに置き換えてください):\n\n```\n# rsync -axH --delete-delay -e ssh --stats -P build/ YOUR.VPS.IP.ADDRESS:/\n```\n\nオプションの説明:\n\n- -a - 必須。タイムスタンプやパーミッションなどをそのままコピーします。\n- --delete - 必須。コピー元に存在しないものを削除します。\n- -x - 重要。異なったファイルシステムのサブディレクトリをコピーしない (他のパーティションや /dev など)。\n- -H - 重要。ハードリンクを許可しない。\n- --delete-delay - 推奨。同期が完了するまで消去を行わない。転送速度が遅い場合に VPS をロックアップさせてしまう危険性を減らします。\n- -e ssh - 推奨。SSH で rsync を使用 (rsync サーバーをセットアップするのと比較して簡単です)。\n- -P - 推奨。転送中に進捗情報を表示。\n- --stats - 推奨。最後に転送情報を表示。\n\n1. (プロバイダーのコントロールパネルなどを使って) VPS を再起動。\n1. OpenVZ のシリアルコンソール機能を使って、ネットワークを設定してシステムの基本設定を行う (fstab の生成と arch-chroot は要りません)。 シリアルコンソール機能が使えない場合、Arch を VPS に同期させる前にネットワークの設定をあらかじめ行う必要があります。 一部の VPS では接続するゲートウェイが存在しません。以下はそのような場合の netctl の設定例です。venet0 で固定 IP アドレスとデフォルトルートを設定して Google Public DNS を使用します:\n\n- シリアルコンソール機能が使えない場合、Arch を VPS に同期させる前にネットワークの設定をあらかじめ行う必要があります。\n- 一部の VPS では接続するゲートウェイが存在しません。以下はそのような場合の netctl の設定例です。venet0 で固定 IP アドレスとデフォルトルートを設定して Google Public DNS を使用します:\n\n```\n/etc/netctl/venet\n```\n\n```\nDescription='VPS venet connection'\nInterface=venet0\nConnection=ethernet\n\nIP=static\nAddress=('192.0.2.42/32')\nRoutes=('default')\n\nIP6=static\nAddress6=('2001:db8::1234:5678/128')\nRoutes6=('default')\n\nDNS=('2001:4860:4860::8888' '2001:4860:4860::8844' '8.8.8.8' '8.8.4.4')\n```\n\n"
    },
    {
      "title": "Xen",
      "level": 3,
      "content": "Xen#ハードウェア仮想化 (HVM) Arch domU の設定や Xen#準仮想化 (PV) Arch domU の設定を見て下さい。\n\n"
    }
  ]
}