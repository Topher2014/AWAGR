{
  "title": "OpenRC (日本語)",
  "url": "https://wiki.archlinux.org/title/OpenRC_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- init\n\nOpenRC は Gentoo の開発者によってメンテナンスされている init システムです。OpenRC は依存関係を前提とした init システムで、sysvinit などの init プログラムが動いているシステムで動作します。OpenRC は sysvinit を置き換えるものではありません。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール 1.1 ブート\n- 2 設定 2.1 サービス 2.2 ネットワーク 2.3 ブートログ 2.4 ホストネーム 2.5 モジュールの自動ロード 2.6 ロケール\n- 3 使用方法\n- 4 ヒントとテクニック 4.1 ブートメッセージを消す\n- 5 トラブルシューティング 5.1 /tmp のアンマウント時にエラーが起こる 5.2 IPv6 が無効にできない 5.3 シャットダウン中に読み込み専用での root の再マウントが失敗する 5.4 /etc/sysctl.conf not found 5.5 opentmpfiles-setup failed to start\n- 6 systemd に戻す\n- 7 参照\n\n- 1.1 ブート\n\n- 2.1 サービス\n- 2.2 ネットワーク\n- 2.3 ブートログ\n- 2.4 ホストネーム\n- 2.5 モジュールの自動ロード\n- 2.6 ロケール\n\n- 4.1 ブートメッセージを消す\n\n- 5.1 /tmp のアンマウント時にエラーが起こる\n- 5.2 IPv6 が無効にできない\n- 5.3 シャットダウン中に読み込み専用での root の再マウントが失敗する\n- 5.4 /etc/sysctl.conf not found\n- 5.5 opentmpfiles-setup failed to start\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "OpenRC は AUR から利用可能です。openrcAUR または openrc-gitAUR パッケージを選んでインストールできます。\n\nバージョン 0.25 から、OpenRC には独自の init が付属しており /usr/bin/openrc-init にインストールされます。任意で busybox や openrc-sysvinitAUR (伝統的な sysvinit に多少のパッチがあてられたバージョン) など他の init を使うこともできます。openrc-init を使用する場合、他のパッケージの shutdown や reboot コマンドの代わりに openrc-shutdown を使う必要があります。そうしないとエラーが発生します。\n\n基本的なサービスファイルは openrc-arch-services-gitAUR パッケージでインストールできます。他にもサービスファイルが含まれたパッケージが存在します。AUR を検索してください。\n\ninitscripts-forkAUR との互換性を保つために、設定ファイルは /etc/openrc/ にインストールされます。\n\n"
    },
    {
      "title": "ブート",
      "level": 3,
      "content": "OpenRC を使って起動するには使用する init をカーネルパラメータに追加してください。\n\nOpenRC に付属している init の場合は init=/usr/bin/openrc-init を追加します。 openrc-sysvinitAUR を使用する場合は /usr/bin/init-openrc に置き換えてください。\n\nopenrc-init を使用する場合、/etc/inittab ファイルは使用されないことに注意してください。\n\n"
    },
    {
      "title": "設定",
      "level": 2,
      "content": "OpenRC の設定は /etc/openrc/conf.d ディレクトリと /etc/openrc/rc.d ファイルで行います。\n\n設定に関する詳細な資料は以下を参照してください:\n\n- OpenRC の man ページ\n- OpenRC の移行\n- gentoo wiki\n\nsystemd から移行する場合は Init#設定を参照。\n\n"
    },
    {
      "title": "サービス",
      "level": 3,
      "content": "OpenRC のサービスは root で rc-update add service_name runlevel を実行することで有効にできます。最低でも以下のサービスを有効化することが推奨されます:\n\nTable content:\nサービス名 | ランレベル | 説明\nudev | sysinit | デバイスのホットプラグ\nalsa | default | ALSA の状態\nacpid | default | ACPI イベント\ndbus | default | メッセージバス\ndcron | default | スケジュール\nsyslog-ng | default | システムログ\n\n必要に応じて、/etc/openrc/init.d/getty へのシンボリックリンクを作成して、必要な getty ごとにサービスを作成します。例: /dev/tty1:\n\n```\n# ln -s /etc/openrc/init.d/agetty{,.tty1}\n# rc-update add agetty.tty1 default\n```\n\nPAM が tty にログインした後に systemd に登録しようとするのを防ぐため (が問題を引き起こす可能性があります)、/etc/pam.d/system-auth 内の systemd に言及する行を削除するかコメントアウトすると安全です。\n\nGentoo:Systemd#Native services も参照してください。\n\n"
    },
    {
      "title": "ネットワーク",
      "level": 3,
      "content": "ネットワークを立ち上げて動かす方法は複数存在します。一つは /etc/openrc/conf.d/network ファイルを設定することです。ip (iproute2) と ifconfig (net-tools) 両方のコマンドがサポートされています。\n\n以下は ip を使った設定の例です。\n\n```\nip_eth0=\"192.168.1.2/24\"\ndefaultiproute=\"via 192.168.1.1\"\nifup_eth0=\"ip link set \\$int mtu 1500\"\n```\n\nネットワーク サービスはデフォルトでブートランレベルに追加されるため、それ以上の操作は必要ありません。一般的な、ネットワークの設定の詳細においてはネットワーク設定を見て下さい。\n\n"
    },
    {
      "title": "ブートログ",
      "level": 3,
      "content": "ブートログを有効にするには、/etc/openrc/rc.conf の rc_logger=\"YES\" 行のコメントを解除します。有効にすると、ブートログは /var/log/rc.log に保存されます。\n\n"
    },
    {
      "title": "ホストネーム",
      "level": 3,
      "content": "OpenRC は /etc/openrc/conf.d/hostname からホストネームを設定します。\n\n以下は設定ファイルの例:\n\n```\n/etc/openrc/conf.d/hostname\n```\n\n```\nhostname=\"myhostname\"\n```\n\n"
    },
    {
      "title": "モジュールの自動ロード",
      "level": 3,
      "content": "OpenRC は /etc/modules-load.d/ フォルダを使用せず、そのかわりに /etc/openrc/conf.d/modules を使います。\n\nこのファイルに以下のように行を追加してください:\n\n```\nmodules=acpi_cpufreq\n```\n\n"
    },
    {
      "title": "ロケール",
      "level": 3,
      "content": "OpenRC でロケールを設定する方法が備わっていません。しかしながら、/etc/locale.conf ファイルを使って設定することが可能です。このファイルは /etc/profile.d/locale.sh で読み込まれます。\n\nロケールの設定に関する詳細は、ロケールを参照してください。\n\n"
    },
    {
      "title": "使用方法",
      "level": 2,
      "content": "このセクションでは、systemd と他の init システムとの類似点を示します。\n\n特に カーネルパラメータ を一時的に編集する場合は、.service および .target 拡張子を省略できます。\n\nTable content:\nsystemd | SysVinit | OpenRC | 説明\nsystemctl list-units | rc.d list | rc-status | 実行中のサービスのステータスを一覧表示する\nsystemctl --failed |  | rc-status --crashed | 失敗したサービスを確認する\nsystemctl --all |  | rc-update -v show | 利用可能なサービスをすべて表示します\nsystemctl (start, stop, restart, status) daemon.service | rc.d (start, stop, restart) daemon | rc-service daemon (start, stop, restart, status) | サービス状態の変更\nsystemctl (enable, disable) daemon.service | chkconfig daemon (on, off) | rc-update (add, del) daemon | サービスをオンまたはオフにします\nsystemctl daemon-reload | chkconfig daemon --add |  | 設定を作成または変更します\n\n"
    },
    {
      "title": "ブートメッセージを消す",
      "level": 3,
      "content": "OpenRC でブートメッセージを非表示にするには、/etc/inittab を編集して全ての openrc コマンドに --quiet を追加してください。詳しい情報は $ openrc -h で確認できます。\n\n"
    },
    {
      "title": "/tmp のアンマウント時にエラーが起こる",
      "level": 3,
      "content": "システムをシャットダウンするときに、以下のようなエラーメッセージが表示されることがあります:\n\n```\n* Unmounting /tmp ... \n* in use but fuser finds nothing [ !! ]\n```\n\nこの問題は /etc/openrc/conf.d/localmount に以下を追加することで修正できます:\n\n```\nno_umounts=\"/tmp\"\n```\n\n"
    },
    {
      "title": "IPv6 が無効にできない",
      "level": 3,
      "content": "OpenRC は /etc/openrc の sysconf ディレクトリにインストールした場合に起こります。\n\n/etc/openrc/sysctl.d 下のファイル (拡張子は .conf にしてください) に以下を記述することで修正できます:\n\n```\n# Disable ipv6\nnet.ipv6.conf.all.disable_ipv6 = 1\n```\n\n"
    },
    {
      "title": "シャットダウン中に読み込み専用での root の再マウントが失敗する",
      "level": 3,
      "content": "この問題が発生する場合、/etc/openrc/init.d/mount-ro を編集して以下を:\n\n```\ntelinit u\n```\n\n次の行の後に記述してください:\n\n```\n# Flush all pending disk writes now\nsync; sync\n```\n\n"
    },
    {
      "title": "/etc/sysctl.conf not found",
      "level": 3,
      "content": "デフォルトで、sysctl の設定をロードするために sysctl --system が実行されます [2]。Arch では存在しない /etc/sysctl.conf も読み込まれます [3]。\n\nファイルが見つからないというエラーを表示させたくない場合、ファイルを作成してください:\n\n```\n# touch /etc/sysctl.conf\n```\n\n"
    },
    {
      "title": "opentmpfiles-setup failed to start",
      "level": 3,
      "content": "OpenRC の起動時に以下のようなメッセージが表示される場合:\n\n```\n* Setting up tmpfiles.d entries ...\nchattr: Operation not supported while setting flags on /var/log/journal\nchattr: No such file or directory while trying to stat /var/log/journal/%m\nchattr: Operation not supported while setting flags on /var/log/journal/remote\n[ !! ]\nERROR: opentmpfiles-setup failed to start\n```\n\n/usr/lib/tmpfiles.d/journal-nocow.conf で btrfs ファイルシステム上にジャーナルがある場合にしか使えないオプションが有効になっていることが原因です。詳しくは https://github.com/OpenRC/opentmpfiles/issues/2 を参照してください。\n\n空の /etc/tmpfiles.d/journal-nocow.conf ファイルを作成することで設定を上書きできます。\n\n"
    },
    {
      "title": "systemd に戻す",
      "level": 2,
      "content": "大抵の場合 systemd に戻すのは簡単です。OpenRC から systemd に移行する際は、以下の点に注意してください:\n\n- カーネルコマンドラインの init= パラメータの編集。\n- OpenRC 向けに改造された、systemd を使用しないパッケージを標準のパッケージに置き換え (例: dbus-nosystemdAUR を dbus に置換)\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- Wikipedia:OpenRC\n- Gentoo wiki\n- Arch 上の OpenRC に関するフォーラムスレッド\n- Blog: OpenRC on Arch Linux\n- Manjaro wiki\n\n"
    }
  ]
}