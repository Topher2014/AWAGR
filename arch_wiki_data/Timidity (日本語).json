{
  "title": "Timidity (日本語)",
  "url": "https://wiki.archlinux.org/title/Timidity_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "TiMidity++ はハードウェアシンセサイザを使わずに MIDI ファイルを再生するためのソフトウェアシンセサイザです。リアルタイムにサウンドカードにレンダリングすることも、PCM .wav ファイルなどに保存することも、どちらも可能です。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール\n- 2 設定 2.1 SoundFont 2.1.1 Freepats 2.1.2 Fluidr3 2.2 デーモン\n- 3 使用方法 3.1 ファイルの再生 3.1.1 スタンドアロンモード 3.1.2 デーモンモード 3.1.3 仮想 MIDI デバイスに接続\n- 4 トラブルシューティング 4.1 TiMidity++ が MIDI ファイルを再生しない 4.2 デーモンモードで再生速度がおかしい\n- 5 ヒントとテクニック 5.1 ファイルの変換 5.2 DOSBox で TiMidity++ を使う方法\n- 6 関連項目\n\n- 2.1 SoundFont 2.1.1 Freepats 2.1.2 Fluidr3\n- 2.2 デーモン\n\n- 2.1.1 Freepats\n- 2.1.2 Fluidr3\n\n- 3.1 ファイルの再生 3.1.1 スタンドアロンモード 3.1.2 デーモンモード 3.1.3 仮想 MIDI デバイスに接続\n\n- 3.1.1 スタンドアロンモード\n- 3.1.2 デーモンモード\n- 3.1.3 仮想 MIDI デバイスに接続\n\n- 4.1 TiMidity++ が MIDI ファイルを再生しない\n- 4.2 デーモンモードで再生速度がおかしい\n\n- 5.1 ファイルの変換\n- 5.2 DOSBox で TiMidity++ を使う方法\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "timidity++ パッケージをインストールしてください。\n\nまた、音を出すために SoundFont もインストールする必要があります。SoundFont の一覧:\n\n- freepats-general-midi\n- soundfont-fluid\n- soundfont-generaluserAUR\n- soundfont-arachnoAUR\n\n"
    },
    {
      "title": "設定",
      "level": 2,
      "content": "まずユーザーを audio グループに追加する必要があります。\n\n```\n# gpasswd -a <user> audio\n```\n\n"
    },
    {
      "title": "SoundFont",
      "level": 3,
      "content": "選択した SoundFont を設定してください。\n\n"
    },
    {
      "title": "Freepats",
      "level": 4,
      "content": "Freepats プロジェクトは TiMidity++ と互換性のあるインストサンプルセットを提供しています。\n\nTiMidity と一緒に Freepats を使うには、以下の行を timidity.cfg に追加してください:\n\n```\n/etc/timidity/timidity.cfg\n```\n\n```\nsoundfont /usr/share/soundfonts/freepats-general-midi.sf2\n```\n\n"
    },
    {
      "title": "Fluidr3",
      "level": 4,
      "content": "他にも利用できる SoundFont があります。以下は soundfont-fluid SoundFont のインストール方法です。\n\nパッケージをインストールしたらパスを TiMidity++ 設定ファイルに追加する必要があります。次の行を追加してください:\n\n```\n/etc/timidity/timidity.cfg\n```\n\n```\nsoundfont /usr/share/soundfonts/FluidR3_GM.sf2\n```\n\n"
    },
    {
      "title": "デーモン",
      "level": 3,
      "content": "timidity.service を実行するように設定してください。詳しくはデーモンを読んで下さい。\n\nPulseAudio を使っている場合、動作しないことがあります。デスクトップ環境の自動実行プログラムに以下の行を追加することができます。もしくは、デーモンモードで TiMidity++ を起動したい場合、以下のコマンドを使うことでコンソールに出力させることが可能です:\n\n```\n$ timidity -iA\n```\n\nSystemd/ユーザー を使ってユーザーの TiMidity++ サービスを書き込むことも可能です。~/.config/systemd/user/ に以下のように timidity.service ファイルを書いて下さい:\n\n```\n~/.config/systemd/user/timidity.service\n```\n\n```\n[Unit]\nDescription=TiMidity++ Daemon\nAfter=sound.target\n\n[Service]\nExecStart=/usr/bin/timidity -iA -Os\n\n[Install]\nWantedBy=default.target\n```\n\n以下のコマンドを実行することでユーザーがログインしたときに自動的に Timidity++ が起動するようになります:\n\n```\n$ systemctl --user enable timidity.service:\n```\n\n"
    },
    {
      "title": "ファイルの再生",
      "level": 3,
      "content": "TiMidity++ を使う方法は2つあります。MIDI プレイヤーとしてか ALSA の MIDI デーモンとしてかです。\n\n"
    },
    {
      "title": "スタンドアロンモード",
      "level": 4,
      "content": "TiMidity++ を使って簡単に MIDI ファイルを再生できます:\n\n```\n$ timidity example.midi\n```\n\n-in もしくは -ig オプションを加えることでテキストベース・GTK+ のインターフェースが表示されます。例えば Xfce/GNOME ユーザーは MIDI ファイルをカスタムコマンド timidity -ig で開くように設定することができます。TiMidity++ には他にも多くのオプションが存在します。timidity(1) を見るか -h を使ってヘルプを見て下さい。\n\nGTK+ インターフェースには、プレイリスト・音量コントロール・ピッチや再生速度の変更オプションなどの機能があります。\n\n"
    },
    {
      "title": "デーモンモード",
      "level": 4,
      "content": "デーモン (ALSA sequencer client) として TiMidity++ を実行している場合 rosegarden, aplaymidi, vkeybd など他のプログラムに MIDI 出力のサポートを提供します。\n\nデーモンモードでは4つのソフトウェア MIDI ポートが作られます:\n\n```\n$ aconnect -o\n```\n\n```\nclient 128: 'TiMidity' [type=user]\n    0 'TiMidity port 0 '\n    1 'TiMidity port 1 '\n    2 'TiMidity port 2 '\n    3 'TiMidity port 3 '\n```\n\naplaymidi を使って MIDI ファイルを再生するには:\n\n```\n$ aplaymidi filename.mid --port 128:0\n```\n\n他に X の仮想 MIDI キーボード vkeybd を使うこともできます。\n\nvkeybdAUR は AUR からインストール可能です。\n\n```\n$ vkeybd --addr 128:0\n```\n\nオプション --addr 128:0 は vkeybd による入力 (読み込み可能) ソフトウェア MIDI ポートを Timidity による最初の出力 (書き込み可能) ALSA ポートに接続します。また aconnect, patchage, kaconnect を使うこともできます。これで vkeybd のキーで演奏すると TiMidity++ が対応する音を再生します。\n\n"
    },
    {
      "title": "仮想 MIDI デバイスに接続",
      "level": 4,
      "content": "TiMidity++ デーモンを動作させ aplaymidi で動くようにできたのならば、rosegarden や scala などのプログラムで動作する仮想 MIDI デバイスに接続することができます。\n\nsnd-virmidi カーネルモジュールをロードして、（任意で）起動時にロードするように設定してください。詳しくはカーネルモジュールを読んで下さい。\n\naconnect を使ってポート番号を確認します:\n\n```\n$ aconnect -o\n```\n\n```\nclient 14: 'Midi Through' [type=kernel]\n     0 'Midi Through Port-0'\n client 20: 'Virtual Raw MIDI 1-0' [type=kernel]\n     0 'VirMIDI 1-0     '\n client 21: 'Virtual Raw MIDI 1-1' [type=kernel]\n     0 'VirMIDI 1-1     '\n client 22: 'Virtual Raw MIDI 1-2' [type=kernel]\n     0 'VirMIDI 1-2     '\n client 23: 'Virtual Raw MIDI 1-3' [type=kernel]\n     0 'VirMIDI 1-3     '\n client 128: 'TiMidity' [type=user]\n     0 'TiMidity port 0 '\n     1 'TiMidity port 1 '\n     2 'TiMidity port 2 '\n     3 'TiMidity port 3 '\n```\n\nそして接続を作成してください:\n\n```\n$ aconnect 20:0 128:0\n```\n\nこれでシステム上に動作する MIDI 出力デバイスができたはずです (/dev/snd/midiC1D0)。\n\n"
    },
    {
      "title": "TiMidity++ が MIDI ファイルを再生しない",
      "level": 3,
      "content": "SoundFile が正しく設定されていないのかもしれません。次を実行してください:\n\n```\n$ timidity example.midi\n```\n\n次のような表示が端末出力にあったら、あなたの SoundFile は正しく設定されていません。\n\n```\nNo instrument mapped to tone bank 0, program XX - \\\nthis instrument will not be heard\n```\n\nサンプルをインストールして SoundFile を /etc/timidity/timidity.cfg に追加してください。詳しくは SoundFont を見て下さい。\n\n"
    },
    {
      "title": "デーモンモードで再生速度がおかしい",
      "level": 3,
      "content": "この問題 は TiMidity++ の (デフォルトの) ALSA 出力モジュールを ALSA サーバーモードで使った時に発生します。libao など、他の出力オプションを試して下さい:\n\n```\n$ timidity -iA -OO\n```\n\nオプションを変えた後 aplaymidi を使ってテストしてください。これで問題が修正されない場合は、JACK を設定して TiMidity++ の出力先を jack にすると良いかもしれません。\n\n"
    },
    {
      "title": "ファイルの変換",
      "level": 3,
      "content": "TiMidity++ は MIDI ファイルを他のフォーマットに変換することもできます。次のコマンドでは生成されたサウンドを WAV ファイルに保存します:\n\n```\n$ timidity input.mid -Ow -o out.wav\n```\n\n他のフォーマットに変換するために FFmpeg を使うことも可能です。次のコマンドは mp3 に変換します:\n\n```\n$ timidity input.mid -Ow -o - | ffmpeg -i - -acodec libmp3lame -ab 256k out.mp3\n```\n\n"
    },
    {
      "title": "DOSBox で TiMidity++ を使う方法",
      "level": 3,
      "content": "まず最初に、設定ファイルを書く必要があります。DOSBox で次を入力して設定ファイルを作成してください:\n\n```\nconfig -writeconf dosbox.conf\n```\n\ndosbox.conf は好きな名前に置き換えることができます。隠しファイルにしたいときは名前の前にドットを加えて下さい。\n\n上で説明しているように aconnect を使ってデーモンとして TiMidity++ を起動してください。\n\n設定ファイルを好きなエディタで編集して、次のセクションを見て下さい:\n\n```\ndosbox.conf\n```\n\n```\n[midi]\nmpu401=intelligent\ndevice=default\nconfig=\n```\n\nconfig= の後ろに ALSA の接続ポートを書いて下さい、デフォルトでは:\n\n```\nconfig=128:0\n```\n\nターミナルの DOSBox を再起動すればポート 128:0 で初期化が成功してデバッグメッセージが表示されるはずです。\n\n"
    },
    {
      "title": "関連項目",
      "level": 2,
      "content": "- USB MIDI キーボード\n\n"
    }
  ]
}