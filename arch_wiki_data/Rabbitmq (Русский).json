{
  "title": "Rabbitmq (Русский)",
  "url": "https://wiki.archlinux.org/title/Rabbitmq_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "RabbitMQ — брокер сообщений на основе AMQP. Он предоставляет общую платформу для отправки и приёма сообщений и надёжное хранилище необработанных сообщений.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "Установите пакет rabbitmq.\n\n"
    },
    {
      "title": "Настройка",
      "level": 2,
      "content": "Начальная настройка не требуется, просто запустите и/или включите службу rabbitmq.service.\n\nПо умолчанию файл с настройками располагается в /etc/rabbitmq/rabbitmq-env.conf. Больше информации можно найти в официальной документации.\n\n"
    },
    {
      "title": "Включение MQTT",
      "level": 3,
      "content": "RabbitMQ может работать в роли сервера MQTT. Для использования такого функционала необходимо подключение плагина.\n\n```\n# rabbitmq-plugins enable rabbitmq_mqtt\n```\n\nЧтобы изменения вступили в силу, необходимо перезапустить сервис RabbitMQ.\n\nКлиенты должны пройти аутентификацию, прежде чем они смогут писать в темы. RabbitMQ распределяет трафик между виртуальными хостами, вам необходимо использовать `configured_vhost_name:your_user_name` в качестве имени пользователя, чтобы аутентифицироваться.\n\n"
    },
    {
      "title": "Включение администрирования через HTTP",
      "level": 3,
      "content": "Чтобы включить Web-консоль администратора, выполните:\n\n```\n# rabbitmq-plugins enable rabbitmq_management\n```\n\nЗатем перейдите на ip-адрес:15672. Имя пользователя и пароль по умолчанию guest.\n\nЧтобы разрешить удалённым машинам подключаться к консоли администратора по HTTP, впишите в /etc/rabbitmq/rabbitmq.config следующую строку:\n\n```\n[{rabbit, [{loopback_users, []}]}].\n```\n\n"
    },
    {
      "title": "Остановка rabbitmq.service зависает на минуты",
      "level": 3,
      "content": "Пакет Rabbitmq устанавливает зависимость epmd (Erlang Port Mapping Daemon). Если вы запустите rabbitmq через systemd, он запустит демон epmd, который не будет остановлен после выполнения команды systemctl stop rabbitmq. Для решения, добавьте юнит epmd.service как зависимость /etc/systemd/system/rabbitmq.service в секции Unit:\n\n```\nAfter=epmd.service\n```\n\nНе забудьте перезагрузить демоны и сервис systemctl daemon-reload && systemctl restart rabbitmq.\n\n"
    },
    {
      "title": "Изменение имени хоста",
      "level": 3,
      "content": "Если после установки rabbitmq вы изменили сетевое имя машины, служба не сможет запуститься. Это связано с записью NODENAME в /etc/rabbitmq/rabbitmq-env.conf. Обновите его:\n\n```\n/etc/rabbitmq/rabbitmq-env.conf\n```\n\n```\nNODENAME=rabbit@new-hostname\n...\n```\n\n"
    },
    {
      "title": "После обновления RabbitMQ до последней версии он не может запуститься",
      "level": 3,
      "content": "Проблема может быть вызвана неверным NODENAME в /etc/rabbitmq/rabbitmq-env.conf. Вы можете скорректировать @hostname так же, как описано в разделе #Изменение имени хоста.\n\n"
    },
    {
      "title": "Erlang cookie error",
      "level": 3,
      "content": "Ошибка аутентификации может быть вызвана неверной настройкой HOME для rabbitmq:\n\n```\nAuthentication failed (rejected by the remote node), please check the Erlang cookie\n...\nhome dir: /root\n```\n\nДомашняя директория может быть задана в конфигурационном файле:\n\n```\n/etc/rabbitmq/rabbitmq-env.conf\n```\n\n```\n...\nHOME=/var/lib/rabbitmq\n...\n```\n\n"
    },
    {
      "title": "can't establish TCP connection",
      "level": 3,
      "content": "Если вы получили эту ошибку, тогда проверьте, что первая строка с вашим хостом в /etc/hosts содержит тот же IP-адрес, что и в /etc/rabbitmq/rabbitmq-env.conf (эта ошибка часто случается, если вы привязали сервер rabbitmq к определённому интерфейсу).\n\n"
    },
    {
      "title": "Python-клиент pika не может подключиться к localhost",
      "level": 3,
      "content": "При попытке подключиться к localhost с помощью клиента pika Python может возникнуть исключение:\n\n```\n...\npika.exceptions.ProbableAccessDeniedError: (541, \"INTERNAL_ERROR - access to vhost '/' refused for user 'guest': vhost '/' is down\")\n```\n\nПо умолчанию настройки RabbitMQ такие:\n\n```\n/etc/rabbitmq/rabbitmq-env.conf\n```\n\n```\nNODENAME=rabbit@localhost\nNODE_IP_ADDRESS=0.0.0.0\nNODE_PORT=5672\n```\n\nЕсли удалить имя пользователя в строке NODENAME и оставить только хост (который должен соответствовать одному из хостов, прописанных в /etc/hosts), то проблема решится:\n\n```\n/etc/rabbitmq/rabbitmq-env.conf\n```\n\n```\nNODENAME=localhost\nNODE_IP_ADDRESS=0.0.0.0\nNODE_PORT=5672\n```\n\n"
    },
    {
      "title": "Смотрите также",
      "level": 2,
      "content": "- Wikipedia:ru:RabbitMQ\n- конфигурация ядра erlang[устаревшая ссылка 2024-07-30 ⓘ] для тонкой настройки\n- пример rabbitmq.config (не входит в состав пакета)\n\n"
    }
  ]
}