{
  "title": "BIND (日本語)",
  "url": "https://wiki.archlinux.org/title/BIND_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- DNSCrypt\n- dnsmasq\n- Pdnsd\n- Unbound\n- PowerDNS\n\nBerkeley Internet Name Domain (BIND) はドメインネームシステム (DNS) プロトコルのリファレンス実装です。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール\n- 2 設定 2.1 localhost へのアクセスを制限する 2.2 DNS 転送を設定する 2.3 TLS または HTTPS で DNS を提供する\n- 3 デーモンを実行するための設定テンプレート 3.1 1. zone ファイルを作成する 3.2 2. マスターサーバーを設定する\n- 4 再帰を許可\n- 5 DNSSEC 署名ゾーンを処理するための BIND の設定\n- 6 新しいインターフェイスに自動で接続\n- 7 chroot 環境で実行する 7.1 監獄の作成 7.2 サービスファイル\n- 8 ルートゾーンをローカルで提供する\n- 9 参照\n\n- 2.1 localhost へのアクセスを制限する\n- 2.2 DNS 転送を設定する\n- 2.3 TLS または HTTPS で DNS を提供する\n\n- 3.1 1. zone ファイルを作成する\n- 3.2 2. マスターサーバーを設定する\n\n- 7.1 監獄の作成\n- 7.2 サービスファイル\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "以下の手順は BIND をインストールしてローカルキャッシュサーバーとして設定する方法です。\n\n公式リポジトリにある bind パッケージをインストールしてください。\n\n必要に応じて /etc/named.conf を編集してローカルホストからしか接続を受け付けないように、以下のようなセクションを追加してください:\n\n```\nlisten-on { 127.0.0.1; };\n```\n\n設定した DNS サーバーを使うために /etc/resolv.conf を編集します:\n\n```\nnameserver 127.0.0.1\n```\n\nnamed デーモンを起動します。\n\n"
    },
    {
      "title": "設定",
      "level": 2,
      "content": "BIND は /etc/named.conf で設定されます。使用可能なオプションについては、named.conf(5) を参照してください。\n\nReload して named.service ユニットに構成変更を適用します。\n\n"
    },
    {
      "title": "localhost へのアクセスを制限する",
      "level": 3,
      "content": "デフォルトでは、BIND はすべてのインタフェースと IP アドレスのポート53で待機します。localhost からの接続のみを許可するには、/etc/named.conf の options セクションに次の行を追加します。\n\n```\nlisten-on { 127.0.0.1; };\n```\n\n"
    },
    {
      "title": "DNS 転送を設定する",
      "level": 3,
      "content": "BIND が DNS クエリを別の DNS サーバーに転送するには、forwarders を options セクションに追加します。\n\nBIND を Google DNS サーバに転送する例:\n\n```\nforwarders {8.8.8.8;8.8.4.4;};\n```\n\n"
    },
    {
      "title": "TLS または HTTPS で DNS を提供する",
      "level": 3,
      "content": "BIND 9.18で DNS over TLS または HTTPS のサービスを有効にするには、証明書を指定して tls ブロックを定義し、DNS over TLS および HTTPS リスナー (標準 DNS リスナーと同様) を有効にする listen-on を追加してください。\n\n```\n/etc/named.conf\n```\n\n```\ntls mycert {\n    cert-file \"<path>.crt\";\n    key-file \"<path>.key\";\n};\n\noptions {\n    // Standard port 53 listeners need to be re-added explicitly\n    listen-on    { any; };\n    listen-on-v6 { any; };\n    \n    // Add a DNS over TLS listener on standard port 853\n    listen-on    tls mycert { any; };\n    listen-on-v6 tls mycert { any; };\n    \n    // Add a DNS over HTTPS listener on custom port\n    listen-on    port 9443 tls mycert http default { any; };\n    listen-on-v6 port 9443 tls mycert http default { any; };\n    \n    // If needed, add a cleartext HTTP listener for a reverse proxy\n    //listen-on    port 8443 tls none http default { 127.0.0.1; };\n    //listen-on-v6 port 8443 tls none http default { ::1; };\n};\n...\n```\n\ntls{} はトップレベルで定義されており、options{} ブロック内では定義されていないことに注意してください。\n\n"
    },
    {
      "title": "デーモンを実行するための設定テンプレート",
      "level": 2,
      "content": "これは BIND でシンプルなホームネットワーク DNS サーバーを作成するための手順です。この例では \"domain.tld\" というドメインを使用しています。\n\nもっと詳しい説明が欲しい方は Two-in-one DNS server with BIND9 を参照してください。Linux Home Server HOWTO - Domain name system (BIND) にはすぐに内部ネットワークの名前解決をセットアップする方法が載っています。\n\n"
    },
    {
      "title": "1. zone ファイルを作成する",
      "level": 3,
      "content": "```\n# nano /var/named/domain.tld.zone\n```\n\n```\n$TTL 7200\n; domain.tld\n@       IN      SOA     ns01.domain.tld. postmaster.domain.tld. (\n                                        2007011601 ; Serial\n                                        28800      ; Refresh\n                                        1800       ; Retry\n                                        604800     ; Expire - 1 week\n                                        86400 )    ; Minimum\n                IN      NS      ns01\n                IN      NS      ns02\nns01            IN      A       0.0.0.0\nns02            IN      A       0.0.0.0\nlocalhost       IN      A       127.0.0.1\n@               IN      MX 10   mail\nimap            IN      CNAME   mail\nsmtp            IN      CNAME   mail\n@               IN      A       0.0.0.0\nwww             IN      A       0.0.0.0\nmail            IN      A       0.0.0.0\n@               IN      TXT     \"v=spf1 mx\"\n```\n\n$TTL (Time to Live) は全てのレコードのデフォルトのパケットの有効期間を秒単位で定義します。この例では7200秒 (2時間) となっています。\n\nSerial は zone レコードを変更し named デーモンを再起動するたびに手動で増やしてください。忘れるとスレーブサーバーに zone 情報が転送されません。スレーブサーバーへの zone 転送は最後に転送された時間から値が増えていなければ転送されません。\n\n"
    },
    {
      "title": "2. マスターサーバーを設定する",
      "level": 3,
      "content": "/etc/named.conf に zone を追加してください:\n\n```\nzone \"domain.tld\" IN {\n        type master;\n        file \"domain.tld.zone\";\n        allow-update { none; };\n        notify no;\n};\n```\n\n完了したらデーモンを再起動してください。\n\n"
    },
    {
      "title": "再帰を許可",
      "level": 2,
      "content": "自分の DNS サーバを動かしているなら、すべての DNS 検索に使うか、RFC:7706 に従って自分で ルートゾーンをローカルで提供した方がよいでしょう。 前者には、 再帰 ルックアップを実行する機能が必要です。DNS Amplification Attacks を防ぐために、ほとんどのリゾルバで再帰はデフォルトでオフになっています。デフォルトの Arch /etc/named.conf ファイルでは、ループバックインターフェイスでのみ再帰が許可されます。\n\n```\nallow-recursion { 127.0.0.1; };\n```\n\nTable content:\nこの記事またはセクションの正確性には問題があります。 理由: LAN ネットワーキングは再帰的ではありません。 (議論: トーク:BIND#)\n\nローカルネットワークにネームサービスを提供する場合;たとえば、192.168.0.0/24 の場合、適切なIPアドレスの範囲を /etc/named.conf に追加する必要があります。\n\n```\nallow-recursion {\n    192.168.0.0/24;\n    fd01:2345:6789::/64;\n    127.0.0.1;\n    ::1;\n};\n```\n\n"
    },
    {
      "title": "DNSSEC 署名ゾーンを処理するための BIND の設定",
      "level": 2,
      "content": "DNSSEC 検証はデフォルトで有効になっています。\"edns\" が無効になっていないことを必ず確認してください。\n\nマスター DNS サーバ:\n\n- KSK キーと ZSK キーを生成する\n\n```\n$ dnssec-keygen -a NSEC3RSASHA1 -b 2048 -n ZONE example.com\n $ dnssec-keygen -f KSK -a NSEC3RSASHA1 -b 4096 -n ZONE example.com\n```\n\n- ゾーン構成を変更します。\n\n```\nzone \"example.com\" {\n       type master;\n       allow-transfer { ... };\n       auto-dnssec maintain;\n       inline-signing yes;\n       key-directory \"master/\";\n       file \"master/example.com.zone\";\n };\n```\n\nこれで BIND が自動的にゾーンに署名します。(この例では、必要なすべてのファイルが /var/named/master/ にあることを前提としています)\n\n次に、レジスター Web サイトを使用して、DS レコード (dsset-example.com から。) ファイルを親ゾーン所有者に渡す必要があります。親ゾーンを KSK で接続します。\n\nKSK (および対応する DS レコード) は、手動による介入が必要なため、変更しないでください。ZSK は、署名チェックを高速化するために通常はこのキーが短いため、頻繁に変更できます。\n\n以下を使用して、古い ZSK キーの有効期限をスケジュールし、新しい有効期限を生成できます。\n\n```\n$ dnssec-settime -I +172800 -D +345600 Kexample.com.+000+111111.key\n $ dnssec-keygen -S Kexample.com.+000+111111.key -i 152800\n```\n\nBind は適切なタイミングで自動的に新しい ZSK キーを使用します。\n\nOpenDNSSEC のような、完全に自動化された鍵のロールオーバーが可能な外部メカニズムもあります。\n\n"
    },
    {
      "title": "新しいインターフェイスに自動で接続",
      "level": 2,
      "content": "デフォルトで bind は新しいインターフェイスをスキャンし、数時間たったらインターフェイスを切断します。以下を追加することでこの値を調整できます:\n\n```\ninterface-interval <rescan-timeout-in-minutes>;\n```\n\nnamed.conf の options セクションにパラメータを追加してください。最大値は28日間 (40320分) です。値を0に設定することで機能を無効にすることもできます。\n\n設定を変更したらサービスを再起動して下さい。\n\n"
    },
    {
      "title": "chroot 環境で実行する",
      "level": 2,
      "content": "chroot で実行することは必須ではありませんが、セキュリティが向上します。\n\n"
    },
    {
      "title": "監獄の作成",
      "level": 3,
      "content": "chroot を使うには、まず監獄を維持するための場所を作成する必要があります。ここでは /srv/named を使用して、必要なファイルを監獄に追加します:\n\n```\n# mkdir -p /srv/named/{dev,etc,usr/lib/engines,var/{run,log,named}}\n```\n\n必要なシステムファイルをコピー:\n\n```\n# cp -av /etc/{localtime,named.conf} /srv/named/etc/\n# cp -av /usr/lib/engines/* /srv/named/usr/lib/engines/\n# cp -av /var/named/* /srv/named/var/named/.\n```\n\n必要な dev ノードを設定:\n\n```\n# mknod /srv/named/dev/null c 1 3\n# mknod /srv/named/dev/random c 1 8\n```\n\nファイルの所有者を設定:\n\n```\n# chown -R named:named /srv/named\n```\n\nこれで監獄に必要なファイルシステムが作成されます。\n\n"
    },
    {
      "title": "サービスファイル",
      "level": 3,
      "content": "次に、chroot で bind を実行できるようにする新しいサービスファイルを作成します:\n\n```\n# cp -av /usr/lib/systemd/system/named.service /etc/systemd/system/named-chroot.service\n```\n\nサービスが bind を実行する方法を編集してください:\n\n```\n/etc/systemd/system/named-chroot.service\n```\n\n```\nExecStart=/usr/bin/named -4 -f -u named -t \"/srv/named\"\n```\n\nそして systemd をリロード (systemctl daemon-reload) してからサービスを起動 (systemctl start named-chroot.service) してください。\n\n"
    },
    {
      "title": "ルートゾーンをローカルで提供する",
      "level": 2,
      "content": "サードパーティ DNS サービス に依存したくない場合は、RFC:7706 に従ってローカルでルートゾーンを提供できます。これは、DNS 再帰リゾルバーとして BIND を使用することで実現できます。\n\n再帰リゾルバーを管理するには、通常、root hints file を設定する必要があります。このファイルには、ルートゾーンの権威ネームサーバーの名前と IP アドレスが含まれています。\n\nIANA Web サイト からファイルを取得し、/var/named に配置します。\n\nサーバー設定を編集して、それぞれのファイルを追加します。\n\n```\n/etc/named.conf\n```\n\n```\nzone \".\" IN {\n    type hint;\n    file \"named.root\";\n};\n```\n\n設定内でも再帰を許可する必要があります。#再帰を許可 を参照してください。\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- BIND 9 Administrator Reference Manual\n- BIND 9 DNS Administration Reference Book\n- DNS and BIND by Cricket Liu and Paul Albitz\n- Pro DNS and BIND\n- Internet Systems Consortium, Inc. (ISC)\n- DNS Glossary\n- BIND の未来についてのメーリングリストの議論アーカイブ\n\n"
    }
  ]
}