{
  "title": "Netatalk (Русский)",
  "url": "https://wiki.archlinux.org/title/Netatalk_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Netatalk — свободная реализация протокола Apple Filing Protocol (AFP). Она позволяет использовать Unix-подобные операционные системы в качестве файловых серверов для компьютеров Macintosh.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "Установите пакет netatalkAUR.\n\n"
    },
    {
      "title": "Настройка",
      "level": 2,
      "content": "Запустите/включите службу netatalk.service.\n\nПомимо конфигурационных файлов, добавленных во время установки (и проверенных во время обновления), netatalk может сгенерировать два файла — /etc/netatalk/afp_signature.conf или /var/lib/netatalk/afp_signature.conf (содержит UUID системы) и /etc/netatalk/afp_voluuid.conf или /var/lib/netatalk/afp_voluuid.conf (содержит UUID тома для Time Machine). Эти файлы могут остаться после удаления пакета и в большинстве случаев должны храниться для устранения неоднозначности служб, транслируемых по локальной сети.\n\nNetatalk 3.x использует один файл конфигурации — /etc/afp.conf. См. подробнее в afp.conf(5) и следующем примере (убедитесь, что процессы имеют доступ на запись в файл afpd.log):\n\n```\n/etc/afp.conf\n```\n\n```\n[Global]\n mimic model = TimeCapsule6,106\n log level = default:warn\n log file = /var/log/afpd.log\n hosts allow = 192.168.1.0/16\n\n[Homes]\n basedir regex = /home\n\n[TimeMachine]\n path = /mnt/timemachine\n valid users = tmuser\n time machine = yes\n\n[Shared Media]\n path = /srv/share/media\n valid users = joe sam\n```\n\n"
    },
    {
      "title": "Гостевой доступ",
      "level": 3,
      "content": "Чтобы разрешить гостевой доступ только для чтения к вашим общим папкам, добавьте следующую строку в раздел [Global]:\n\n```\n/etc/afp.conf\n```\n\n```\n[Global]\nuam list = uams_guest.so\n```\n\nЧтобы разрешить гостевой доступ для чтения/записи, сначала разрешите доступ только для чтения, как в предыдущем примере, а затем добавьте следующие строки в определенный раздел общего ресурса:\n\n```\n/etc/afp.conf\n```\n\n```\n[Your Share]\npath = /mnt/public/share\nrwlist = nobody\n```\n\n"
    },
    {
      "title": "iptables",
      "level": 2,
      "content": "Если вы используете iptables в качестве межсетевого экрана, то рассмотрите возможность добавление следующих правил (при необходимости замените -I на -A):\n\n```\nBonjour/Zeroconf\n```\n\n```\niptables -I INPUT -p udp --dport mdns -d 224.0.0.251 -j ACCEPT\niptables -I OUTPUT -p udp --dport mdns -d 224.0.0.251 -j ACCEPT\n```\n\n```\nAFP\n```\n\n```\niptables -I INPUT -p tcp --dport afpovertcp -j ACCEPT\n```\n\n```\nSLP\n```\n\n```\niptables -I INPUT -p tcp --dport slp -j ACCEPT\niptables -I OUTPUT -p tcp --dport slp -j ACCEPT\niptables -I INPUT -p udp --dport slp -j ACCEPT\niptables -I OUTPUT -p udp --dport slp -j ACCEPT\n```\n\n```\nAppleTalk\n```\n\n```\niptables -I INPUT -p tcp -m multiport --dport at-rtmp,at-nbp,at-echo,at-zis -j ACCEPT\niptables -I OUTPUT -p tcp -m multiport --dport at-rtmp,at-nbp,at-echo,at-zis -j ACCEPT\n```\n\n"
    },
    {
      "title": "Включение Bonjour/Zeroconf",
      "level": 2,
      "content": "Bonjour/Zeroconf теперь необходим для netatalk и компилируется по умолчанию. Конфигурация не требуется, netatalk самостоятельно зарегистрирует собственные сервисы по dbus. Убедитесь, что задано корректное значение строки -mimicmodel (полный список можно найти в файле /System/Library/CoreServices/CoreTypes.bundle/Contents/Info.plist на Mac).\n\nТакже может потребоваться запустить и включить службу avahi-daemon.service, если она ещё не запущена.\n\n"
    }
  ]
}