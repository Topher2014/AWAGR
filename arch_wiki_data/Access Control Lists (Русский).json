{
  "title": "Access Control Lists (Русский)",
  "url": "https://wiki.archlinux.org/title/Access_Control_Lists_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Списки управления доступом (Access Control Lists, ACL) — расширенный, более гибкий механизм прав доступа для файловых систем, разработанный как дополнение к стандартным правам доступа UNIX. ACL позволяет задавать права доступа к объектам на диске для пользователей и групп.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "Пакет acl уже установлен, так как является зависимостью systemd.\n\n"
    },
    {
      "title": "Включение ACL",
      "level": 2,
      "content": "Для использования ACL файловая система должна быть смонтирована с опцией acl. Файл fstab позволяет настроить постоянное монтирование с данной опцией.\n\nВ некоторых файловых системах параметр монтирования acl включён по умолчанию. К таким файловым системам относятся Btrfs и Ext2/3/4. Следующая команда позволяет проверить раздел с файловой системой ext* на наличие параметра acl:\n\n```\n# tune2fs -l /dev/sdXY | grep \"Default mount options:\"\n```\n\n```\nDefault mount options:    user_xattr acl\n```\n\nУбедитесь, что используемая по умолчанию опция не была переопределена. Об этом будет свидетельствовать параметр noacl в соответствующей строке файла /proc/mounts.\n\nЗадать параметры монтирования файловой системы по умолчанию можно командой tune2fs -o параметр раздел, например:\n\n```\n# tune2fs -o acl /dev/sdXY\n```\n\nЭто очень удобно при работе с внешними дисками, поскольку такой диск будет монтироваться с опцией acl и на других Linux-машинах. В противном случае придётся редактировать файл /etc/fstab на каждой системе.\n\n- acl используется как опция монтирования по умолчанию при создании файловой системы ext2/3/4. Это настраивается в файле /etc/mke2fs.conf.\n- Параметры монтирования по умолчанию в /proc/mounts не указаны.\n\n"
    },
    {
      "title": "Изменение ACL",
      "level": 3,
      "content": "Для изменения прав ACL используется команда setfacl.\n\n- Флаг --test позволяет вывести изменения прав доступа к файлу/каталогу без их реального применения (т.н. dry-run).\n- Флаг -R/--recursive позволяет применять действия рекурсивно.\n\nЗадать права пользователя (в качестве пользователь можно использовать имя пользователя или его ID):\n\n```\n# setfacl -m \"u:пользователь:права\" <file/dir>\n```\n\nЗадать права группы (в качестве группа можно использовать имя группы или её ID):\n\n```\n# setfacl -m \"g:группа:права\" <file/dir>\n```\n\nЗадать права для остальных:\n\n```\n# setfacl -m \"other:права\" <file/dir>\n```\n\nНастроить наследование новыми файлами и каталогами записей ACL родительского каталога (не относится к файлам/каталогам, которые копируются в каталог):\n\n```\n# setfacl -dm \"запись_ACL\" <dir>\n```\n\nУдалить определённую запись ACL:\n\n```\n# setfacl -x \"запись_ACL\" <file/dir>\n```\n\nУдалить записи по умолчанию:\n\n```\n# setfacl -k <file/dir>\n```\n\nУдалить все записи ACL:\n\n```\n# setfacl -b <file/dir>\n```\n\nNote: **The factual accuracy of this article or section is disputed.** The factual accuracy of this article or section is disputed.\n\nThe factual accuracy of this article or section is disputed.\n\n"
    },
    {
      "title": "Просмотр ACL",
      "level": 3,
      "content": "Вывести права доступа ACL:\n\n```\n# getfacl <file/dir>\n```\n\n"
    },
    {
      "title": "Примеры",
      "level": 2,
      "content": "Установить все права доступа к файлу abc для пользователя johnny:\n\n```\n# setfacl -m \"u:johny:rwx\" abc\n```\n\nПроверка:\n\n```\n# getfacl abc\n```\n\n```\n# file: abc\n# owner: someone\n# group: someone\nuser::rw-\nuser:johny:rwx\ngroup::r--\nmask::rwx\nother::r--\n```\n\nИзмененить права для пользователя johnny:\n\n```\n# setfacl -m \"u:johny:r-x\" abc\n```\n\nПроверка:\n\n```\n# getfacl abc\n```\n\n```\n# file: abc\n# owner: someone\n# group: someone\nuser::rw-\nuser:johny:r-x\ngroup::r--\nmask::r-x\nother::r--\n```\n\nУдалить все записи ACL:\n\n```\n# setfacl -b abc\n```\n\nПроверка:\n\n```\n# getfacl abc\n```\n\n```\n# file: abc\n# owner: someone\n# group: someone\nuser::rw-\ngroup::r--\nother::r--\n```\n\n"
    },
    {
      "title": "Вывод команды ls",
      "level": 3,
      "content": "Символ + (плюс) после прав доступа Unix в выводе команды ls -l указывает на использование ACL:\n\n```\n$ ls -l /dev/audio\n```\n\n```\ncrw-rw----+ 1 root audio 14, 4 nov.   9 12:49 /dev/audio\n```\n\n```\n$ getfacl /dev/audio\n```\n\n```\ngetfacl: Removing leading '/' from absolute path names\n# file: dev/audio\n# owner: root\n# group: audio\nuser::rw-\nuser:solstice:rw-\ngroup::rw-\nmask::rw-\nother::---\n```\n\n"
    },
    {
      "title": "Права на выполнение личных файлов",
      "level": 3,
      "content": "Ниже описано, как процесс вроде веб-сервера может получить доступ к файлам в домашнем каталоге пользователя без ущерба для безопасности.\n\nБудем считать что веб-сервер работает от пользователя http и получает доступ к домашнему каталогу /home/geoffrey пользователя geoffrey.\n\nСанчала предоставим права на выполнение для пользователя http:\n\n```\n# setfacl -m \"u:http:--x\" /home/geoffrey\n```\n\nПоскольку пользователь http теперь имеет доступ к файлам в /home/geoffrey то безопаснее будет удалить доступ для остальных пользователей:\n\n```\n# chmod o-rx /home/geoffrey\n```\n\nПроверим изменения с помощью getfacl:\n\n```\n$ getfacl /home/geoffrey\n```\n\n```\ngetfacl: Removing leading '/' from absolute path names\n# file: home/geoffrey\n# owner: geoffrey\n# group: geoffrey\nuser::rwx\nuser:http:--x\ngroup::r-x\nmask::r-x\nother::---\n```\n\nКак видно из вывода, other больше не имеют никаких прав, но пользователь http всё ещё может обращаться к файлам.\n\nЕсли необходимо будет выдать пользователю http права доступа на запись в определённые файлы/каталоги, выполните:\n\n```\n# setfacl -dm \"u:http:rwx\" /home/geoffrey/project1/cache\n```\n\n"
    },
    {
      "title": "Смотрите также",
      "level": 2,
      "content": "- getfacl(1)\n- setfacl(1)\n- POSIX Access Control Lists on Linux\n- How to set default file permissions for all folders/files in a directory?\n\n"
    }
  ]
}