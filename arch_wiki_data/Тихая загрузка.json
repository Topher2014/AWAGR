{
  "title": "Тихая загрузка",
  "url": "https://wiki.archlinux.org/title/%D0%A2%D0%B8%D1%85%D0%B0%D1%8F_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Ссылки по теме\n\n- Plymouth (Русский)\n\nЭта статья описывает, как убрать весь текст, выводимый в процессе загрузки. Видео-демонстрация\n\n"
    },
    {
      "title": "Параметры ядра",
      "level": 2,
      "content": "Измените параметры ядра в настройках вашего загрузчика, добавив:\n\n```\nquiet\n```\n\nЕсли в консоль всё равно печатаются какие-то сообщения, это может быть dmesg, выводящий что-то, что он считает важными сообщениями. Вы можете изменить уровень выводимых сообщений, используя quiet loglevel=уровень, где уровень — число от 0 (критические сообщения) до 7 (отладочные сообщения).\n\n```\nquiet loglevel=3\n```\n\nОбратите внимание, что это работает, только если используются оба параметра и именно в таком порядке (quiet должен стоять первым). Параметр loglevel влияет только на то, что выводится на консоль; сообщения, которые не вывелись, по-прежнему можно будет прочитать как через журнал, так и через dmesg. Более подробная информация есть в документации ядра.\n\nЧтобы systemd-udevd перестал выводить номер своей версии в процессе загрузки, добавьте udev.log_level=3 в параметры ядра. Если systemd используется в initramfs, используйте другой параметр rd.udev.log_level=3. Подробнее в документации: systemd-udevd.service(8) § KERNEL COMMAND LINE.\n\nЕсли вы используете хук systemd в initramfs, он может выводить сообщения во время инициализации initramfs. Можно добавить systemd.show_status=false для их скрытия, или systemd.show_status=auto, чтобы скрыть только сообщения об успехе (что позволит вам увидеть сообщения об ошибках, если они будут). На самом деле, auto уже используется по умолчанию при наличии параметра quiet, однако иногда по какой-то причине systemd внутри initramfs не получает его. Ниже приведены параметры ядра, позволяющие получить полностью чистую загрузку с systemd в initramfs:\n\n```\nquiet loglevel=3 systemd.show_status=auto rd.udev.log_level=3\n```\n\nТакже можно выполнить touch ~/.hushlogin для скрытия сообщения «Last login».\n\n"
    },
    {
      "title": "Отключение мигания курсора",
      "level": 2,
      "content": "Курсор консоли при загрузке продолжает мигать, если вы следуете этим инструкциям. Это можно решить параметром ядра vt.global_cursor_default=0 [1].\n\nЧтобы восстановить курсор в TTY, выполните:\n\n```\n# setterm -cursor on >> /etc/issue\n```\n\n"
    },
    {
      "title": "sysctl",
      "level": 2,
      "content": "Чтобы скрыть любые сообщения ядра с консоли, добавьте или измените kernel.printk [2]:\n\n```\n/etc/sysctl.d/20-quiet-printk.conf\n```\n\n```\nkernel.printk = 3 3 3 3\n```\n\n"
    },
    {
      "title": "agetty",
      "level": 2,
      "content": "Чтобы скрыть из консоли приглашение «login:» от agetty[3], создайте drop-in файл для службы getty@tty1.service.\n\n```\n/etc/systemd/system/getty@tty1.service.d/skip-prompt.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/usr/bin/agetty --skip-login --nonewline --noissue --autologin username --noclear %I $TERM\n```\n\n"
    },
    {
      "title": "startx",
      "level": 2,
      "content": "Чтобы скрыть сообщения startx, можно перенаправить его вывод на /dev/null в .bash_profile примерно так:\n\n```\n$ [[ $(fgconsole 2>/dev/null) == 1 ]] && exec startx -- vt1 &> /dev/null\n```\n\n"
    },
    {
      "title": "fsck",
      "level": 2,
      "content": "Чтобы скрыть сообщения fsck во время загрузки, перенастройте проверку корневой файловой системы на systemd. Для этого замените хук udev на systemd:\n\n```\nHOOKS=( base systemd fsck )\n```\n\nв файле /etc/mkinitcpio.conf и пересоберите образ initramfs.\n\nЗатем отредактируйте службы systemd-fsck-root.service и systemd-fsck@.service, настроив StandardOutput и StandardError:\n\n```\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/usr/lib/systemd/systemd-fsck\nStandardOutput=null\nStandardError=journal+console\nTimeoutSec=0\n```\n\nИнформацию об опциях systemd-fsck можно почитать в systemd-fsck@.service(8) — например, можно настроить, как часто проверять (или не проверять) файловые системы.\n\n"
    },
    {
      "title": "Тихий GRUB",
      "level": 2,
      "content": "Чтобы скрыть сообщения приветствия и загрузки GRUB, можно использовать неофициальный пакет grub-silentAUR.\n\nПосле установки пакета необходимо переустановить GRUB на нужный раздел.\n\nЗатем внесите необходимые изменения в /etc/default/grub.\n\nНужны эти три строки:\n\n```\nGRUB_DEFAULT=0\nGRUB_TIMEOUT=0\nGRUB_RECORDFAIL_TIMEOUT=$GRUB_TIMEOUT\n```\n\nПосле этого перегенерируйте файл настроек grub.cfg.\n\n"
    },
    {
      "title": "Логотип производителя из BIOS",
      "level": 2,
      "content": "Современные системы UEFI отображают логотип производителя при загрузке до передачи управления загрузчику; например, ноутбуки Lenovo отображают ярко-красный логотип Lenovo. Он обычно убирается с экрана загрузчиком (если используется стандартный GRUB) или ядром.\n\nЧтобы ядро не убирало логотип производителя, в Linux 4.19 появилась новая настройка FRAMEBUFFER_CONSOLE_DEFERRED_TAKEOVER, при включении которой ядро не будет очищать фреймбуфер до момента, пока не потребуется вывести текст на консоль фреймбуфера. По состоянию на ноябрь 2018 года (Linux 4.19.1) официальные ядра Arch Linux компилируются с CONFIG_FRAMEBUFFER_CONSOLE_DEFERRED_TAKEOVER=y.\n\nВ сочетании с настроенным loglevel (для предотвращения вывода текста) это позволяет оставить логотип производителя на экране в процессе загрузки системы. Обратите внимание, что GRUB в стандартной конфигурации очищает экран; попробуйте использовать EFISTUB, чтобы загружаться напрямую в ядро и таким образом использовать отложенную очистку экрана.\n\nВидео-демонстрация\n\nВ параметры ядра нужно добавить loglevel=3 или rd.udev.log_level=3, как упоминалось выше. Обратите внимание, что если вы часто получаете сообщения Core temperature above threshold, cpu clock throttled в журнале ядра, вам нужно использовать log level 2, чтобы скрыть их во время загрузки. В качестве альтернативы, если вы компилируете собственное ядро, настройте loglevel для этого сообщения в файле arch/x86/kernel/cpu/mcheck/therm_throt.c.\n\nЕсли вы используете видеокарту Intel, смотрите также Intel graphics (Русский)#Fastboot.\n\nДополнительное чтение:\n\n- Phoronix: Linux 4.19 Adds Deferred Console Takeover Support For FBDEV - Cleaner Boot Process\n- Hans de Goede: Adding deferred fbcon console takeover to the Fedora kernels\n\n"
    },
    {
      "title": "Отключение отложенной очистки экрана",
      "level": 3,
      "content": "Если новое поведение вызывает проблемы, вы можете отключить отложенную очистку экрана, добавив параметр ядра fbcon=nodefer.\n\n"
    }
  ]
}