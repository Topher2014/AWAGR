{
  "title": "Install from existing Linux (Español)",
  "url": "https://wiki.archlinux.org/title/Install_from_existing_Linux_(Espa%C3%B1ol)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **2019-11-13** \n\nArtículos relacionados\n\n- Instalar desde SSH\n\nEste documento describe el proceso de bootstrapping necesario para instalar Arch Linux desde un sistema anfitrión de Linux en ejecución. Después del bootstrapping, la instalación continúa como se describe en la guía de instalación.\n\nLa instalación de Arch Linux desde un sistema Linux en ejecución es útil para:\n\n- instalar remotamente Arch Linux, por ejemplo, un servidor root (virtual);\n- sustituir un Linux existente sin un LiveCD (véase #Reemplazar el sistema existente sin un LiveCD);\n- crear un distribución Linux nueva o LiveCD basada en Arch Linux;\n- crear un entorno chroot de Arch Linux, por ejemplo para un contenedor de base Docker;\n- rootfs-sobre-NFS para máquinas sin disco.\n\nEl objetivo del procedimiento de bootstrapping es configurar un entorno desde el que ejecutar los arch-install-scripts (tales como pacstrap y arch-root).\n\nSi el sistema anfitrión ejecuta Arch Linux, esto se puede lograr simplemente instalando arch-install-scripts. Si el sistema anfitrión ejecuta otra distribución de Linux, primero deberá configurar un entorno chroot basado en Arch Linux.\n\n"
    },
    {
      "title": "Realizar copia de seguridad y preparación",
      "level": 2,
      "content": "Haga una copia de seguridad de todos sus datos, incluidos correos electrónicos, servidores web, etc. Tenga toda la información a su alcance. Preserve todas las configuraciones de su servidor, nombres de equipos, etc.\n\nAquí hay una lista de datos que probablemente necesitará:\n\n- Direcciones IP.\n- Nombre(s) de equipo, (nota: los servidores raíces también son en su mayoría parte del dominio de proveedores, verifique o guarde su /etc/hosts antes de eliminar).\n- Servidores DNS (compruebe /etc/resolv.conf).\n- Claves SSH (si otras personas trabajan en su servidor, de lo contrario tendrán que aceptar nuevas claves. Esto incluye claves de su Apache, sus servidores de correo, su servidor SSH y otros).\n- Información de hardware (tarjeta de red, etc. Consulte su preinstalado /etc/modules.conf).\n- Archivos de configuración de Grub.\n\nEn general, es una buena idea tener una copia local de su directorio original /etc en su disco duro local.\n\n"
    },
    {
      "title": "Desde un sistema anfitrión que ejecuta Arch Linux",
      "level": 2,
      "content": "Instale el paquete arch-install-scripts.\n\nSiga Installation guide (Español)#Montar los sistemas de archivos para montar el sistema de archivos y todos los puntos de montaje necesarios. Si ya utiliza el directorio /mnt para otra cosa, simplemente cree otro directorio como /mnt/install, y úselo en su lugar como la base del punto de montaje.\n\n"
    },
    {
      "title": "Crear una nueva instalación de Arch",
      "level": 3,
      "content": "Siga la Installation guide (Español)#Instalación.\n\nRespecto a la Installation guide (Español)#Seleccionar los servidores de réplica se puede omitir ya que el equipo debería tener una lista de servidores de réplica correcta.\n\n"
    },
    {
      "title": "Crear una copia de una instalación de Arch existente",
      "level": 3,
      "content": "Es posible replicar una instalación existente de Arch Linux copiando el sistema de archivos del sistema anfitrión a la nueva partición y hacer algunos ajustes para que sea arrancable y única.\n\nEl primer paso es copiar los archivos del anfitrión en la nueva partición montada, para esto, considere usar el enfoque presentado en rsync#Full system backup.\n\nLuego, siga el procedimiento descrito en Installation guide (Español)#Configuración del sistema con algunas salvedades y pasos adicionales:\n\n- Installation guide (Español)#Zona horaria, Installation guide (Español)#Idioma del sistema y Installation guide (Español)#Contraseña de root se pueden omitir.\n- Installation guide (Español)#Initramfs puede ser necesario en particular si se cambia el sistema de archivos, por ejemplo de Ext4 a Btrfs.\n- Con respecto a Installation guide (Español)#Instalar gestor de arranque, es necesario reinstalar el cargador de arranque.\n- Elimine /etc/machine-id para que se genere un id nuevo y único en el próximo arranque.\n\nSi la instalación replicada de Arch se quiere usar dentro de una configuración diferente o con otro hardware, considere las siguientes operaciones adicionales:\n\n- Utilice microcode para la actualización de la CPU adaptada al sistema de destino durante el paso Installation guide (Español)#Instalar gestor de arranque.\n- Si alguna Xorg#Configuration específica estuvo presente en el anfitrión y puede ser incompatible con el sistema de destino, siga Moving an existing install into (or out of) a virtual machine#Disable any Xorg-related files.\n- Realice cualquier otro ajuste apropiado para el sistema de destino, como reconfigurar la red o el audio.\n\n"
    },
    {
      "title": "Desde un sistema anfitrión que ejecuta otra distribución de Linux",
      "level": 2,
      "content": "Existen múltiples herramientas que automatizan una gran parte de los pasos descritos en las siguientes subsecciones. Consulte sus respectivas páginas de inicio para obtener instrucciones detalladas.\n\n- arch-bootstrap (Bash)\n- digitalocean-debian-to-arch (disco de reparticionado, específico de DigitalOCean)\n- image-bootstrap (Python)\n- vps2arch (Bash)\n\nEn las siguientes subsecciones se presenta la forma de hacerlo manualmente. La idea es hacer que pacman trabaje directamente en el sistema anfitrión, o ejecutar un sistema Arch dentro del sistema anfitrión, con la instalación real ejecutada desde el sistema Arch. El sistema anidado estará contenido dentro de un entorno chroot.\n\n"
    },
    {
      "title": "Utilizar pacman desde el sistema anfitrión",
      "level": 3,
      "content": "Pacman puede compilarse en la mayoría de las distribuciones de Linux y usarse directamente en el sistema anfitrión para arrancar Arch Linux. El script arch-install-scripts debería ejecutarse sin problemas directamente de las fuentes descargadas en cualquier distribución reciente.\n\nAlgunas distribuciones proporcionan un paquete para pacman y/o arch-install-scripts en sus repositorios oficiales que pueden usarse para este propósito. Desde febrero de 2019, se sabe que «Gentoo» proporciona el paquete pacman, y «Alpine Linux» y «Fedora» se sabe que proporcionan tanto pacman como arch-install-scripts.\n\n"
    },
    {
      "title": "Crear un entorno chroot",
      "level": 3,
      "content": "A continuación se presentan dos métodos para configurar e ingresar en chroot, desde el más fácil hasta el más complicado. Seleccione solo uno de los dos métodos. Luego, continúe en #Utilizar un entorno chroot.\n\n"
    },
    {
      "title": "Método A: utilizar una imagen de bootstrap (recomendado)",
      "level": 4,
      "content": "Descargue la imagen de bootstrap desde un servidor de réplica en /tmp.\n\nTambién puede descargar la firma (misma URL con .sig añadido) y verifíquela con GnuPG.\n\nExtraiga el tarball:\n\n```\n# tar xzf <path-to-bootstrap-image>/archlinux-bootstrap-*-x86_64.tar.gz\n```\n\nSeleccione un servidor de repositorio editando /tmp/root.x86_64/etc/pacman.d/mirrorlist.\n\nEntre en entorno chroot:\n\n- Si tiene instalado bash 4 o posterior, y la orden unshare admite las opciones --fork y--pid, ejecute:\n\n```\n# /tmp/root.x86_64/bin/arch-chroot /tmp/root.x86_64/\n```\n\n- De lo contrario, ejecute las siguientes órdenes:\n\n```\n# mount --bind /tmp/root.x86_64 /tmp/root.x86_64\n# cd /tmp/root.x86_64\n# cp /etc/resolv.conf etc\n# mount -t proc /proc proc\n# mount --make-rslave --rbind /sys sys\n# mount --make-rslave --rbind /dev dev\n# mount --make-rslave --rbind /run run    ## (suponiendo que /run existe en el sistema)\n# chroot /tmp/root.x86_64 /bin/bash\n```\n\n"
    },
    {
      "title": "Método B: utilizar una imagen LiveCD",
      "level": 4,
      "content": "Es posible montar la imagen raíz desde el soporte de instalación de Arch Linux más reciente y luego hacer un chroot en ella. Este método tiene la ventaja de proporcionar una instalación de Arch Linux en funcionamiento dentro del sistema anfitrión sin la necesidad de prepararlo instalando paquetes específicos.\n\n- La imagen raíz se puede encontrar en uno de los servidores de réplicas en arch/x86_64/. El formato squashfs no es editable, por lo que realizamos la descompresión de la imagen raíz con unsquash y la montamos.\n\n- Para realizar unsquash de la imagen raíz, ejecute:\n\n```\n# unsquashfs airootfs.sfs\n```\n\n- Antes de efectuar chroot, necesitamos configurar algunos puntos de montaje y copiar el archivo resolv.conf a fin tener conexión de red:\n\n```\n# mount --bind squashfs-root squashfs-root\n# mount -t proc none squashfs-root/proc\n# mount -t sysfs none squashfs-root/sys\n# mount -o bind /dev squashfs-root/dev\n# mount -o bind /dev/pts squashfs-root/dev/pts   ## importante para pacman (para comprobar la firma)\n# cp -L /etc/resolv.conf squashfs-root/etc   ## esto es necesario para usar la red dentro del chroot\n```\n\n- Ahora, todo está preparado para pasar al entorno chroot en el recién instalado entorno de Arch:\n\n```\n# chroot squashfs-root bash\n```\n\n"
    },
    {
      "title": "Utilizar un entorno chroot",
      "level": 3,
      "content": "El entorno de arranque es realmente básico (sin nano o lvm2). Por lo tanto, necesitamos configurar pacman para descargar otros paquetes necesarios.\n\n"
    },
    {
      "title": "Inicializar el depósito de claves de pacman",
      "level": 4,
      "content": "Las claves de pacman deben configurarse antes de comenzar la instalación. Antes de ejecutar las siguientes dos órdenes, lea pacman-key (Español)#Inicializar el depósito de claves para comprender los requisitos de la entropía:\n\n```\n# pacman-key --init\n# pacman-key --populate archlinux\n```\n\n"
    },
    {
      "title": "Seleccionar un servidor de réplica y descargar herramientas básicas",
      "level": 4,
      "content": "Después de seleccionar un servidor de réplica, actualice la lista de paquetes e instale lo que necesite: base-devel, parted, etc.\n\n- Como todavía no hay ningún editor de texto, debe salir de arch-chroot y editar la lista de servidores de réplicas utilizando el editor de texto del anfitrión.\n- Puede que cuando intente instalar paquetes con pacman, obtenga error: could not determine cachedir mount point /var/cache/pacman/pkg. Para solucionarlo, puede ejecutar: mount --bind directory-to-livecd-or-bootstrap directory-to-livecd-or-bootstrap antes de realizar chroot. Vea FS#46169.\n\n```\nmount --bind directory-to-livecd-or-bootstrap directory-to-livecd-or-bootstrap\n```\n\n"
    },
    {
      "title": "Sugerencias de instalación",
      "level": 3,
      "content": "Ahora puede continuar con Installation guide (Español)#Particionar el disco y seguir el resto de la Installation guide (Español).\n\nAlgunos sistemas anfitriones o configuraciones pueden requerir ciertos pasos adicionales. Consulte las secciones siguientes para obtener consejos.\n\n"
    },
    {
      "title": "Anfitrión basado en Debian",
      "level": 4,
      "content": "En algunos sistemas anfitriones basados en Debian, pacstrap puede producir el siguiente error:\n\n```\n# pacstrap /mnt base\n```\n\n```\n==> Creating install root at /mnt\nmount: mount point /mnt/dev/shm is a symbolic link to nowhere\n==> ERROR: failed to setup API filesystems in new root\n```\n\nEsto se debe a que en algunas versiones de Debian, /dev/shm apunta a /run/shm, mientras que en el entorno chroot basado en Arch, /run/shm no existe y el enlace está roto. Para corregir este error, cree un directorio /run/shm:\n\n```\n# mkdir /run/shm\n```\n\nAl instalar archlinux-2015.07.01-x86_64 desde un sistema anfitrión Debian 7, el siguiente error impidió que tanto pacstrap(8) como arch-chroot funcionasen:\n\n```\n# pacstrap -i /mnt\n```\n\n```\nmount: mount point /mnt/dev/pts does not exist\n==> ERROR: failed to setup chroot /mnt\n```\n\nAparentemente, esto se debe a que estos dos scripts usan una característica común. chroot_setup()[1] se basa en las nuevas características de util-linux, que son incompatibles con Debian 7 (vea FS#45737).\n\nLa solución para pacstrap consiste en ejecutar manualmente sus diversas tareas, pero utilizando el procedimiento normal para montar los sistemas de archivos del kernel en el directorio de destino (\"$newroot\"):\n\n```\n# newroot=/mnt\n# mkdir -m 0755 -p \"$newroot\"/var/{cache/pacman/pkg,lib/pacman,log} \"$newroot\"/{dev,run,etc}\n# mkdir -m 1777 -p \"$newroot\"/tmp\n# mkdir -m 0555 -p \"$newroot\"/{sys,proc}\n# mount --bind \"$newroot\" \"$newroot\"\n# mount -t proc /proc \"$newroot/proc\"\n# mount --rbind /sys \"$newroot/sys\"\n# mount --rbind /run \"$newroot/run\"\n# mount --rbind /dev \"$newroot/dev\"\n# pacman -r \"$newroot\" --cachedir=\"$newroot/var/cache/pacman/pkg\" -Sy base base-devel ... ## add the packages you want\n# cp -a /etc/pacman.d/gnupg \"$newroot/etc/pacman.d/\"       ## copy keyring\n# cp -a /etc/pacman.d/mirrorlist \"$newroot/etc/pacman.d/\"  ## copy mirrorlist\n```\n\nEn lugar de usar arch-chroot para realizar chroot, simplemente utilice:\n\n```\n# chroot \"$newroot\"\n```\n\nIntentar crear volúmenes lógicos desde un entorno archlinux-bootstrap-2015.07.01-x86_64 en un sistema anfitrión Debian 7 dará como resultado el siguiente error:\n\n```\n# lvcreate -L 20G lvm -n root\n```\n\n```\n/run/lvm/lvmetad.socket: connect failed: No such file or directory\n  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.\n  /dev/lvm/root: not found: device not cleared\n  Aborting. Failed to wipe start of new LV.\n```\n\n(El volumen físico y la creación del grupo de volúmenes funcionaron a pesar del fallo /run/lvm/lvmetad.socket: connect failed: No such file or directory mostrado.)\n\nEsto podría solucionarse fácilmente creando los volúmenes lógicos fuera de chroot (desde el anfitrión Debian). Luego estarán disponibles una vez que se vuelva a entrar en chroot.\n\nAdemás, si el sistema que está utilizando tiene lvm, es posible que obtenga la siguiente salida:\n\n```\n# grub-install --target=i386-pc --recheck /dev/main/archroot\n```\n\n```\nInstalling for i386-pc platform.\n  /run/lvm/lvmetad.socket: connect failed: No such file or directory\n  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.\n  /run/lvm/lvmetad.socket: connect failed: No such file or directory\n  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.\n  /run/lvm/lvmetad.socket: connect failed: No such file or directory\n  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.\n  /run/lvm/lvmetad.socket: connect failed: No such file or directory\n  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.\n  /run/lvm/lvmetad.socket: connect failed: No such file or directory\n  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.\n```\n\nEsto se debe a que debian no usa lvmetad por defecto. Debe editar /etc/lvm/lvm.conf y establecer use_lvmetad en 0:\n\n```\nuse_lvmetad = 0\n```\n\nEsto dará más tarde un error en el arranque en la etapa initrd. Por lo tanto, debe volver a cambiarlo después de la generación de grub. En un RAID por software + LVM, los pasos serían los siguientes:\n\n- Después de instalar el sistema, verifique mkinitcpio y la configuración de su gestor de arranque. Consulte Arch boot process (Español)#Gestor de arranque para obtener una lista de cargadores de arranque.\n- Es posible que deba cambiar /etc/mdadm.conf para que refleje su configuración RAID (si corresponde).\n- Es posible que deba cambiar sus HOOKS y MODULES de acuerdo con sus requisitos LVM y RAID: MODULES=\"dm_mod\" HOOKS=\"base udev mdadm_udev ... block lvm2 filesystems ...\"\n- Lo más probable es que necesite generar nuevas imágenes initrd con mkinitcpio. Vea Mkinitcpio#Image creation and activation.\n- Establezca use_lvmetad = 0 en /etc/lvm/lvm.conf.\n- Actualice la configuración de tu gestor de arranque. Consulte la página wiki de su gestor de arranque para más detalles.\n- Establezca use_lvmetad = 1 en /etc/lvm/lvm.conf.\n\n"
    },
    {
      "title": "Anfitrión basado en Fedora",
      "level": 4,
      "content": "En sistemas anfitriones basados en Fedora y USB live, puede encontrar problemas al usar genfstab para generar su fstab. Elimine las entradas duplicadas y la opción «seclabel» donde aparezca, ya que esto es específico de Fedora y evitará que su sistema arranque normalmente.\n\n"
    },
    {
      "title": "Cosas que verificar antes de reiniciar",
      "level": 2,
      "content": "Antes de reiniciar, vuelva a verificar algunos detalles en su instalación para lograr una instalación exitosa. Para hacerlo, primero entre en chroot en el sistema recién instalado y luego:\n\n- Cree un usuario con contraseña, para que pueda iniciar sesión a través de sh. Esto es crítico ya que el inicio de sesión raíz está desactivado por defecto desde OpenSSH-7.1p2.\n- Establezca una contraseña de root para que pueda cambiar a root a través de su más tarde.\n- Instale una solución ssh y active su instancia de servidor para iniciarse automáticamente en el arranque.\n- Configure su conexión de red para que la conexión se inicie automáticamente en el arranque.\n- Configure un gesgtor de arranque y configúrelo para usar la partición de intercambio que se apropió anteriormente como la partición raíz. Es posible que desee configurar su gestor de arranque para poder arrancar en su sistema anterior; es útil reutilizar la partición /boot existente del servidor en el nuevo sistema para este propósito.\n\n"
    },
    {
      "title": "Reemplazar el sistema existente sin un LiveCD",
      "level": 2,
      "content": "Encuentre ~700 MB de espacio libre en algún lugar del disco, por ejemplo, formateando una partición de intercambio. Puede desactivar la partición de intercambio y configurar su sistema allí.\n\n"
    },
    {
      "title": "Establecer la antigua partición de intercambio como nueva partición raíz",
      "level": 3,
      "content": "Compruebe cfdisk, /proc/swaps o /etc/fstab para encontrar su partición de intercambio. Suponiendo que su disco duro esté ubicado en sdaX (X será un número).\n\nHaga lo siguiente:\n\nDesactive el espacio de intercambio:\n\n```\n# swapoff /dev/sdaX\n```\n\nCrea un sistema de archivos en él:\n\n```\n# fdisk /dev/sda\n(establezca el campo de identificación de /dev/sdaX para \"Linux\" - Hex 83)\n# mke2fs -j /dev/sdaX\n```\n\nCrea un directorio para montarlo:La instalación de Arch Linux\n\n```\n# mkdir /mnt/newsys\n```\n\nFinalmente, monte el nuevo directorio para instalar el sistema:\n\n```\n# mount -t ext4 /dev/sdaX /mnt/newsys\n```\n\n"
    },
    {
      "title": "Instalación",
      "level": 3,
      "content": "Instale los paquetes esenciales y cualquier otro paquete requerido para obtener un sistema con conexión a Internet en funcionamiento en la partición temporal, teniendo cuidado con el límite de los ~700 MB de espacio. Cuando especifique paquetes para instalar con pacstrap, considere agregar el indicador -c para evitar llenar un espacio valioso descargando paquetes al sistema anfitrión.\n\nUna vez que el nuevo sistema Arch Linux esté instalado, arregle la configuración del cargador de arranque, luego reinicie en el sistema recién creado y realice rsync de todo el sistema en la partición primaria.\n\n"
    }
  ]
}