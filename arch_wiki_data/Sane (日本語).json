{
  "title": "Sane (日本語)",
  "url": "https://wiki.archlinux.org/title/Sane_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- SANE/スキャナー別の問題\n- Scanner Button Daemon\n\nSANE (Scanner Access Now Easy) は、GNU/Linux でスキャナを使うためのライブラリとコマンドラインツールを提供します。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール 1.1 スキャナドライバ 1.2 フロントエンド\n- 2 検証\n- 3 ファームウェア\n- 4 ネットワークを介してスキャナを共有する 4.1 リモートのワークステーションからスキャナにアクセスする 4.2 Windows クライアント\n- 5 トラブルシューティング 5.1 Invalid argument 5.1.1 ファームウェアファイルがない 5.1.2 ファームウェアファイルのパーミッションが間違っている 5.1.3 複数のバックエンドがスキャナを要求している 5.1.4 xHCI による通信ができない (旧式のスキャナ) 5.1.5 ファイアーウォール 5.2 起動が遅い 5.3 Device busy 5.4 パーミッションの問題 5.4.1 パラレルポート接続のスキャナ 5.5 avahi-daemon は必須ではありません 5.6 Error during device I/O\n- 6 参照\n\n- 1.1 スキャナドライバ\n- 1.2 フロントエンド\n\n- 4.1 リモートのワークステーションからスキャナにアクセスする\n- 4.2 Windows クライアント\n\n- 5.1 Invalid argument 5.1.1 ファームウェアファイルがない 5.1.2 ファームウェアファイルのパーミッションが間違っている 5.1.3 複数のバックエンドがスキャナを要求している 5.1.4 xHCI による通信ができない (旧式のスキャナ) 5.1.5 ファイアーウォール\n- 5.2 起動が遅い\n- 5.3 Device busy\n- 5.4 パーミッションの問題 5.4.1 パラレルポート接続のスキャナ\n- 5.5 avahi-daemon は必須ではありません\n- 5.6 Error during device I/O\n\n- 5.1.1 ファームウェアファイルがない\n- 5.1.2 ファームウェアファイルのパーミッションが間違っている\n- 5.1.3 複数のバックエンドがスキャナを要求している\n- 5.1.4 xHCI による通信ができない (旧式のスキャナ)\n- 5.1.5 ファイアーウォール\n\n- 5.4.1 パラレルポート接続のスキャナ\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "sane パッケージをインストールしてください。ほとんどのフロントエンドとドライバはこのパッケージを依存関係としてインストールするため、たいてい、このパッケージを明示的にインストールする必要はありません。\n\n"
    },
    {
      "title": "スキャナドライバ",
      "level": 3,
      "content": "最近のスキャナの多くは \"ドライバレス\" スキャンをサポートしています。[1] デバイスの互換性については、sane-airscan GitHub や Apple AirPrint devices で調べられます。\n\nあなたのスキャナが \"ドライバレス\" モードで動作することが分かっている場合は、sane-airscan パッケージをインストールしてください。スキャナが USB を使用する場合は、USB 接続で IPP プロトコルを使用できるようにするために、ipp-usb パッケージをインストールし、 ipp-usb.service を起動/有効化してください。\n\n\"ドライバレス\" で動作しないかもしれない場合は、SANE - Supported Devices と SANE/スキャナー別の問題 を確認し、あなたのスキャナが別のドライバで動作するかどうかを調べてください。\n\nほとんどのスキャナは特に設定をしなくても動作します。動作しない場合は、SANE/スキャナー別の問題 でインストール手順を確認してください。\n\n"
    },
    {
      "title": "フロントエンド",
      "level": 3,
      "content": "SANE には多数のフロントエンドが存在しています。不完全なリストは SANE プロジェクトのウェブサイトで見られます。\n\n- GNOME Document Scanner — XSane よりも GNOME デスクトップにより良く統合され、より使いやすくなるように設計されたシンプルな GUI。gnome の一部。\n\n- Skanlite — 画像のスキャンと保存しかできないシンプルな画像スキャンアプリケーション。KSane バックエンドがベース。kde-graphics に含まれています。\n\n- Skanpage — 複数ページのスキャンやドキュメントと画像の保存のために設計されたシンプルなスキャンアプリケーション。kde-utilities に含まれています。\n\n- XSane — 懐古な見た目ながら豊富な機能があるフル機能の GTK ベースのフロントエンド。\n\n- Scantailor — プロジェクトで使えるスキャニングアプリケーション。スキャン中に編集が可能です。\n\n一部の OCR ソフトウェアは SANE を使って画像をスキャンできます: gImageReader、gscan2pdf、Linux-Intelligent-Ocr-Solution、OCRFeeder、Paperwork。\n\n- 16ビットの色深度モードで XSane を使って直接 PDF にスキャンすると 破損したファイル が生成される既知のバグがあり、pacman の出力でも警告されます。8ビットモードでは問題ないことが知られています。\n\nTable content:\nこの記事またはセクションの正確性には問題があります。 理由: skanlite が mDNS を処理する必要はありません。mDNS ホスト名解決が正しく設定されていて、スキャナのアドレスが hostname.local として指定されている限り、動作するはずです。これは hplip の制限/バグのようです。 (議論: トーク:SANE#)\n\n- フロントエンドを使用するというだけでは設定が不要になるわけではありません。特に mDNS でデバイスを設定する場合などです。例えば skanlite は mDNS を扱うことができないため、ネットワークスキャナを正しく認識するにはコマンドラインに情報を追加する必要があります。HP Officejet Pro L7590 での設定例: skanlite --device \"hpaio:/net/Officejet_Pro_L7500?ip=192.168.0.17\"。\n\n"
    },
    {
      "title": "検証",
      "level": 2,
      "content": "インストールが終わった今、sane がスキャナを認識するかどうか試してみることができます:\n\n```\n$ scanimage -L\n```\n\n上記のコマンドが失敗する場合、root で再度コマンドを実行してパーミッションが問題なのかどうか確認してください。root で実行しても失敗する場合、スキャナーがコンピュータに接続されていることを確認してください。また、/usr/lib/udev/rules.d/65-sane.rules にスキャナを認識させるために、スキャナを抜き差しする必要があるかもしれません。\n\n確認したら、スキャナが実際に動作するかどうか確認できます:\n\n```\n$ scanimage --format=png --output-file test.png --progress\n```\n\nscanimage: sane_start: Invalid argument というメッセージを吐いてスキャンが失敗する場合、デバイスを指定する必要がある場合があります:\n\n```\n$ scanimage -L\n```\n\n```\ndevice `v4l:/dev/video0' is a Noname Video WebCam virtual device\ndevice `pixma:04A91749_247936' is a CANON Canon PIXMA MG5200 multi-function peripheral\n```\n\n以下のように実行してみてください:\n\n```\n$ scanimage --device \"pixma:04A91749_247936\" --format=tiff --output-file test.tiff --progress\n```\n\nSane は、数々のスキャナのタイプに対して多く特別なバックエンドオプションを提供しています。あなたのデバイス用のバックエンドは何か確認するには:\n\n```\n$ scanimage -A\n```\n\n"
    },
    {
      "title": "ファームウェア",
      "level": 2,
      "content": "通常、ファームウェアには .bin 拡張子が付いています。\n\nまず、ファームウェアをどこか安全なところに置いてください。/usr/share/sane/ のサブディレクトリ内に置くことが推奨されます。\n\n次に、ファームウェアの場所を sane に教える必要があります:\n\n- sane によってサポートされているデバイスのリストからあなたのスキャナ用のバックエンドの名前を見つけてください。\n- /etc/sane.d/backend-name.conf ファイルを開いてください。\n- 該当するファームウェアエントリをアンコメントし、ファイルのパスをあなたのスキャナ用のファームウェアファイルの場所に設定してください。scanner グループのメンバーが /etc/sane.d/backend-name.conf ファイルにアクセスできるようにしてください。\n\nあなたのスキャナのバックエンドが sane パッケージに含まれていない場合 (hplip の hpaio.conf など)、/etc/sane.d/dll.d か /etc/sane.d/dll.conf 内の関連するエントリをアンコメントする必要があります。\n\n"
    },
    {
      "title": "ネットワークを介してスキャナを共有する",
      "level": 2,
      "content": "sane や xsane、xsane を有効化した GIMP を使用する、ネットワーク上の他のホストとスキャナを共有することができます。サーバをセットアップするには、まず、ネットワーク上のどのホストにアクセスを許可するか指定してください。/etc/sane.d/saned.conf ファイルを変更してください。例えば:\n\n```\n# 必要\nlocalhost\n# ローカルサブネットを許可\n192.168.0.0/24\n```\n\n次に、マルチキャストでスキャナを発見できるようにするために、サーバ上で avahi-daemon をインストールし、有効化、起動してください (avahi-daemon がまだアクティブでない場合)。あるいは、スキャナが Airscan によってサポートされている場合、代わりに sane-airscan パッケージをインストールしても良いです。\n\niptables を使っている場合、nf_conntrack_sane モジュールを追加し、ファイアーウォールが saned の接続を追跡するようにしてください。\n\nConntrack ヘルパはデフォルトで無効化されているようです。[2] 以下のコマンドでアクティブ化できます:\n\n```\n# echo 1 > /proc/sys/net/netfilter/nf_conntrack_helper\n```\n\nこれを永続化するには、nf_conntrack モジュールに対して nf_conntrack_helper=1 オプションを設定してください (カーネルモジュール#/etc/modprobe.d/ 内のファイルを使う を参照)。\n\nそして、saned.socket を起動/有効化してください。これで、スキャナがネットワークを介して利用可能になりました。詳細は saned(8) を参照してください。\n\n"
    },
    {
      "title": "リモートのワークステーションからスキャナにアクセスする",
      "level": 3,
      "content": "リモートの Arch Linux ワークステーションからネットワークスキャナーにアクセスすることができます。\n\nまず /etc/sane.d/net.conf ファイルにサーバーのホストネームあるいは IP アドレスを指定してください:\n\n```\n# 静的 IP アドレス\n192.168.0.1\n# あるいはホスト名\nstratus\n```\n\n次に、サーバ側での設定に応じて、リモートワークステーションに avahi-daemon をインストール、起動、そして有効化するか、あるいは、sane-airscan をインストールしてください。\n\nそして、ワークステーションの接続をテストしてください。\n\n```\n$ scanimage -L\n```\n\nこれで、フロントエンドにネットワークスキャナが表示されるはずです。\n\n"
    },
    {
      "title": "Windows クライアント",
      "level": 3,
      "content": "SANE の Windows 移植版はサポートされておらず、古くなっていて、入手するのが難しいため、代わりに SANEWinDS や SaneTwain (古い) を試すことができます。\n\n"
    },
    {
      "title": "トラブルシューティング",
      "level": 2,
      "content": "SANE/スキャナー別の問題 も見てください。\n\n"
    },
    {
      "title": "Invalid argument",
      "level": 3,
      "content": "xsane などの sane フロントエンドで \"Invalid argument\" エラーが出る場合、理由として以下のような理由が考えられます:\n\n"
    },
    {
      "title": "ファームウェアファイルがない",
      "level": 4,
      "content": "スキャナーを使うためのファームウェアファイルが存在していません (詳しくは #ファームウェア を参照)。\n\n"
    },
    {
      "title": "ファームウェアファイルのパーミッションが間違っている",
      "level": 4,
      "content": "ファームウェアファイルのパーミッションが間違っています。パーミッションを修正してください:\n\n```\n# chown root:scanner /usr/share/sane/SCANNER_MODEL/FIRMWARE_FILE\n# chmod ug+r /usr/share/sane/SCANNER_MODEL/FIRMWARE_FILE\n```\n\n"
    },
    {
      "title": "複数のバックエンドがスキャナを要求している",
      "level": 4,
      "content": "あなたのスキャナをサポートしている (または、サポートしているように見せかけている) 複数のバックエンドが複数あり、sane が、その中からあなたのスキャナをサポートしていないバックエンドを選んでしまうことがあります (この場合、スキャナは scanimage -L で表示されません)。これは、旧式の Epson スキャナと epson2 や epson バックエンドを使用した際に発生します。その場合、解決策は、/etc/sane.d/dll.conf 内の使用しないバックエンドをコメントアウトすることです。Epson の場合、以下のように epson2 をコメントアウトします:\n\n```\n/etc/sane.d/dll.conf\n```\n\n```\n#epson2\nepson\n```\n\n独立した iscanAUR の epkowa バックエンドが snapscan バックエンド (epson スキャナ) と干渉することもあります。scanimage -L コマンドを使ったときにこのエラーが表示されるでしょう。(xsaneAUR などの) スキャナーアプリを2回起動することで問題は解決します。もしくは /etc/sane.d/epkowa.conf の設定が間違っていないか確認したり、あるいは iscanAUR パッケージを削除してください。\n\n"
    },
    {
      "title": "xHCI による通信ができない (旧式のスキャナ)",
      "level": 4,
      "content": "一部の古いモデルのスキャナーでは USB3 端子で接続した場合にスキャナーが機能しません。この問題が発生する場合、フロントエンドを起動する前に SANE_USB_WORKAROUND=1 環境変数を設定してみてください。[3][4]\n\n上記の設定で問題が解決しない場合、以下の回避策を試してみてください:\n\n- 可能であれば、USB3 端子ではなく USB2 端子を使ってみる。\n- BIOS/EFI で xHCI を無効化する。eHCI が使われるようになってスキャナーが動作します。欠点として全ての USB3 端子の速度が落ちます。\n- (一部の) Intel のチップセットでは setpci コマンドを使って特定の USB 端子で xHCI と eHCI コントローラーのどちらを使うか指定することができます。詳しくは、force-a-single-usb-3-0-port-to-work-as-usb-2-0 (\"setpci\" について書かれている部分までスクロールしてください) を見てください。シンプルなシェルスクリプトでひとつの USB ポートだけモードを切り替えることができます。\n- サポートされていれば、ネットワーク経由でスキャナに接続する。\n\n"
    },
    {
      "title": "ファイアーウォール",
      "level": 4,
      "content": "ネットワークスキャンスキャナがハングすると、invalid argument (無効な引数) エラーが発生します。\n\nsaned はデータポートの範囲を使用するため、6566/tcp と /etc/sane.d/saned.conf の data_portrange への接続を有効化するか、または、sane が上記のデータポートを有効化できるようにするために conntrack ファイアーウォールモジュールを使用しなければなりません。\n\n"
    },
    {
      "title": "起動が遅い",
      "level": 3,
      "content": "起動が遅い場合 (例: xsane や scanimage -L が結果を返すまでに非常に長い時間がかかる)、使用していないドライバのどれかが原因である場合があります。\n\n/etc/sane.d/dll.conf を編集して、使用しないスキャナドライバをコメントアウトすることで、この問題を解決できます。scanimage -L を使うことで、どのドライバが必要であるかを判断することができます:\n\n```\n$ scanimage -L\n```\n\n```\ndevice `brother4:net1;dev0' is a Brother DCP-L2550DW\ndevice `v4l:/dev/video0' is a Noname Logitech Webcam C925e virtual device\ndevice `escl:http://192.168.1.2:80' is a Brother DCP-L2550DW series adf,platen scanner\n```\n\n出力の ` と : の間の部分が、対象のデバイスのドライバを示しています。例えば、ウェブカメラや汎用スキャナドライバを使用せず、Brother スキャナだけを使用したい場合は、/etc/sane.d/dll.conf 内の brother4 ドライバ以外はすべてコメントアウトできます。\n\n起動が遅い問題のもう一つの原因は、/etc/sane.d/backend-name.conf といったドライバ固有の設定ファイルにあるかもしれません。例えば、/etc/sane.d/epson2.conf の net autodiscovery という行をコメントアウトすると、USB で接続している Epson スキャナーにおいて起動が遅い問題を解決できたと報告されています。\n\n"
    },
    {
      "title": "Device busy",
      "level": 3,
      "content": "Table content:\nこの記事またはセクションの正確性には問題があります。 理由: ユーザを scanner グループに追加する必要はないはずです (ユーザーとグループ#systemd 以前のグループ を参照)。 (議論: トーク:SANE#)\n\nUSB デバイスが scanimage -L で表示されるのに、テストで scanimage pixma:04A9173E_11DAD1 --format=tiff --output-file test.tiff を実行すると必ず 'Device busy' エラーが発生する場合、あなたのユーザ名を scanner グループに追加し (usermod -a -G scanner yourusername)、/etc/modprobe.d/no-usblp.conf 内に blacklist usblp を記述して usblp カーネルモジュールをブラックリスト化してみてください (スキャンのサポートのために usblp がロードされることを防ぎます。このモジュールは xsane や関連するツールでは必要なく、CUP と競合するかもしれません)。最後に再起動してください。[5]\n\nこれに加えて、一部の Cannon プリンタは、スキャンモードが \"Computer\" に設定されている場合、\"device busy\" と返します。\"Remote Scanner\" モードに設定することで、問題が解決するはずです。[6]\n\n"
    },
    {
      "title": "パーミッションの問題",
      "level": 3,
      "content": "systemd によって scanner と lp グループは廃止されました。あなたのユーザーをグループに追加する必要はありません。詳しくはユーザーとグループ#systemd 以前のグループを見てください。\n\nUSB デバイスのパーミッションを変更することもできますが推奨されません。Udev ルールを使ってスキャナーが認識されるように修正するほうが良いでしょう。\n\nまずは lsusb で接続されている USB デバイスを確認してください:\n\n```\nBus 006 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\nBus 005 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\nBus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\nBus 003 Device 003: ID 04d9:1603 Holtek Semiconductor, Inc.\nBus 003 Device 002: ID 04fc:0538 Sunplus Technology Co., Ltd\nBus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\nBus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\nBus 001 Device 006: ID 03f0:2504 Hewlett-Packard\nBus 001 Device 002: ID 046d:0802 Logitech, Inc. Webcam C200\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n```\n\n上記の場合はスキャナーは Bus 001 Device 006: ID 03f0:2504 Hewlett-Packard です。03f0 が vendorID で 2504 が productID です。\n\nまたは、sane-find-scanner を root 権限で実行しても、同じ vendorID と productID 得ることができます。\n\n/usr/lib/udev/rules.d/65-sane.rules を開いてあなたのスキャナーの vendorID と productID が書かれた行が存在するか確認してください。存在しない場合、新しいファイル /etc/udev/rules.d/65-sane-missing-scanner.rules を以下の内容で作成します:\n\n```\nATTRS{idVendor}==\"vendorID\", ATTRS{idProduct}==\"productID\", MODE=\"0664\", GROUP=\"lp\", ENV{libsane_matched}=\"yes\"\n```\n\nファイルを保存したら、スキャナを一度切断してから再接続すればファイルのパーミッションが正しく設定されているはずです。\n\nTable content:\nこの記事またはセクションの正確性には問題があります。 理由: 正しいバックエンドファイルにスキャナを追加する必要があります。全てのスキャナで hp4200.conf が機能するわけではありません。 (議論: トーク:SANE#)\n\nデバイス (スキャナー) をバックエンドファイルに追加することもできます:\n\nusb 0x03f0 0x2504 を /etc/sane.d/hp4200.conf に追加すると以下のようになります:\n\n```\n#\n# Configuration file for the hp4200 backend\n#\n#\n# HP4200\n#usb 0x03f0 0x0105\nusb 0x03f0 0x2504\n```\n\n"
    },
    {
      "title": "パラレルポート接続のスキャナ",
      "level": 4,
      "content": "パラレルポートで接続されたデバイスは全てプリンターとして認識され lp グループが割り当てられます。udev ルールを作成して該当するパラレルポートを libsane_matched として設定するか、あるいはユーザーを lp ユーザグループに追加してください。CUPS も設定ファイルを読み取るために lp グループを使うため、ユーザーを lp グループに追加すると潜在的にセキュリティ上問題があります。詳しくは CUPS#接続インターフェイス を参照。\n\n"
    },
    {
      "title": "avahi-daemon は必須ではありません",
      "level": 3,
      "content": "一部のスキャナアプリケーションでは、起動時に avahi-daemon が起動している必要があります。実は、これは SANE が原因なのです。有線スキャナを使っていたり、スキャナのドライバがセットアップ時にすでにネットワークをサポートしていたりして avahi-daemon サービスを有効化する必要がない場合、SANE の設定ファイルから net バックエンドをコメントアウトしてください:\n\n```\n/etc/sane.d/dll.conf\n```\n\n```\n# The next line enables the network backend; comment it out if you do not\n# need to use a remote SANE scanner over the network -- see sane-net(5)\n# and saned(8) for details.\n#net\n```\n\nそして、saned デーモンを再起動してください。\n\n"
    },
    {
      "title": "Error during device I/O",
      "level": 3,
      "content": "HP スキャナでスキャン中に SANE: Error during device I/O (code=9) というエラーが発生する場合、hplip-pluginAUR がインストールされていることを確認してください (CUPS/プリンター別の問題#HP を参照)。\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- Wikipedia:WS-Discovery (Microsoft の \"ドライバレス\" プロトコル)\n\n"
    }
  ]
}