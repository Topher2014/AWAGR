{
  "title": "Systemd-timesyncd (Русский)",
  "url": "https://wiki.archlinux.org/title/Systemd-timesyncd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Ссылки по теме\n\n- systemd-networkd (Русский)\n- systemd (Русский)\n- Время\n\nИз списка рассылки systemd:\n\n"
    },
    {
      "title": "Настройка",
      "level": 2,
      "content": "Запустите/включите службу systemd-timesyncd.service, которая предоставляется пакетом systemd.\n\nПри запуске systemd-timesyncd считывает файл настроек /etc/systemd/timesyncd.conf, который выглядит примерно так:\n\n```\n/etc/systemd/timesyncd.conf\n```\n\n```\n[Time]\n#NTP=\n#FallbackNTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\n#...\n```\n\nЧтобы добавить серверы времени или изменить стандартные, раскомментируйте соответствующую строку и пропишите имена хостов или IP-адреса через пробел. Также можно добавить сниппет в /etc/systemd/timesyncd.conf.d/*.conf; смотрите timesyncd.conf(5).\n\nНапример, можно использовать серверы, предоставляемые проектом NTP pool, или стандартные серверы Arch (которые тоже предоставляются проектом NTP pool):\n\n```\n/etc/systemd/timesyncd.conf или /etc/systemd/timesyncd.conf.d/local.conf\n```\n\n```\n[Time]\nNTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\nFallbackNTP=0.pool.ntp.org 1.pool.ntp.org 0.fr.pool.ntp.org\n```\n\nПроверка настроек:\n\n```\n$ timedatectl show-timesync --all\n```\n\n```\nLinkNTPServers=\nSystemNTPServers=\nFallbackNTPServers=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\nServerName=0.arch.pool.ntp.org\nServerAddress=103.47.76.177\nRootDistanceMaxUSec=5s\nPollIntervalMinUSec=32s\nPollIntervalMaxUSec=34min 8s\nPollIntervalUSec=1min 4s\nNTPMessage={ Leap=0, Version=4, Mode=4, Stratum=2, Precision=-21, RootDelay=177.398ms, RootDispersion=142.196ms, Reference=C342F10A, OriginateTimestamp=Mon 2018-07-16 13:53:43 +08, ReceiveTimestamp=Mon 2018-07-16 13:53:43 +08, TransmitTimestamp=Mon 2018-07-16 13:53:43 +08, DestinationTimestamp=Mon 2018-07-16 13:53:43 +08, Ignored=no PacketCount=1, Jitter=0 }\nFrequency=22520548\n```\n\nПомимо настроек, серверы NTP могут предоставляться через опцию NTP= в настройках systemd-networkd или динамически через DHCP-сервер.\n\nИспользуемый NTP-сервер будет определяться с помощью следующих правил:\n\n- Приоритет имеют любые NTP-серверы, полученные для конкретного интерфейса из настроек systemd-networkd.service(8) или через DHCP.\n- Серверы NTP, указанные в файле /etc/systemd/timesyncd.conf, будут добавлены к списку серверов каждого каждого интерфейса во время работы, и демон будет обращаться к ним по очереди, пока какой-нибудь сервер не ответит.\n- Если после этого рабочий сервер не найдётся, будут использоваться серверы из настройки FallbackNTP=.\n\n"
    },
    {
      "title": "Использование",
      "level": 2,
      "content": "Для включения и запуска просто выполните:\n\n```\n# timedatectl set-ntp true\n```\n\nПроцесс синхронизации может быть ощутимо медленным. Это нормально, стоит немного подождать, прежде чем считать это проблемой. Проверка состояния службы:\n\n```\n$ timedatectl status\n```\n\n```\nLocal time: Чт 2015-07-09 19:21:33 MSK\n           Universal time: Чт 2015-07-09 16:21:33 UTC\n                 RTC time: Чт 2015-07-09 16:21:33\n                Time zone: Europe/Moscow (MSK, +0300)\nSystem clock synchronized: yes\n              NTP service: active\n          RTC in local TZ: no\n```\n\nБолее подробная служебная информация:\n\n```\n$ timedatectl timesync-status\n```\n\n```\nServer: 103.47.76.177 (0.arch.pool.ntp.org)\nPoll interval: 2min 8s (min: 32s; max 34min 8s)\n         Leap: normal\n      Version: 4\n      Stratum: 2\n    Reference: C342F10A\n    Precision: 1us (-21)\nRoot distance: 231.856ms (max: 5s)\n       Offset: -19.428ms\n        Delay: 36.717ms\n       Jitter: 7.343ms\n Packet count: 2\n    Frequency: +267.747ppm\n```\n\n"
    },
    {
      "title": "Смотрите также",
      "level": 2,
      "content": "- Forum: systemd-timesyncd is not syncing time\n- Forum: Using systemd-timesync instead of NTP\n- Исходный код timesyncd\n- systemd-timesyncd(8)\n- timesyncd.conf(5)\n\n"
    }
  ]
}