{
  "title": "Activating Numlock on Bootup (日本語)",
  "url": "https://wiki.archlinux.org/title/Activating_Numlock_on_Bootup_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 コンソール 1.1 Early bootup (mkinitcpio) 1.2 With systemd service 1.3 getty@.service の拡張 1.4 Bash を使う\n- 2 X.org 2.1 startx 2.2 KDM 2.3 KDE4 ユーザー 2.3.1 他の方法 2.4 GDM 2.5 GNOME 2.6 Xfce 2.7 SDDM 2.8 SLiM 2.9 OpenBox 2.10 LightDM 2.11 LXDM\n- 3 Wayland 3.1 Sway\n\n- 1.1 Early bootup (mkinitcpio)\n- 1.2 With systemd service\n- 1.3 getty@.service の拡張\n- 1.4 Bash を使う\n\n- 2.1 startx\n- 2.2 KDM\n- 2.3 KDE4 ユーザー 2.3.1 他の方法\n- 2.4 GDM\n- 2.5 GNOME\n- 2.6 Xfce\n- 2.7 SDDM\n- 2.8 SLiM\n- 2.9 OpenBox\n- 2.10 LightDM\n- 2.11 LXDM\n\n- 2.3.1 他の方法\n\n- 3.1 Sway\n\n"
    },
    {
      "title": "Early bootup (mkinitcpio)",
      "level": 3,
      "content": "initramfs でカーネルが起動した直後に numlock を有効にすることができます。これは、フルディスク暗号化 パスワード入力中でも numlock が確実にオンになる唯一の方法です。 mkinitcpio-numlockAUR をインストールし、/etc/mkinitcpio.conf HOOKS 配列の encrypt の前に numlock mkinitcpio フックを追加します:\n\n```\n/etc/mkinitcpio.conf\n```\n\n```\n...\nHOOKS=(base udev autodetect keyboard keymap consolefont numlock modconf block encrypt lvm2 filesystems fsck)\n...\n```\n\n次に、変更を有効にするために Initramfs を再生成します。\n\nこの方法を使用する利点は、numlock 設定が後の起動プロセスでレプリケートされ、新しい仮想コンソールではデフォルトで numlock がオンになることです。\n\n"
    },
    {
      "title": "With systemd service",
      "level": 3,
      "content": "First create a script to set the numlock on relevant TTYs:\n\n```\n/usr/local/bin/numlock\n```\n\n```\n#!/bin/bash\n\nfor tty in /dev/tty{1..6}\ndo\n    /usr/bin/setleds -D +num < \"$tty\";\ndone\n```\n\nOnce the script is created, you will need to make it executable. Otherwise the script cannot run.\n\nThen create and enable a systemd service:\n\n```\n/etc/systemd/system/numlock.service\n```\n\n```\n[Unit]\nDescription=numlock\n\n[Service]\nExecStart=/usr/local/bin/numlock\nStandardInput=tty\nRemainAfterExit=yes\n\n[Install]\nWantedBy=multi-user.target\n```\n\n"
    },
    {
      "title": "getty@.service の拡張",
      "level": 3,
      "content": "新しくサービスを作るのよりシンプルで（特に systemd-198 以降）、かつスクリプト内で VT の数をハードコード（決め打ち）しません。ディレクトリを作成してください:\n\n```\n# mkdir /etc/systemd/system/getty@.service.d\n```\n\n作成したディレクトリに以下のファイルを追加。\n\n```\nactivate-numlock.conf\n```\n\n```\n[Service]\nExecStartPost=/bin/sh -c 'setleds +num < /dev/%I'\n```\n\n"
    },
    {
      "title": "Bash を使う",
      "level": 3,
      "content": "~/.bash_profile に setleds -D +num を追加してください。この方法は、他の方法と違って、ログインするまでは Numlock が有効になりません。\n\n"
    },
    {
      "title": "X.org",
      "level": 2,
      "content": "様々な方法があります。\n\n"
    },
    {
      "title": "startx",
      "level": 3,
      "content": "numlockx パッケージをインストールして numlockx を ~/.xinitrc ファイルの exec の前に追加してください:\n\n```\n#!/bin/sh\n#\n# ~/.xinitrc\n#\n# Executed by startx (run your window manager from here)\n#\n\nnumlockx &\n\nexec window_manager\n```\n\n"
    },
    {
      "title": "KDM",
      "level": 3,
      "content": "KDM をログインマネージャとして使っているのなら以下を /usr/share/config/kdm/Xsetup (KDM3 の場合は /opt/kde/share/config/kdm/Xsetup) に追加してください:\n\n```\nnumlockx on\n```\n\nこのファイルはアップデート時に上書きされるので注意してください。その際 .pacnew ファイルは作られません。上書きを防ぐには、次の行を /etc/pacman.conf ファイルに追加してください (パスの最初のスラッシュは省略します):\n\n```\nNoUpgrade = usr/share/config/kdm/Xsetup\n```\n\n"
    },
    {
      "title": "KDE4 ユーザー",
      "level": 3,
      "content": "システム設定を開いてください。NumLock の挙動を変えるオプションがハードウェア/入力デバイス/キーボードにあります。\n\n"
    },
    {
      "title": "他の方法",
      "level": 4,
      "content": "あるいは、以下の内容で ~/.kde4/Autostart/numlockx スクリプトを追加してください:\n\n```\n#!/bin/sh\nnumlockx on\n```\n\nそしてスクリプトを実行可能にしてください:\n\n```\n$ chmod +x ~/.kde4/Autostart/numlockx\n```\n\n"
    },
    {
      "title": "GDM",
      "level": 3,
      "content": "まず (extra から) numlockx をインストールしてください。それから以下のコードを /etc/gdm/Init/Default に追加してください:\n\n```\nif [ -x /usr/bin/numlockx ]; then\n      /usr/bin/numlockx on\nfi\n```\n\n"
    },
    {
      "title": "GNOME",
      "level": 3,
      "content": "次のコマンドを実行します。\n\n```\n$ gsettings set org.gnome.desktop.peripherals.keyboard numlock-state true\n```\n\nNumlock キーの最後の状態 (無効か有効か) を記憶するには、次のコマンドを使用します。\n\n```\n$ gsettings set org.gnome.desktop.peripherals.keyboard remember-numlock-state true\n```\n\nあるいは、起動スクリプトまたは ~/.profile に numlockx on (numlockx から) を追加することもできます。\n\n"
    },
    {
      "title": "Xfce",
      "level": 3,
      "content": "~/.config/xfce4/xfconf/xfce-perchannel-xml/keyboards.xml ファイルの中の、以下の値を true に設定してください:\n\n```\n<property name=\"Numlock\" type=\"bool\" value=\"true\"/>\n<property name=\"RestoreNumlock\" type=\"bool\" value=\"true\"/>\n```\n\n"
    },
    {
      "title": "SDDM",
      "level": 3,
      "content": "/etc/sddm.conf ファイルの中の、[General] セクションの下に以下の行を追加してください:\n\n```\n[General]\nNumlock=on\n```\n\n"
    },
    {
      "title": "SLiM",
      "level": 3,
      "content": "/etc/slim.conf ファイルの中の以下の行をアンコメント (# を削除) してください:\n\n```\n#numlock             on\n```\n\n"
    },
    {
      "title": "OpenBox",
      "level": 3,
      "content": "~/.config/openbox/autostart ファイルに以下の行を加えて下さい:\n\n```\nnumlockx &\n```\n\nそれからファイルを保存してください。\n\n"
    },
    {
      "title": "LightDM",
      "level": 3,
      "content": "LightDM#NumLock を ON にするを見て下さい。\n\n"
    },
    {
      "title": "LXDM",
      "level": 3,
      "content": "/etc/lxdm/lxdm.conf ファイルの以下の行をアンコメントして:\n\n```\n#numlock=0\n```\n\n以下のように変更してください:\n\n```\nnumlock=1\n```\n\n"
    },
    {
      "title": "Sway",
      "level": 3,
      "content": "Sway#Initially enable CapsLock/NumLock を参照。\n\n"
    }
  ]
}