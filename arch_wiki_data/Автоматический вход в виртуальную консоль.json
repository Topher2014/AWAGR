{
  "title": "Автоматический вход в виртуальную консоль",
  "url": "https://wiki.archlinux.org/title/%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B2%D1%85%D0%BE%D0%B4_%D0%B2_%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%83%D1%8E_%D0%BA%D0%BE%D0%BD%D1%81%D0%BE%D0%BB%D1%8C",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Ссылки по теме\n\n- Экранный менеджер\n\ngetty — это общее название программы, которая управляет терминальной линией и подключенным к ней терминалом. Её цель — защитить систему от несанкционированного доступа. Как правило, каждый процесс getty запускается через systemd и управляет одной терминальной линией.\n\n"
    },
    {
      "title": "Установка",
      "level": 2,
      "content": "По умолчанию в Arch Linux используется agetty, который является частью пакета util-linux.\n\nСуществуют альтернативы:\n\n- mingetty — Минимальный getty, позволяющий автоматически входить в систему.\n\n- fbgetty — Консольный getty, подобный mingetty, который поддерживает фреймбуфер.\n\n- mgetty — Универсальная программа для работы со всеми аспектами модема под Unix.\n\n"
    },
    {
      "title": "Добавление дополнительных виртуальных консолей",
      "level": 2,
      "content": "В файле /etc/systemd/logind.conf измените опцию NAutoVTs=6 на желаемое число виртуальных консолей, которые будут доступны после загрузки системы.\n\nПри необходимости можно временно запустить новую виртуальную консоль путём запуска службы getty@ttyN.service напрямую.\n\n"
    },
    {
      "title": "Автоматический вход в виртуальную консоль",
      "level": 2,
      "content": "Настройка ведётся через drop-in файлы systemd для переопределения параметров по умолчанию, передаваемых в agetty.\n\nНастройки для виртуальных и последовательных (serial) консолей отличаются. Скорее всего вам нужно настроить автоматический вход в систему на виртуальной консоли (имя устройства которой ttyN, где N — число). Конфигурация автоматического входа для последовательных консолей будет немного отличаться. Имена устройств последовательных консолей выглядят как ttySN, где N — число.\n\n"
    },
    {
      "title": "Виртуальная консоль",
      "level": 3,
      "content": "Создайте drop-in файл для getty@tty1.service со следующим содержимым:\n\n```\n/etc/systemd/system/getty@tty1.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -f -- \\\\u' --noclear --autologin пользователь - $TERM\n```\n\n- Опция Type=idle, присутствующая в стандартном getty@.service, задержит запуск службы до тех пор, пока не будут выполнены все задания (запросы на изменение состояния юнитов), чтобы не засорять приглашение к входу в систему загрузочными сообщениями. При автоматическом запуске X может оказаться полезным сразу запустить getty@tty1.service, добавив Type=simple в drop-in файл. И система инициализации, и startx могут быть заглушены, чтобы избежать перемешивания их сообщений во время загрузки.\n- Приведённый выше фрагмент приведет к тому, что тип сеанса loginctl будет установлен на tty. При желании (например, при автоматическом запуске X можно вручную установить тип сеанса wayland или x11 путём добавления Environment=XDG_SESSION_TYPE=x11 или Environment=XDG_SESSION_TYPE=wayland в этот файл.\n\nЕсли вам не нужен автовход, но вы не хотите вводить своё имя пользователя, смотрите #Запрос только пароля для пользователя по умолчанию.\n\nЕсли вам нужен tty отличный от tty1, смотрите systemd FAQ.\n\n"
    },
    {
      "title": "Последовательная консоль",
      "level": 3,
      "content": "Создайте следующий drop-in файл:\n\n```\n/etc/systemd/system/serial-getty@ttyS0.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -f -- \\\\u' --keep-baud --autologin пользователь 115200,57600,38400,9600 - $TERM\n```\n\n"
    },
    {
      "title": "Консоль nspawn",
      "level": 3,
      "content": "Для настройки автовхода в контейнере systemd-nspawn создайте следующий drop-in файл:\n\n```\n/etc/systemd/system/console-getty.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -f -- \\\\u' --noclear --keep-baud --autologin пользователь - 115200,38400,9600 $TERM\n```\n\nЕсли для доступа к контейнеру используется метод machinectl login мой-контейнер, также настройте шаблон container-getty@.service, который управляет pts/[0-9]:\n\n```\n/etc/systemd/system/container-getty@.service.d/autologin.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -f -- \\\\u' --noclear --keep-baud --autologin пользователь - 115200,38400,9600 $TERM\n```\n\n"
    },
    {
      "title": "Запрос только пароля для пользователя по умолчанию",
      "level": 2,
      "content": "Getty можно использовать для входа в систему с виртуальной консоли с пользователем по умолчанию, вводя пароль, но без необходимости вводить имя пользователя. Например, чтобы запросить пароль пользователя пользователь на tty1:\n\n```\n/etc/systemd/system/getty@tty1.service.d/skip-username.conf\n```\n\n```\n[Service]\nExecStart=\nExecStart=-/sbin/agetty -o '-p -- пользователь' --noclear --skip-login - $TERM\n```\n\nЗатем включите getty@tty1.\n\n"
    },
    {
      "title": "Отображение загрузочных сообщений на tty1",
      "level": 2,
      "content": "По умолчанию в Arch включена служба getty@tty1. В файле службы уже прописан параметр --noclear, который не позволяет agetty очищать экран. Однако systemd очищает экран перед его запуском. Чтобы отключить это поведение, создайте следующий drop-in файл:\n\n```\n/etc/systemd/system/getty@tty1.service.d/noclear.conf\n```\n\n```\n[Service]\nTTYVTDisallocate=no\n```\n\n- Удалите quiet из параметров ядра.\n- Поздний запуск KMS может привести к стиранию первых нескольких сообщений. Смотрите Kernel mode setting (Русский)#Ранний запуск KMS или Kernel mode setting (Русский)#Отключение modesetting.\n\n"
    },
    {
      "title": "Смотрите также",
      "level": 2,
      "content": "- systemd (Русский)#Изменение цели загрузки по умолчанию\n- The TTY demystified\n- tty — Википедия\n\n"
    }
  ]
}