{
  "title": "Laptop Mode Tools (日本語)",
  "url": "https://wiki.archlinux.org/title/Laptop_Mode_Tools_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- acpid\n- systemd\n- cpufrequtils\n- ノートパソコン\n- Powertop\n- TLP\n\nLaptop Mode Tools は Linux 用のノートパソコン省電力化パッケージです。Linux カーネルの Laptop Mode 機能を有効にする手段として不可欠であり、ハードドライブをスピンダウンさせることができます。さらに、シンプルな設定ファイルを使ってその他の電源関連の設定を多数変更することが可能です。\n\nacpid や CPU の周波数スケールと組み合わさって、LMT は完全なノートパソコンの電源管理スイートを実現します。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 インストール\n- 2 設定 2.1 ハードディスク 2.1.1 ソリッドステートドライブ 2.2 CPU 周波数 2.3 デバイスとバス 2.3.1 Intel SATA 2.3.2 USB の自動サスペンド 2.4 ディスプレイとグラフィック 2.4.1 LCD 輝度 2.4.1.1 ThinkPad T40/T42 2.4.1.2 ThinkPad T60 2.4.1.3 ASUS ノートパソコン 2.4.1.3.1 LCD 2.4.1.3.2 キーボードのバックライト 2.4.2 ターミナルの点滅 2.5 ネットワーク 2.5.1 Ethernet 2.5.2 無線 LAN 2.6 オーディオ 2.6.1 AC97 2.6.2 Intel HDA\n- 3 トラブルシューティング 3.1 Laptop-mode-tools がイベントを認識しない 3.2 バッテリー使用時に5秒で USB マウスがスリープする 3.3 NVIDIA ドライバーの問題 3.3.1 KDE で黒い画面が表示される 3.3.2 laptop-mode.service を有効にした後に起動が遅くなる\n- 4 参照\n\n- 2.1 ハードディスク 2.1.1 ソリッドステートドライブ\n- 2.2 CPU 周波数\n- 2.3 デバイスとバス 2.3.1 Intel SATA 2.3.2 USB の自動サスペンド\n- 2.4 ディスプレイとグラフィック 2.4.1 LCD 輝度 2.4.1.1 ThinkPad T40/T42 2.4.1.2 ThinkPad T60 2.4.1.3 ASUS ノートパソコン 2.4.1.3.1 LCD 2.4.1.3.2 キーボードのバックライト 2.4.2 ターミナルの点滅\n- 2.5 ネットワーク 2.5.1 Ethernet 2.5.2 無線 LAN\n- 2.6 オーディオ 2.6.1 AC97 2.6.2 Intel HDA\n\n- 2.1.1 ソリッドステートドライブ\n\n- 2.3.1 Intel SATA\n- 2.3.2 USB の自動サスペンド\n\n- 2.4.1 LCD 輝度 2.4.1.1 ThinkPad T40/T42 2.4.1.2 ThinkPad T60 2.4.1.3 ASUS ノートパソコン 2.4.1.3.1 LCD 2.4.1.3.2 キーボードのバックライト\n- 2.4.2 ターミナルの点滅\n\n- 2.4.1.1 ThinkPad T40/T42\n- 2.4.1.2 ThinkPad T60\n- 2.4.1.3 ASUS ノートパソコン 2.4.1.3.1 LCD 2.4.1.3.2 キーボードのバックライト\n\n- 2.4.1.3.1 LCD\n- 2.4.1.3.2 キーボードのバックライト\n\n- 2.5.1 Ethernet\n- 2.5.2 無線 LAN\n\n- 2.6.1 AC97\n- 2.6.2 Intel HDA\n\n- 3.1 Laptop-mode-tools がイベントを認識しない\n- 3.2 バッテリー使用時に5秒で USB マウスがスリープする\n- 3.3 NVIDIA ドライバーの問題 3.3.1 KDE で黒い画面が表示される 3.3.2 laptop-mode.service を有効にした後に起動が遅くなる\n\n- 3.3.1 KDE で黒い画面が表示される\n- 3.3.2 laptop-mode.service を有効にした後に起動が遅くなる\n\n"
    },
    {
      "title": "インストール",
      "level": 2,
      "content": "AUR から laptop-mode-toolsAUR をインストールしてください。\n\n"
    },
    {
      "title": "設定",
      "level": 2,
      "content": "設定は以下のファイルで行います:\n\n- /etc/laptop-mode/laptop-mode.conf - メインの設定ファイル。\n- /etc/laptop-mode/conf.d/* - 数十の\"モジュール\"ごとの機能。\n\nそれぞれのモジュールは conf.d/ 内のファイルの CONTROL_* 引数を変更することにより、enabled や disabled にしたり auto に設定することができます。/etc/laptop-mode/laptop-mode.conf で ENABLE_AUTO_MODULES が設定されている場合、LMT は CONTROL_* が auto に設定されているモジュールを全て有効にします。このルールには2つだけ例外があります: auto-hibernate.conf と battery-level-polling.conf は CONTROL_* の代わりに ENABLE_* 変数を利用します。\n\nどのモジュールが有効・無効・自動になっているか確認するには、次を実行:\n\n```\n$ grep -r '^\\(CONTROL\\|ENABLE\\)_' /etc/laptop-mode/conf.d\n```\n\n最後に、laptop-mode.service を有効化してください。\n\n"
    },
    {
      "title": "ハードディスク",
      "level": 3,
      "content": "hdparm や sdparm をインストールする必要があります。Hdparm を見て下さい。\n\nhdparm -S の値でハードドライブをスピンダウンすることにより電力が節約され音がとても静かになります。先読み機能を使えばコンピュータに触っているときでもドライブをスピンダウンさせることが可能です。LMT は hdparm -B の値も使うことができます。ハードドライブを最大限節電するには 1 で最小は 254 です。例えば、電源使用時にはこの値を 254に設定し、バッテリー使用時には 20 に設定します。通常の作業でディスクがスピンアップするのを待つ間にフリーズがおこるような場合は、高い値 (例: 128) に設定すると良いでしょう。スピンダウンを行う頻度が下がります。hdparm -S と hdparm -B の値は /etc/laptop-mode/laptop-mode.conf で設定します。\n\nCONTROL_MOUNT_OPTIONS 変数を使用すると (デフォルトでオン)、laptop-mode-tools はパーティションを自動的に再マウントして、マウントオプションに commit=600,noatime を追加します。これによってジャーナリングプログラム jbd2 はディスクに数秒ごとにアクセスし続けながら、ディスクジャーナルは10分ごとに更新されます。\n\n"
    },
    {
      "title": "ソリッドステートドライブ",
      "level": 4,
      "content": "公式の、上流の FAQ より:\n\n問: わたしのマシンにはソリッドステートドライブ (SSD) が載っています。laptop-mode-tools のディスク関連の部分は有効にすべきでしょうか?もしくは有効にするのは不適切ですか?\n\n答: おそらく有効にするのが妥当です。理由は2つあります。(a) Laptop Mode は書き込み回数を減らすため、SSD の寿命が伸びる。(b) Laptop Mode は書き込みをバーストにするので、ALPM などの省電力機能が有効になる。ただし、使用しているハードウェアによって効果は著しく異なります。ハードウェアによっては全く効果がありませんが、一部のハードウェアでは相当な利益があります。\n\n"
    },
    {
      "title": "CPU 周波数",
      "level": 3,
      "content": "CPU 周波数ドライバーをインストールする必要があります。CPU 周波数スケーリングを見て下さい。\n\n```\n# cpufreq.conf\n# ThinkPad T40/T42/T60 Example\n#\nCONTROL_CPU_FREQUENCY=1\nBATT_CPU_MAXFREQ=fastest\nBATT_CPU_MINFREQ=slowest\nBATT_CPU_GOVERNOR=ondemand\nBATT_CPU_IGNORE_NICE_LOAD=1\nLM_AC_CPU_MAXFREQ=fastest\nLM_AC_CPU_MINFREQ=slowest\nLM_AC_CPU_GOVERNOR=ondemand\nLM_AC_CPU_IGNORE_NICE_LOAD=1\nNOLM_AC_CPU_MAXFREQ=fastest\nNOLM_AC_CPU_MINFREQ=slowest\nNOLM_AC_CPU_GOVERNOR=ondemand\nNOLM_AC_CPU_IGNORE_NICE_LOAD=0\nCONTROL_CPU_THROTTLING=0\n```\n\n"
    },
    {
      "title": "Intel SATA",
      "level": 4,
      "content": "- Intel SATA AHCI コントローラーの Aggressive Link Power Management 機能を有効にすればディスク IO がないときにディスクリンクが省電力モードに設定されます。\n\n```\n# intel-sata-powermgmt.conf\n# ThinkPad T40/T42/T60 Example\n#\nDEBUG=0\nCONTROL_INTEL_SATA_POWER=1\nBATT_ACTIVATE_SATA_POWER=1\nLM_AC_ACTIVATE_SATA_POWER=1\nNOLM_AC_ACTIVATE_SATA_POWER=0\n```\n\n"
    },
    {
      "title": "USB の自動サスペンド",
      "level": 4,
      "content": "```\n# runtime-pm.conf\n# ThinkPad T40/T42/T60 Example\n#\nDEBUG=0\nCONTROL_RUNTIME_AUTOSUSPEND=1\nBATT_SUSPEND_RUNTIME=1\nLM_AC_SUSPEND_RUNTIME=1\nNOLM_AC_SUSPEND_RUNTIME=1\nAUTOSUSPEND_TIMEOUT=2\n```\n\n"
    },
    {
      "title": "LCD 輝度",
      "level": 4,
      "content": "- 次のコマンドを実行することでノートパソコンで利用できる明るさの値を取得することができます:\n\n```\n$ cat /proc/acpi/video/VID/LCD/brightness\n```\n\nThinkPad T40/T42 ノートパソコンの場合、次を実行することで明るさの値の最大値と最小値が取得できます:\n\n```\n$ cat /sys/class/backlight/acpi_video0/brightness\n$ cat /sys/class/backlight/acpi_video0/max_brightness\n```\n\n```\n# lcd-brightness.conf\n# ThinkPad T40/T42 Example\n#\nDEBUG=0\nCONTROL_BRIGHTNESS=1\nBATT_BRIGHTNESS_COMMAND=\"echo 0\"\nLM_AC_BRIGHTNESS_COMMAND=\"echo 7\"\nNOLM_AC_BRIGHTNESS_COMMAND=\"echo 7\"\nBRIGHTNESS_OUTPUT=\"/sys/class/backlight/thinkpad_screen/brightness\"\n```\n\n- ThinkPad T60 ノートパソコンの場合、次を実行することで明るさの値の最大値と最小値が取得できます:\n\n```\n$ cat /sys/class/backlight/thinkpad_screen/max_brightness\n$ cat /sys/class/backlight/thinkpad_screen/brightness\n```\n\n```\n# lcd-brightness.conf\n# ThinkPad T60 Example\n#\nDEBUG=0\nCONTROL_BRIGHTNESS=1\nBATT_BRIGHTNESS_COMMAND=\"echo 0\"\nLM_AC_BRIGHTNESS_COMMAND=\"echo 7\"\nNOLM_AC_BRIGHTNESS_COMMAND=\"echo 7\"\nBRIGHTNESS_OUTPUT=\"/sys/class/backlight/acpi_video0/brightness\"\n```\n\nIntel CPU を搭載したほとんどの (おそらくすべての) Asus ROG および TUF ノートブックでは、次のコマンドを実行することで最大輝度値を取得できます。\n\n```\n# cat /sys/class/backlight/intel_backlight/max_brightness\n```\n\n```\n# lcd-brightness.conf\n# Asus TUF Dash F15 2022 Example\n#\nDEBUG=0\nCONTROL_BRIGHTNESS=1\nBATT_BRIGHTNESS_COMMAND=\"echo 32000\"\nLM_AC_BRIGHTNESS_COMMAND=\"echo 96000\"\nNOLM_AC_BRIGHTNESS_COMMAND=\"echo 96000\"\nBRIGHTNESS_OUTPUT=\"/sys/class/backlight/intel_backlight/brightness\"\n```\n\nAsus ノートブックは Asus 固有のモジュールを介してカーネルと通信するため、標準のキーボードの明るさのコマンドは機能しません。最大の輝度レベルは、以下を実行することで取得できます。\n\n```\n# cat /sys/class/leds/asus::kbd_backlight/max_brightness\n```\n\n```\n# kbd-backlight.conf\n# Asus TUF Dash F15 2022 Example\n#\nDEBUG=0\nCONTROL_BRIGHTNESS=1\nBATT_BRIGHTNESS_COMMAND=\"echo 1\"\nLM_AC_BRIGHTNESS_COMMAND=\"echo 3\"\nNOLM_AC_BRIGHTNESS_COMMAND=\"echo 3\"\nBRIGHTNESS_OUTPUT=\"/sys/class/leds/asus::kbd_backlight/max_brightness\"\n```\n\n"
    },
    {
      "title": "ターミナルの点滅",
      "level": 4,
      "content": "```\n# terminal-blanking.conf\n# ThinkPad T40/T42/T60 Example\n#\nDEBUG=0\nCONTROL_TERMINAL=1\nTERMINALS=\"/dev/tty1\"\nBATT_TERMINAL_BLANK_MINUTES=1\nBATT_TERMINAL_POWERDOWN_MINUTES=2\nLM_AC_TERMINAL_BLANK_MINUTES=10\nLM_AC_TERMINAL_POWERDOWN_MINUTES=10\nNOLM_AC_TERMINAL_BLANK_MINUTES=10\nNOLM_AC_TERMINAL_POWERDOWN_MINUTES=10\n```\n\n"
    },
    {
      "title": "Ethernet",
      "level": 4,
      "content": "```\n# ethernet.conf\n# ThinkPad T40/T42/T60 Example\n#\nDEBUG=0\nCONTROL_ETHERNET=1\nLM_AC_THROTTLE_ETHERNET=0\nNOLM_AC_THROTTLE_ETHERNET=0\nDISABLE_WAKEUP_ON_LAN=1\nDISABLE_ETHERNET_ON_BATTERY=1\nETHERNET_DEVICES=\"eth0\"\n```\n\n"
    },
    {
      "title": "無線 LAN",
      "level": 4,
      "content": "無線インターフェイスの電源管理設定はハードウェアに依存しており、設定するのが少し厄介です。ワイヤレスチップセットに応じて、以下の3つのファイルのどれか1つで設定を管理します:\n\n1. /etc/laptop-mode/conf.d/wireless-power.conf は省電力設定の一般的なファイルです (\"iwconfig wlan0 power on/off\" を使用)。ほとんどのチップセットで適用されます (ただし以下に記載する Intel のチップセットは除く)。\n1. /etc/laptop-mode/conf.d/wireless-ipw-power.conf は古い ipw ドライバーで動作する Intel チップセット用です。IPW3945, IPW2200, IPW2100 に適用されます。(LMT 1.55-1 現在) IPW3945 には iwpriv を使用し、IPW2100 と IPW220 には iwconfig と iwpriv の設定を組み合わせます。詳しくは /usr/share/laptop-mode-tools/modules/wireless-ipw-power を参照 (ipw3945 は使われません、下を見て下さい)。\n1. /etc/laptop-mode/conf.d/wireless-iwl-power.conf は iwl4965, iwl3945, iwlagn モジュールで動作する Intel チップセット用です (4965, 5100, 5300, 5350, 5150, 1000, 6000 チップセットをサポートしています)。\n\n3つとも有効にしてもあまり問題にはなりません。LMT はインターフェイスが使用しているモジュールを検出してそれにあわせて動作するからです。\n\n上記のそれぞれの設定ファイルでサポートされているモジュールは LMT から直接引用してきています。ただし、現在の 2.6.34 カーネルは ipw3945 と iwl4965 モジュールがないため、やや情報が古いようです (3945 チップセットは iwl3945 を使用し、4965 チップセットは iwlagn モジュールを代わりに使用しています)。どちらにしろ LMT が動作するのには影響がないため、あくまで資料として記載しています。\n\niwlagn モジュールで動作するチップセットには既知の問題が存在します (つまり 5300 チップセットなど)。/sys/class/net/wlan*/device/power_level ファイルが存在しないため、これらのチップセットでは /etc/laptop-mode/conf.d/wireless-iwl-power.conf の以下の設定は無視されます:\n\n```\nIWL_AC_POWER\nIWL_BATT_POWER\n```\n\n代わりに、標準の方法 (\"iwconfig wlan0 power on/off\") が自動的に使われます。\n\n"
    },
    {
      "title": "AC97",
      "level": 4,
      "content": "```\n# ac97-powersave.conf\n# ThinkPad T40/T42/T60 Example\n#\nDEBUG=0\nCONTROL_AC97_POWER=1\n```\n\n"
    },
    {
      "title": "Intel HDA",
      "level": 4,
      "content": "```\n# intel-hda-powersave.conf\n# ThinkPad T40/T42/T60 Example\n#\nDEBUG=0\nCONTROL_INTEL_HDA_POWER=1\nBATT_INTEL_HDA_POWERSAVE=1\nLM_AC_INTEL_HDA_POWERSAVE=1\nNOLM_AC_INTEL_HDA_POWERSAVE=0\nINTEL_HDA_DEVICE_TIMEOUT=10\nINTEL_HDA_DEVICE_CONTROLLER=0\n```\n\n"
    },
    {
      "title": "Laptop-mode-tools がイベントを認識しない",
      "level": 3,
      "content": "acpid をインストールして systemd サービスの acpid.service を有効化してください。\n\nこれで問題が解決しない場合、laptop-mode の設定ファイルで有効にしたいサービスが 1 に設定されているか確認してください。多くのサービス (cpufreq コントロールなど) はデフォルトで \"auto\" に設定されていますが、これだと有効にならないこともあります。\n\nバッテリーで起動した時に bluetooth が動作しないという問題が起こる場合、runtime-pm を無効にすれば直ることがあります。\n\n"
    },
    {
      "title": "バッテリー使用時に5秒で USB マウスがスリープする",
      "level": 3,
      "content": "デバイスの ID を確かめて下さい (例: 046d:c534):\n\n```\n$ lsusb\n```\n\nその値を /etc/laptop-mode/conf.d/usb-autosuspend.conf の AUTOSUSPEND_USBID_BLACKLIST 変数に記述してください、例えば:\n\n```\n/etc/laptop-mode/conf.d/usb-autosuspend.conf\n```\n\n```\n...\nAUTOSUSPEND_USBID_BLACKLIST=\"046d:c534\"\n...\n```\n\nスペースで区切ることで複数の ID を指定できます。\n\n"
    },
    {
      "title": "KDE で黒い画面が表示される",
      "level": 4,
      "content": "laptop-mode が有効になっている場合、KDE ​​は起動に失敗します。その理由は、デフォルトの KDE ディスプレイマネージャー (SDDM) が NVIDIA ドライバーよりも前に起動するためです。これを防ぐには、nomodeset カーネルパラメータ を削除する必要があります。\n\n"
    },
    {
      "title": "laptop-mode.service を有効にした後に起動が遅くなる",
      "level": 4,
      "content": "前に説明したように、 laptop-mode-tools は NVIDIA ドライバーに影響を与えます。nvidia-drm.modeset=1 カーネルパラメータ を追加すると、起動時間が大幅に短縮されます。\n\n"
    },
    {
      "title": "参照",
      "level": 2,
      "content": "- Laptop Mode Tools\n- Mailing List Archives\n\n"
    }
  ]
}