{
  "title": "X11vnc (日本語)",
  "url": "https://wiki.archlinux.org/title/X11vnc_(%E6%97%A5%E6%9C%AC%E8%AA%9E)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "関連記事\n\n- TigerVNC\n\nx11vnc を使うことで実際の X ディスプレイ (つまり物理モニタに表示されたディスプレイ、キーボード、マウス) を VNC ビューアでリモートに表示・操作することができます。つまり Windows における WinVNC と同じようなことを Unix/X11 で行います。\n\n"
    },
    {
      "title": "目次",
      "level": 2,
      "content": "- 1 x11vnc のセットアップ 1.1 インストール 1.2 起動 1.2.1 X authority を設定する 1.2.1.1 X の起動 1.2.1.2 GDM 1.2.1.3 SLIM 1.2.1.4 LXDM 1.2.2 パスワードを設定する 1.2.3 常に動作させる 1.3 アクセスする\n- 2 SSH トンネル\n- 3 トラブルシューティング\n\n- 1.1 インストール\n- 1.2 起動 1.2.1 X authority を設定する 1.2.1.1 X の起動 1.2.1.2 GDM 1.2.1.3 SLIM 1.2.1.4 LXDM 1.2.2 パスワードを設定する 1.2.3 常に動作させる\n- 1.3 アクセスする\n\n- 1.2.1 X authority を設定する 1.2.1.1 X の起動 1.2.1.2 GDM 1.2.1.3 SLIM 1.2.1.4 LXDM\n- 1.2.2 パスワードを設定する\n- 1.2.3 常に動作させる\n\n- 1.2.1.1 X の起動\n- 1.2.1.2 GDM\n- 1.2.1.3 SLIM\n- 1.2.1.4 LXDM\n\n"
    },
    {
      "title": "インストール",
      "level": 3,
      "content": "x11vnc は公式リポジトリからインストールできます。\n\n"
    },
    {
      "title": "起動",
      "level": 3,
      "content": "まず、startx を使うか GDM や SLiM などのディスプレイマネージャによって X を起動します。headless で動くように X を設定するのも良いでしょう。X を起動したら、ターミナルを開いて次を入力してください:\n\n```\n$ x11vnc -display :0\n```\n\nログイン時に実行されるスクリプトに x11vnc 行を記述するという方法もあります。\n\n```\n#!/bin/bash\nx11vnc -nap -wait 50 -noxdamage -passwd PASSWORD -display :0 -forever -o /var/log/x11vnc.log -bg\n```\n\n"
    },
    {
      "title": "X authority を設定する",
      "level": 4,
      "content": "VNC サーバーの X authority ファイルを設定することができます。-auth 引数を使って適切なファイルを指定することで設定でき、ファイルは X サーバーの起動方法によって異なります。一般的に、X authority ファイルを設定するには x11vnc が root で実行されることを必要とします。\n\n```\n$ x11vnc -display :0 -auth ~/.Xauthority\n```\n\nこのコマンドが失敗する場合、次のコマンドを (root で) 実行してください:\n\n```\n# x11vnc -display :0 -auth /home/user/.Xauthority\n```\n\nuser は X サーバーを実行しているユーザーのユーザー名に置き換えてください。\n\n```\n# x11vnc -display :0 -auth /var/lib/gdm/:0.Xauth\n```\n\n新しいバージョンの GDM では /run/user が使われます。ログイン画面で使われるユーザー 120 (gdm) の場合:\n\n```\n# x11vnc -display :0 -auth /run/user/120/gdm/Xauthority\n```\n\n上記のコマンドが上手くいかないときは下のトラブルシューティングセクションを見て下さい。\n\n```\n# x11vnc -display :0 -auth /var/run/slim.auth\n```\n\n```\n# x11vnc -display :0 -auth /var/run/lxdm/lxdm-\\:0.auth\n```\n\n"
    },
    {
      "title": "パスワードを設定する",
      "level": 4,
      "content": "```\n$ mkdir ~/.x11vnc\n$ x11vnc -storepasswd password ~/.x11vnc/passwd\n```\n\n保存されたパスワードを使って接続するには、以下のように -rfbauth 引数を使って作成した passwd ファイルを指定して下さい:\n\n```\n$ x11vnc -display :0 -rfbauth ~/.x11vnc/passwd\n```\n\n接続の際にビューアがパスワードを要求するはずです。\n\n"
    },
    {
      "title": "常に動作させる",
      "level": 4,
      "content": "デフォルトで、x11vnc は最初の VNC セッションを受け付けてセッションが切断させると終了します。 終了しないようにするには、x11vnc に -many または -forever 引数を付けて実行してください、以下のようになります:\n\n```\n$ x11vnc -many -display :0\n```\n\nまたは\n\n```\n$ x11vnc -forever -display :0\n```\n\n"
    },
    {
      "title": "アクセスする",
      "level": 3,
      "content": "他のコンピュータで VNC クライアントを起動して、x11vnc を実行しているコンピュータの IP アドレスを入力してください。接続すれば、上手くいくはずです。\n\nネットワークの外から (x11vnc が動作している) VNC サーバー・コンピュータにアクセスするときはポート 5900 が開放されている必要があります。\n\n"
    },
    {
      "title": "SSH トンネル",
      "level": 2,
      "content": "SSH をインストール・設定してください。\n\nx11vnc で -localhost フラグを使ってローカルインターフェイスにバインドしてください。それができれば、SSH を使ってポートをトンネルすることができます。SSH を通して VNC に接続してください。\n\n簡単な例 (http://www.karlrunge.com/x11vnc/index.html#tunnelling より):\n\n```\n$ ssh -t -L 5900:localhost:5900 remote_host 'sudo x11vnc -display :0 -auth /home/USER/.Xauthority'\n```\n\nUSER は X サーバーを動かしているユーザーのユーザー名に置き換えてください。\n\n(remote_host の Unix アカウントに現在の場所からログインするにはおそらくパスワード・パスフレーズが必要になります。ここでは remote_host のログインアカウントを持っており SSH サーバーを動かしていることが前提です)\n\nそしてマシンの他のターミナルウィンドウで次のコマンドを実行してください:\n\n```\n$ vncviewer -encodings \"copyrect tight zrle hextile\" localhost:0\n```\n\n"
    },
    {
      "title": "トラブルシューティング",
      "level": 2,
      "content": "1. こちら のウェブサイトを見ることであなたの ip アドレスと、ポート 5900 が開放されているか確認することができます。\n\n2. GNOME + GDM のみでテスト済み\n\nトンネルが起動できず、XOpenDisplay(\":0\") failed のようなエラーが表示される場合、~/.Xauthority ディレクトリがあるか確認してください。 ディレクトリが存在しない場合、下のコマンドを実行することで簡単に作成できます (実際はシンボリックリンクです):\n\n```\n$ ln -sv $(dirname $(xauth info | awk '/Authority file/{print $3}')) ~/.Xauthority\n```\n\nそれから上のトンネリングの例を試してください、上手く動くはずです。 さらに Xorg が起動するたびに自動的に作成させたい場合、下のように Xprofile ファイルを作成して実行可能にしてください:\n\n```\n$ ln -sf $(dirname $(xauth info | awk '/Authority file/{print $3}')) ~/.Xauthority\n```\n\n3. GNOME 3 と x11vnc\n\nGNOME 3 と x11vnc を使っていて以下のエラーが表示される場合:\n\n```\n*** XOpenDisplay failed (:0) \n\n*** x11vnc was unable to open the X DISPLAY: \":0\", it cannot continue.\n```\n\nx11vnc を以下のように実行してみてください:\n\n```\n$ x11vnc -noxdamage -many -display :0 -auth /var/run/gdm/$(sudo ls /var/run/gdm | grep $(whoami))/database -forever -bg\n```\n\n他のディスプレイマネージャやデスクトップ環境で動いたり動かなかったら更新してください。\n\n4. スクリーンセーバーの問題\n\nスクリーンセーバーが1-2秒で起動してしまう場合、x11vnc を -nodpms キーを付けて起動してください。\n\n"
    }
  ]
}